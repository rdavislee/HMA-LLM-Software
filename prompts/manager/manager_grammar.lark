// Manager Language Grammar for Lark
// Based on the TypeScript parserlib grammar specification

// Comments
COMMENT: /\/\/.*/

// Directives
directive: delegate | finish | action | wait | run | update_readme

// Delegate directive
delegate: "DELEGATE" delegate_item ("," delegate_item)*
delegate_item: target prompt_field

// Finish directive  
finish: "FINISH" prompt_field

// Action directive
action: action_type target ("," target)*
action_type: READ

// Update readme directive
update_readme: "UPDATE_README" content_string

// Run directive
run: RUN command

// Wait directive
wait: "WAIT"

// Targets
target: "file" filename   -> file
      | "folder" filename -> folder

// Filename is a quoted string
filename: string

// Command is a quoted string
command: string

// Prompt field
prompt_field: "PROMPT" "=" string

// File content field (completely replaces current file contents)
content_string: "CONTENT_STRING" "=" string

// String literals as a terminal (preserve whitespace and escapes)
string: STRING
STRING: /"(\\.|[^\\"])*"/

// Action type tokens
READ: "READ"
UPDATE_README: "UPDATE_README"
RUN: "RUN"

// Ignore whitespace and comments
%import common.WS
%ignore WS
%ignore COMMENT 