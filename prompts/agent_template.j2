{# Agent Jinja Template #}
{# This template is used to format prompts for agents #}

{% if agent_role %}
## Agent Role
{{ agent_role }}
{% endif %}

{# Current Task #}
{% if active_task %}
## Current Task
{{ active_task }}

{% endif %}

{# Context (prompt-response history) #}
{% if context %}
## Context
{% for item in context %}
### Previous Interaction
**Prompt:**
{{ item.prompt }}

**Response:**
{{ item.response }}

{% endfor %}
{% endif %}

{# Memory (file contents) #}
{% if memory_contents %}
## Memory Files
{% for filename, content in memory_contents.items() %}
### {{ filename }}
```
{{ content }}
```

{% endfor %}
{% endif %}

{# Personal File #}
{% if personal_file_name %}
## Personal File
{{ personal_file_name }} (content available in Memory Files above)

{% endif %}

{# Code Base Structure #}
{% if codebase_structure %}
## Codebase Structure
{{ codebase_structure }}

{% endif %}

{# Agent Position & Children #}
## Agent Context
**Current Path (from project root):** {{ agent_path }}

{% if children %}
**Children:**
{% for child in children %}- {{ child }}
{% endfor %}

{% endif %}
{% if active_children %}
**Active Children:**
{% for child in active_children %}- {{ child }}
{% endfor %}

{% endif %}

{# Commands Available #}
{% if available_commands %}
## Available Terminal Commands
{{ available_commands }}
{% endif %}

{# Lark Grammar #}
## Language Grammar
```
{{ lark_grammar }}
```

{# Language Examples #}
## Language Examples

{{ language_examples }}

{# Current Prompt #}
{% if current_prompt %}
## Current Prompt
{{ current_prompt }}
{% endif %}

{# Instructions #}
## Instructions

Respond using the provided language syntax. You may include multiple commands, each on its own line.

IMPORTANT:
1. Use escaped quotes (\") and `\\n` only when they appear inside a quoted argument (e.g., file contents or prompts).
2. End the response with a single newline character.
