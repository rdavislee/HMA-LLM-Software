{# User-Level Agent Template #}
{% if active_task %}
## Current Task
{{ active_task }}
{% endif %}

{% if context %}
## Context
{% for item in context %}
### Previous Interaction
**Prompt:**
{{ item.prompt }}

**Response:**
{{ item.response }}

{% endfor %}
{% endif %}

{% if memory_contents %}
## Memory Files
{% for filename, content in memory_contents.items() %}
### {{ filename }}
```
{{ content }}
```

{% endfor %}
{% endif %}

{% if personal_file_name %}
## Personal File
{{ personal_file_name }} (content available in Memory Files above)
{% endif %}

{% if codebase_structure %}
## Codebase Structure
{{ codebase_structure }}
{% endif %}

{# Agent Position & Children #}
## Agent Context
**Current Path (from project root):** {{ agent_path }}

{% if children %}
**Children:**
{% for child in children %}- {{ child }}
{% endfor %}

{% endif %}
{% if active_children %}
**Active Children:**
{% for child in active_children %}- {{ child }}
{% endfor %}

{% endif %}

## Response Format Requirements
Return exactly the command(s) with no surrounding prose or code fences.
Use escaped quotes (\") and `\n` (single backslash n) for newlines inside quoted arguments. Ensure the response ends with a single newline.

{% if current_prompt %}
## Current Prompt
{{ current_prompt }}
{% endif %} 