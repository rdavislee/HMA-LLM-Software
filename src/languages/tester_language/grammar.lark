// Tester Language Grammar for Lark
// Based on the coder language grammar but adapted for tester agents
// Supports READ, RUN, CHANGE (for scratch pad), and FINISH directives

// Comments
COMMENT: /\/\/.*/

// Directives
directive: read | run | change | replace | finish

// Replace directive - search & replace strings in scratch pad (multiple items supported)
replace: "REPLACE" replace_item ("," replace_item)*
replace_item: "FROM" "=" from_string "TO" "=" to_string
// Read directive - read any file in the codebase
read: "READ" filename

// Run directive - run terminal commands
run: "RUN" command

// Change directive - modify the scratch pad file content
change: "CHANGE" "CONTENT" "=" content_string

// Finish directive - complete the task
finish: "FINISH" prompt_field

// Filename is a quoted string
filename: string

// Command is a quoted string
command: string

// Prompt field
prompt_field: "PROMPT" "=" string

// Content string - may be triple-quoted or standard strings
content_string: string

// From and to strings for replace directive
from_string: string
to_string: string

// Regular string literals (triple-quoted raw or escaped double-quoted)
string: TRIPLE_STRING | STRING

// Ignore whitespace and comments
%import common.WS
%ignore WS
%ignore COMMENT

// Terminal definitions - ORDER MATTERS! More specific patterns first
// Triple-quoted raw string (supports newlines and quotes verbatim) - MUST come before STRING
TRIPLE_STRING.10: /""".*?"""/s

// Escaped traditional double-quoted string - must not be empty quotes and must not start with triple quotes
STRING: /"([^"\\]|\\.)*"/ 