import{r as N,R as Pi,j as v,S as dr,u as Ke,a as Bi,c as hs,P as xe,b as Lt,d as Ne,e as Ae,f as yt,g as Mi,h as Ii,L as Ni,T as Oi,C as ji,i as ur,k as fr,l as _r,m as pr,n as mr,O as gr,D as Hi,o as Fi}from"./ui-CicT0c0w.js";import{a as zi,r as Wi}from"./react-DavUf6mE.js";import{t as $i,c as vr}from"./utils-BJeS7sC5.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))d(y);new MutationObserver(y=>{for(const E of y)if(E.type==="childList")for(const k of E.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&d(k)}).observe(document,{childList:!0,subtree:!0});function t(y){const E={};return y.integrity&&(E.integrity=y.integrity),y.referrerPolicy&&(E.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?E.credentials="include":y.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function d(y){if(y.ep)return;y.ep=!0;const E=t(y);fetch(y.href,E)}})();var lt={},Ls;function Ui(){if(Ls)return lt;Ls=1;var i=zi();return lt.createRoot=i.createRoot,lt.hydrateRoot=i.hydrateRoot,lt}var qi=Ui();/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vi=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ki=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,d)=>d?d.toUpperCase():t.toLowerCase()),As=i=>{const e=Ki(i);return e.charAt(0).toUpperCase()+e.slice(1)},Sr=(...i)=>i.filter((e,t,d)=>!!e&&e.trim()!==""&&d.indexOf(e)===t).join(" ").trim(),Gi=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xi={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=N.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:d,className:y="",children:E,iconNode:k,...s},a)=>N.createElement("svg",{ref:a,...Xi,width:e,height:e,stroke:i,strokeWidth:d?Number(t)*24/Number(e):t,className:Sr("lucide",y),...!E&&!Gi(s)&&{"aria-hidden":"true"},...s},[...k.map(([u,p])=>N.createElement(u,p)),...Array.isArray(E)?E:[E]]));/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=(i,e)=>{const t=N.forwardRef(({className:d,...y},E)=>N.createElement(Ji,{ref:E,iconNode:e,className:Sr(`lucide-${Vi(As(i))}`,`lucide-${i}`,d),...y}));return t.displayName=As(i),t};/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yi=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],Zi=ee("bot",Yi);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],br=ee("chevron-down",Qi);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ts=ee("chevron-right",en);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Pe=ee("circle-alert",tn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],rn=ee("circle-check-big",sn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],yr=ee("clock",nn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],ft=ee("code",on);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ln=ee("copy",an);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],hn=ee("database",cn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],wr=ee("download",dn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],fn=ee("ellipsis",un);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],Ds=ee("file-code",_n);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],_t=ee("file-text",pn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],ds=ee("file",mn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],vn=ee("folder-open",gn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],xr=ee("folder",Sn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],yn=ee("grip-vertical",bn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],xn=ee("image",wn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],At=ee("loader-circle",Cn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],kn=ee("menu",En);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Ln=ee("message-circle",Rn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],wt=ee("message-square",An);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"m9 10 3-3 3 3",key:"11gsxs"}]],Tn=ee("panel-bottom-open",Dn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]],Bn=ee("panel-left-open",Pn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],In=ee("paperclip",Mn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Cr=ee("plus",Nn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Er=ee("refresh-cw",On);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Hn=ee("search",jn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],zn=ee("send",Fn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],$n=ee("settings",Wn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],qn=ee("sparkles",Un);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Ht=ee("star",Vn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kn=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Gn=ee("terminal",Kn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],Ts=ee("test-tube",Xn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Yn=ee("upload",Jn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Qn=ee("user",Zn);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],Ps=ee("wrench",eo);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ot=ee("x",to);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ro=ee("zap",so),Dt=N.createContext(null);Dt.displayName="PanelGroupContext";const ae={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},us=10,Oe=N.useLayoutEffect,Bs=Pi.useId,io=typeof Bs=="function"?Bs:()=>null;let no=0;function fs(i=null){const e=io(),t=N.useRef(i||e||null);return t.current===null&&(t.current=""+no++),i??t.current}function kr({children:i,className:e="",collapsedSize:t,collapsible:d,defaultSize:y,forwardedRef:E,id:k,maxSize:s,minSize:a,onCollapse:u,onExpand:p,onResize:c,order:h,style:f,tagName:S="div",..._}){const n=N.useContext(Dt);if(n===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:o,expandPanel:r,getPanelSize:l,getPanelStyle:m,groupId:w,isPanelCollapsed:b,reevaluatePanelConstraints:x,registerPanel:g,resizePanel:C,unregisterPanel:T}=n,A=fs(k),B=N.useRef({callbacks:{onCollapse:u,onExpand:p,onResize:c},constraints:{collapsedSize:t,collapsible:d,defaultSize:y,maxSize:s,minSize:a},id:A,idIsFromProps:k!==void 0,order:h});N.useRef({didLogMissingDefaultSizeWarning:!1}),Oe(()=>{const{callbacks:j,constraints:W}=B.current,U={...W};B.current.id=A,B.current.idIsFromProps=k!==void 0,B.current.order=h,j.onCollapse=u,j.onExpand=p,j.onResize=c,W.collapsedSize=t,W.collapsible=d,W.defaultSize=y,W.maxSize=s,W.minSize=a,(U.collapsedSize!==W.collapsedSize||U.collapsible!==W.collapsible||U.maxSize!==W.maxSize||U.minSize!==W.minSize)&&x(B.current,U)}),Oe(()=>{const j=B.current;return g(j),()=>{T(j)}},[h,A,g,T]),N.useImperativeHandle(E,()=>({collapse:()=>{o(B.current)},expand:j=>{r(B.current,j)},getId(){return A},getSize(){return l(B.current)},isCollapsed(){return b(B.current)},isExpanded(){return!b(B.current)},resize:j=>{C(B.current,j)}}),[o,r,l,b,A,C]);const D=m(B.current,y);return N.createElement(S,{..._,children:i,className:e,id:A,style:{...D,...f},[ae.groupId]:w,[ae.panel]:"",[ae.panelCollapsible]:d||void 0,[ae.panelId]:A,[ae.panelSize]:parseFloat(""+D.flexGrow).toFixed(1)})}const Rr=N.forwardRef((i,e)=>N.createElement(kr,{...i,forwardedRef:e}));kr.displayName="Panel";Rr.displayName="forwardRef(Panel)";let ss=null,pt=-1,De=null;function oo(i,e){if(e){const t=(e&Pr)!==0,d=(e&Br)!==0,y=(e&Mr)!==0,E=(e&Ir)!==0;if(t)return y?"se-resize":E?"ne-resize":"e-resize";if(d)return y?"sw-resize":E?"nw-resize":"w-resize";if(y)return"s-resize";if(E)return"n-resize"}switch(i){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function ao(){De!==null&&(document.head.removeChild(De),ss=null,De=null,pt=-1)}function Ft(i,e){var t,d;const y=oo(i,e);if(ss!==y){if(ss=y,De===null&&(De=document.createElement("style"),document.head.appendChild(De)),pt>=0){var E;(E=De.sheet)===null||E===void 0||E.removeRule(pt)}pt=(t=(d=De.sheet)===null||d===void 0?void 0:d.insertRule(`*{cursor: ${y} !important;}`))!==null&&t!==void 0?t:-1}}function Lr(i){return i.type==="keydown"}function Ar(i){return i.type.startsWith("pointer")}function Dr(i){return i.type.startsWith("mouse")}function Tt(i){if(Ar(i)){if(i.isPrimary)return{x:i.clientX,y:i.clientY}}else if(Dr(i))return{x:i.clientX,y:i.clientY};return{x:1/0,y:1/0}}function lo(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function co(i,e,t){return i.x<e.x+e.width&&i.x+i.width>e.x&&i.y<e.y+e.height&&i.y+i.height>e.y}function ho(i,e){if(i===e)throw new Error("Cannot compare node with itself");const t={a:Ns(i),b:Ns(e)};let d;for(;t.a.at(-1)===t.b.at(-1);)i=t.a.pop(),e=t.b.pop(),d=i;Q(d,"Stacking order can only be calculated for elements with a common ancestor");const y={a:Is(Ms(t.a)),b:Is(Ms(t.b))};if(y.a===y.b){const E=d.childNodes,k={a:t.a.at(-1),b:t.b.at(-1)};let s=E.length;for(;s--;){const a=E[s];if(a===k.a)return 1;if(a===k.b)return-1}}return Math.sign(y.a-y.b)}const uo=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function fo(i){var e;const t=getComputedStyle((e=Tr(i))!==null&&e!==void 0?e:i).display;return t==="flex"||t==="inline-flex"}function _o(i){const e=getComputedStyle(i);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||fo(i))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||uo.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function Ms(i){let e=i.length;for(;e--;){const t=i[e];if(Q(t,"Missing node"),_o(t))return t}return null}function Is(i){return i&&Number(getComputedStyle(i).zIndex)||0}function Ns(i){const e=[];for(;i;)e.push(i),i=Tr(i);return e}function Tr(i){const{parentNode:e}=i;return e&&e instanceof ShadowRoot?e.host:e}const Pr=1,Br=2,Mr=4,Ir=8,po=lo()==="coarse";let Se=[],Ue=!1,Te=new Map,Pt=new Map;const rt=new Set;function mo(i,e,t,d,y){var E;const{ownerDocument:k}=e,s={direction:t,element:e,hitAreaMargins:d,setResizeHandlerState:y},a=(E=Te.get(k))!==null&&E!==void 0?E:0;return Te.set(k,a+1),rt.add(s),xt(),function(){var p;Pt.delete(i),rt.delete(s);const c=(p=Te.get(k))!==null&&p!==void 0?p:1;if(Te.set(k,c-1),xt(),c===1&&Te.delete(k),Se.includes(s)){const h=Se.indexOf(s);h>=0&&Se.splice(h,1),ps(),y("up",!0,null)}}}function go(i){const{target:e}=i,{x:t,y:d}=Tt(i);Ue=!0,_s({target:e,x:t,y:d}),xt(),Se.length>0&&(Ct("down",i),i.preventDefault(),Nr(e)||i.stopImmediatePropagation())}function zt(i){const{x:e,y:t}=Tt(i);if(Ue&&i.buttons===0&&(Ue=!1,Ct("up",i)),!Ue){const{target:d}=i;_s({target:d,x:e,y:t})}Ct("move",i),ps(),Se.length>0&&i.preventDefault()}function Wt(i){const{target:e}=i,{x:t,y:d}=Tt(i);Pt.clear(),Ue=!1,Se.length>0&&(i.preventDefault(),Nr(e)||i.stopImmediatePropagation()),Ct("up",i),_s({target:e,x:t,y:d}),ps(),xt()}function Nr(i){let e=i;for(;e;){if(e.hasAttribute(ae.resizeHandle))return!0;e=e.parentElement}return!1}function _s({target:i,x:e,y:t}){Se.splice(0);let d=null;(i instanceof HTMLElement||i instanceof SVGElement)&&(d=i),rt.forEach(y=>{const{element:E,hitAreaMargins:k}=y,s=E.getBoundingClientRect(),{bottom:a,left:u,right:p,top:c}=s,h=po?k.coarse:k.fine;if(e>=u-h&&e<=p+h&&t>=c-h&&t<=a+h){if(d!==null&&document.contains(d)&&E!==d&&!E.contains(d)&&!d.contains(E)&&ho(d,E)>0){let S=d,_=!1;for(;S&&!S.contains(E);){if(co(S.getBoundingClientRect(),s)){_=!0;break}S=S.parentElement}if(_)return}Se.push(y)}})}function $t(i,e){Pt.set(i,e)}function ps(){let i=!1,e=!1;Se.forEach(d=>{const{direction:y}=d;y==="horizontal"?i=!0:e=!0});let t=0;Pt.forEach(d=>{t|=d}),i&&e?Ft("intersection",t):i?Ft("horizontal",t):e?Ft("vertical",t):ao()}let Ut;function xt(){var i;(i=Ut)===null||i===void 0||i.abort(),Ut=new AbortController;const e={capture:!0,signal:Ut.signal};rt.size&&(Ue?(Se.length>0&&Te.forEach((t,d)=>{const{body:y}=d;t>0&&(y.addEventListener("contextmenu",Wt,e),y.addEventListener("pointerleave",zt,e),y.addEventListener("pointermove",zt,e))}),Te.forEach((t,d)=>{const{body:y}=d;y.addEventListener("pointerup",Wt,e),y.addEventListener("pointercancel",Wt,e)})):Te.forEach((t,d)=>{const{body:y}=d;t>0&&(y.addEventListener("pointerdown",go,e),y.addEventListener("pointermove",zt,e))}))}function Ct(i,e){rt.forEach(t=>{const{setResizeHandlerState:d}=t,y=Se.includes(t);d(i,y,e)})}function vo(){const[i,e]=N.useState(0);return N.useCallback(()=>e(t=>t+1),[])}function Q(i,e){if(!i)throw console.error(e),Error(e)}function je(i,e,t=us){return i.toFixed(t)===e.toFixed(t)?0:i>e?1:-1}function ke(i,e,t=us){return je(i,e,t)===0}function _e(i,e,t){return je(i,e,t)===0}function So(i,e,t){if(i.length!==e.length)return!1;for(let d=0;d<i.length;d++){const y=i[d],E=e[d];if(!_e(y,E,t))return!1}return!0}function $e({panelConstraints:i,panelIndex:e,size:t}){const d=i[e];Q(d!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:y=0,collapsible:E,maxSize:k=100,minSize:s=0}=d;if(je(t,s)<0)if(E){const a=(y+s)/2;je(t,a)<0?t=y:t=s}else t=s;return t=Math.min(k,t),t=parseFloat(t.toFixed(us)),t}function et({delta:i,initialLayout:e,panelConstraints:t,pivotIndices:d,prevLayout:y,trigger:E}){if(_e(i,0))return e;const k=[...e],[s,a]=d;Q(s!=null,"Invalid first pivot index"),Q(a!=null,"Invalid second pivot index");let u=0;if(E==="keyboard"){{const c=i<0?a:s,h=t[c];Q(h,`Panel constraints not found for index ${c}`);const{collapsedSize:f=0,collapsible:S,minSize:_=0}=h;if(S){const n=e[c];if(Q(n!=null,`Previous layout not found for panel index ${c}`),_e(n,f)){const o=_-n;je(o,Math.abs(i))>0&&(i=i<0?0-o:o)}}}{const c=i<0?s:a,h=t[c];Q(h,`No panel constraints found for index ${c}`);const{collapsedSize:f=0,collapsible:S,minSize:_=0}=h;if(S){const n=e[c];if(Q(n!=null,`Previous layout not found for panel index ${c}`),_e(n,_)){const o=n-f;je(o,Math.abs(i))>0&&(i=i<0?0-o:o)}}}}{const c=i<0?1:-1;let h=i<0?a:s,f=0;for(;;){const _=e[h];Q(_!=null,`Previous layout not found for panel index ${h}`);const o=$e({panelConstraints:t,panelIndex:h,size:100})-_;if(f+=o,h+=c,h<0||h>=t.length)break}const S=Math.min(Math.abs(i),Math.abs(f));i=i<0?0-S:S}{let h=i<0?s:a;for(;h>=0&&h<t.length;){const f=Math.abs(i)-Math.abs(u),S=e[h];Q(S!=null,`Previous layout not found for panel index ${h}`);const _=S-f,n=$e({panelConstraints:t,panelIndex:h,size:_});if(!_e(S,n)&&(u+=S-n,k[h]=n,u.toPrecision(3).localeCompare(Math.abs(i).toPrecision(3),void 0,{numeric:!0})>=0))break;i<0?h--:h++}}if(So(y,k))return y;{const c=i<0?a:s,h=e[c];Q(h!=null,`Previous layout not found for panel index ${c}`);const f=h+u,S=$e({panelConstraints:t,panelIndex:c,size:f});if(k[c]=S,!_e(S,f)){let _=f-S,o=i<0?a:s;for(;o>=0&&o<t.length;){const r=k[o];Q(r!=null,`Previous layout not found for panel index ${o}`);const l=r+_,m=$e({panelConstraints:t,panelIndex:o,size:l});if(_e(r,m)||(_-=m-r,k[o]=m),_e(_,0))break;i>0?o--:o++}}}const p=k.reduce((c,h)=>h+c,0);return _e(p,100)?k:y}function bo({layout:i,panelsArray:e,pivotIndices:t}){let d=0,y=100,E=0,k=0;const s=t[0];Q(s!=null,"No pivot index found"),e.forEach((c,h)=>{const{constraints:f}=c,{maxSize:S=100,minSize:_=0}=f;h===s?(d=_,y=S):(E+=_,k+=S)});const a=Math.min(y,100-E),u=Math.max(d,100-k),p=i[s];return{valueMax:a,valueMin:u,valueNow:p}}function it(i,e=document){return Array.from(e.querySelectorAll(`[${ae.resizeHandleId}][data-panel-group-id="${i}"]`))}function Or(i,e,t=document){const y=it(i,t).findIndex(E=>E.getAttribute(ae.resizeHandleId)===e);return y??null}function jr(i,e,t){const d=Or(i,e,t);return d!=null?[d,d+1]:[-1,-1]}function yo(i){return i instanceof HTMLElement?!0:typeof i=="object"&&i!==null&&"tagName"in i&&"getAttribute"in i}function Hr(i,e=document){if(yo(e)&&e.dataset.panelGroupId==i)return e;const t=e.querySelector(`[data-panel-group][data-panel-group-id="${i}"]`);return t||null}function Bt(i,e=document){const t=e.querySelector(`[${ae.resizeHandleId}="${i}"]`);return t||null}function wo(i,e,t,d=document){var y,E,k,s;const a=Bt(e,d),u=it(i,d),p=a?u.indexOf(a):-1,c=(y=(E=t[p])===null||E===void 0?void 0:E.id)!==null&&y!==void 0?y:null,h=(k=(s=t[p+1])===null||s===void 0?void 0:s.id)!==null&&k!==void 0?k:null;return[c,h]}function xo({committedValuesRef:i,eagerValuesRef:e,groupId:t,layout:d,panelDataArray:y,panelGroupElement:E,setLayout:k}){N.useRef({didWarnAboutMissingResizeHandle:!1}),Oe(()=>{if(!E)return;const s=it(t,E);for(let a=0;a<y.length-1;a++){const{valueMax:u,valueMin:p,valueNow:c}=bo({layout:d,panelsArray:y,pivotIndices:[a,a+1]}),h=s[a];if(h!=null){const f=y[a];Q(f,`No panel data found for index "${a}"`),h.setAttribute("aria-controls",f.id),h.setAttribute("aria-valuemax",""+Math.round(u)),h.setAttribute("aria-valuemin",""+Math.round(p)),h.setAttribute("aria-valuenow",c!=null?""+Math.round(c):"")}}return()=>{s.forEach((a,u)=>{a.removeAttribute("aria-controls"),a.removeAttribute("aria-valuemax"),a.removeAttribute("aria-valuemin"),a.removeAttribute("aria-valuenow")})}},[t,d,y,E]),N.useEffect(()=>{if(!E)return;const s=e.current;Q(s,"Eager values not found");const{panelDataArray:a}=s,u=Hr(t,E);Q(u!=null,`No group found for id "${t}"`);const p=it(t,E);Q(p,`No resize handles found for group id "${t}"`);const c=p.map(h=>{const f=h.getAttribute(ae.resizeHandleId);Q(f,"Resize handle element has no handle id attribute");const[S,_]=wo(t,f,a,E);if(S==null||_==null)return()=>{};const n=o=>{if(!o.defaultPrevented)switch(o.key){case"Enter":{o.preventDefault();const r=a.findIndex(l=>l.id===S);if(r>=0){const l=a[r];Q(l,`No panel data found for index ${r}`);const m=d[r],{collapsedSize:w=0,collapsible:b,minSize:x=0}=l.constraints;if(m!=null&&b){const g=et({delta:_e(m,w)?x-w:w-m,initialLayout:d,panelConstraints:a.map(C=>C.constraints),pivotIndices:jr(t,f,E),prevLayout:d,trigger:"keyboard"});d!==g&&k(g)}}break}}};return h.addEventListener("keydown",n),()=>{h.removeEventListener("keydown",n)}});return()=>{c.forEach(h=>h())}},[E,i,e,t,d,y,k])}function Os(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function Fr(i,e){const t=i==="horizontal",{x:d,y}=Tt(e);return t?d:y}function Co(i,e,t,d,y){const E=t==="horizontal",k=Bt(e,y);Q(k,`No resize handle element found for id "${e}"`);const s=k.getAttribute(ae.groupId);Q(s,"Resize handle element has no group id attribute");let{initialCursorPosition:a}=d;const u=Fr(t,i),p=Hr(s,y);Q(p,`No group element found for id "${s}"`);const c=p.getBoundingClientRect(),h=E?c.width:c.height;return(u-a)/h*100}function Eo(i,e,t,d,y,E){if(Lr(i)){const k=t==="horizontal";let s=0;i.shiftKey?s=100:y!=null?s=y:s=10;let a=0;switch(i.key){case"ArrowDown":a=k?0:s;break;case"ArrowLeft":a=k?-s:0;break;case"ArrowRight":a=k?s:0;break;case"ArrowUp":a=k?0:-s;break;case"End":a=100;break;case"Home":a=-100;break}return a}else return d==null?0:Co(i,e,t,d,E)}function ko({panelDataArray:i}){const e=Array(i.length),t=i.map(E=>E.constraints);let d=0,y=100;for(let E=0;E<i.length;E++){const k=t[E];Q(k,`Panel constraints not found for index ${E}`);const{defaultSize:s}=k;s!=null&&(d++,e[E]=s,y-=s)}for(let E=0;E<i.length;E++){const k=t[E];Q(k,`Panel constraints not found for index ${E}`);const{defaultSize:s}=k;if(s!=null)continue;const a=i.length-d,u=y/a;d++,e[E]=u,y-=u}return e}function Fe(i,e,t){e.forEach((d,y)=>{const E=i[y];Q(E,`Panel data not found for index ${y}`);const{callbacks:k,constraints:s,id:a}=E,{collapsedSize:u=0,collapsible:p}=s,c=t[a];if(c==null||d!==c){t[a]=d;const{onCollapse:h,onExpand:f,onResize:S}=k;S&&S(d,c),p&&(h||f)&&(f&&(c==null||ke(c,u))&&!ke(d,u)&&f(),h&&(c==null||!ke(c,u))&&ke(d,u)&&h())}})}function ct(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!=e[t])return!1;return!0}function Ro({defaultSize:i,dragState:e,layout:t,panelData:d,panelIndex:y,precision:E=3}){const k=t[y];let s;return k==null?s=i!=null?i.toPrecision(E):"1":d.length===1?s="1":s=k.toPrecision(E),{flexBasis:0,flexGrow:s,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function Lo(i,e=10){let t=null;return(...y)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{i(...y)},e)}}function js(i){try{if(typeof localStorage<"u")i.getItem=e=>localStorage.getItem(e),i.setItem=(e,t)=>{localStorage.setItem(e,t)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),i.getItem=()=>null,i.setItem=()=>{}}}function zr(i){return`react-resizable-panels:${i}`}function Wr(i){return i.map(e=>{const{constraints:t,id:d,idIsFromProps:y,order:E}=e;return y?d:E?`${E}:${JSON.stringify(t)}`:JSON.stringify(t)}).sort((e,t)=>e.localeCompare(t)).join(",")}function $r(i,e){try{const t=zr(i),d=e.getItem(t);if(d){const y=JSON.parse(d);if(typeof y=="object"&&y!=null)return y}}catch{}return null}function Ao(i,e,t){var d,y;const E=(d=$r(i,t))!==null&&d!==void 0?d:{},k=Wr(e);return(y=E[k])!==null&&y!==void 0?y:null}function Do(i,e,t,d,y){var E;const k=zr(i),s=Wr(e),a=(E=$r(i,y))!==null&&E!==void 0?E:{};a[s]={expandToSizes:Object.fromEntries(t.entries()),layout:d};try{y.setItem(k,JSON.stringify(a))}catch(u){console.error(u)}}function Hs({layout:i,panelConstraints:e}){const t=[...i],d=t.reduce((E,k)=>E+k,0);if(t.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${t.map(E=>`${E}%`).join(", ")}`);if(!_e(d,100)&&t.length>0)for(let E=0;E<e.length;E++){const k=t[E];Q(k!=null,`No layout data found for index ${E}`);const s=100/d*k;t[E]=s}let y=0;for(let E=0;E<e.length;E++){const k=t[E];Q(k!=null,`No layout data found for index ${E}`);const s=$e({panelConstraints:e,panelIndex:E,size:k});k!=s&&(y+=k-s,t[E]=s)}if(!_e(y,0))for(let E=0;E<e.length;E++){const k=t[E];Q(k!=null,`No layout data found for index ${E}`);const s=k+y,a=$e({panelConstraints:e,panelIndex:E,size:s});if(k!==a&&(y-=a-k,t[E]=a,_e(y,0)))break}return t}const To=100,tt={getItem:i=>(js(tt),tt.getItem(i)),setItem:(i,e)=>{js(tt),tt.setItem(i,e)}},Fs={};function Ur({autoSaveId:i=null,children:e,className:t="",direction:d,forwardedRef:y,id:E=null,onLayout:k=null,keyboardResizeBy:s=null,storage:a=tt,style:u,tagName:p="div",...c}){const h=fs(E),f=N.useRef(null),[S,_]=N.useState(null),[n,o]=N.useState([]),r=vo(),l=N.useRef({}),m=N.useRef(new Map),w=N.useRef(0),b=N.useRef({autoSaveId:i,direction:d,dragState:S,id:h,keyboardResizeBy:s,onLayout:k,storage:a}),x=N.useRef({layout:n,panelDataArray:[],panelDataArrayChanged:!1});N.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),N.useImperativeHandle(y,()=>({getId:()=>b.current.id,getLayout:()=>{const{layout:H}=x.current;return H},setLayout:H=>{const{onLayout:z}=b.current,{layout:q,panelDataArray:V}=x.current,I=Hs({layout:H,panelConstraints:V.map(L=>L.constraints)});Os(q,I)||(o(I),x.current.layout=I,z&&z(I),Fe(V,I,l.current))}}),[]),Oe(()=>{b.current.autoSaveId=i,b.current.direction=d,b.current.dragState=S,b.current.id=h,b.current.onLayout=k,b.current.storage=a}),xo({committedValuesRef:b,eagerValuesRef:x,groupId:h,layout:n,panelDataArray:x.current.panelDataArray,setLayout:o,panelGroupElement:f.current}),N.useEffect(()=>{const{panelDataArray:H}=x.current;if(i){if(n.length===0||n.length!==H.length)return;let z=Fs[i];z==null&&(z=Lo(Do,To),Fs[i]=z);const q=[...H],V=new Map(m.current);z(i,q,V,n,a)}},[i,n,a]),N.useEffect(()=>{});const g=N.useCallback(H=>{const{onLayout:z}=b.current,{layout:q,panelDataArray:V}=x.current;if(H.constraints.collapsible){const I=V.map(X=>X.constraints),{collapsedSize:L=0,panelSize:F,pivotIndices:$}=Ie(V,H,q);if(Q(F!=null,`Panel size not found for panel "${H.id}"`),!ke(F,L)){m.current.set(H.id,F);const G=We(V,H)===V.length-1?F-L:L-F,Y=et({delta:G,initialLayout:q,panelConstraints:I,pivotIndices:$,prevLayout:q,trigger:"imperative-api"});ct(q,Y)||(o(Y),x.current.layout=Y,z&&z(Y),Fe(V,Y,l.current))}}},[]),C=N.useCallback((H,z)=>{const{onLayout:q}=b.current,{layout:V,panelDataArray:I}=x.current;if(H.constraints.collapsible){const L=I.map(se=>se.constraints),{collapsedSize:F=0,panelSize:$=0,minSize:X=0,pivotIndices:G}=Ie(I,H,V),Y=z??X;if(ke($,F)){const se=m.current.get(H.id),re=se!=null&&se>=Y?se:Y,Z=We(I,H)===I.length-1?$-re:re-$,le=et({delta:Z,initialLayout:V,panelConstraints:L,pivotIndices:G,prevLayout:V,trigger:"imperative-api"});ct(V,le)||(o(le),x.current.layout=le,q&&q(le),Fe(I,le,l.current))}}},[]),T=N.useCallback(H=>{const{layout:z,panelDataArray:q}=x.current,{panelSize:V}=Ie(q,H,z);return Q(V!=null,`Panel size not found for panel "${H.id}"`),V},[]),A=N.useCallback((H,z)=>{const{panelDataArray:q}=x.current,V=We(q,H);return Ro({defaultSize:z,dragState:S,layout:n,panelData:q,panelIndex:V})},[S,n]),B=N.useCallback(H=>{const{layout:z,panelDataArray:q}=x.current,{collapsedSize:V=0,collapsible:I,panelSize:L}=Ie(q,H,z);return Q(L!=null,`Panel size not found for panel "${H.id}"`),I===!0&&ke(L,V)},[]),D=N.useCallback(H=>{const{layout:z,panelDataArray:q}=x.current,{collapsedSize:V=0,collapsible:I,panelSize:L}=Ie(q,H,z);return Q(L!=null,`Panel size not found for panel "${H.id}"`),!I||je(L,V)>0},[]),j=N.useCallback(H=>{const{panelDataArray:z}=x.current;z.push(H),z.sort((q,V)=>{const I=q.order,L=V.order;return I==null&&L==null?0:I==null?-1:L==null?1:I-L}),x.current.panelDataArrayChanged=!0,r()},[r]);Oe(()=>{if(x.current.panelDataArrayChanged){x.current.panelDataArrayChanged=!1;const{autoSaveId:H,onLayout:z,storage:q}=b.current,{layout:V,panelDataArray:I}=x.current;let L=null;if(H){const $=Ao(H,I,q);$&&(m.current=new Map(Object.entries($.expandToSizes)),L=$.layout)}L==null&&(L=ko({panelDataArray:I}));const F=Hs({layout:L,panelConstraints:I.map($=>$.constraints)});Os(V,F)||(o(F),x.current.layout=F,z&&z(F),Fe(I,F,l.current))}}),Oe(()=>{const H=x.current;return()=>{H.layout=[]}},[]);const W=N.useCallback(H=>{let z=!1;const q=f.current;return q&&window.getComputedStyle(q,null).getPropertyValue("direction")==="rtl"&&(z=!0),function(I){I.preventDefault();const L=f.current;if(!L)return()=>null;const{direction:F,dragState:$,id:X,keyboardResizeBy:G,onLayout:Y}=b.current,{layout:se,panelDataArray:re}=x.current,{initialLayout:he}=$??{},Z=jr(X,H,L);let le=Eo(I,H,F,$,G,L);const He=F==="horizontal";He&&z&&(le=-le);const Xe=re.map(fe=>fe.constraints),Ee=et({delta:le,initialLayout:he??se,panelConstraints:Xe,pivotIndices:Z,prevLayout:se,trigger:Lr(I)?"keyboard":"mouse-or-touch"}),Me=!ct(se,Ee);(Ar(I)||Dr(I))&&w.current!=le&&(w.current=le,!Me&&le!==0?He?$t(H,le<0?Pr:Br):$t(H,le<0?Mr:Ir):$t(H,0)),Me&&(o(Ee),x.current.layout=Ee,Y&&Y(Ee),Fe(re,Ee,l.current))}},[]),U=N.useCallback((H,z)=>{const{onLayout:q}=b.current,{layout:V,panelDataArray:I}=x.current,L=I.map(se=>se.constraints),{panelSize:F,pivotIndices:$}=Ie(I,H,V);Q(F!=null,`Panel size not found for panel "${H.id}"`);const G=We(I,H)===I.length-1?F-z:z-F,Y=et({delta:G,initialLayout:V,panelConstraints:L,pivotIndices:$,prevLayout:V,trigger:"imperative-api"});ct(V,Y)||(o(Y),x.current.layout=Y,q&&q(Y),Fe(I,Y,l.current))},[]),J=N.useCallback((H,z)=>{const{layout:q,panelDataArray:V}=x.current,{collapsedSize:I=0,collapsible:L}=z,{collapsedSize:F=0,collapsible:$,maxSize:X=100,minSize:G=0}=H.constraints,{panelSize:Y}=Ie(V,H,q);Y!=null&&(L&&$&&ke(Y,I)?ke(I,F)||U(H,F):Y<G?U(H,G):Y>X&&U(H,X))},[U]),K=N.useCallback((H,z)=>{const{direction:q}=b.current,{layout:V}=x.current;if(!f.current)return;const I=Bt(H,f.current);Q(I,`Drag handle element not found for id "${H}"`);const L=Fr(q,z);_({dragHandleId:H,dragHandleRect:I.getBoundingClientRect(),initialCursorPosition:L,initialLayout:V})},[]),R=N.useCallback(()=>{_(null)},[]),P=N.useCallback(H=>{const{panelDataArray:z}=x.current,q=We(z,H);q>=0&&(z.splice(q,1),delete l.current[H.id],x.current.panelDataArrayChanged=!0,r())},[r]),M=N.useMemo(()=>({collapsePanel:g,direction:d,dragState:S,expandPanel:C,getPanelSize:T,getPanelStyle:A,groupId:h,isPanelCollapsed:B,isPanelExpanded:D,reevaluatePanelConstraints:J,registerPanel:j,registerResizeHandle:W,resizePanel:U,startDragging:K,stopDragging:R,unregisterPanel:P,panelGroupElement:f.current}),[g,S,d,C,T,A,h,B,D,J,j,W,U,K,R,P]),O={display:"flex",flexDirection:d==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return N.createElement(Dt.Provider,{value:M},N.createElement(p,{...c,children:e,className:t,id:E,ref:f,style:{...O,...u},[ae.group]:"",[ae.groupDirection]:d,[ae.groupId]:h}))}const qr=N.forwardRef((i,e)=>N.createElement(Ur,{...i,forwardedRef:e}));Ur.displayName="PanelGroup";qr.displayName="forwardRef(PanelGroup)";function We(i,e){return i.findIndex(t=>t===e||t.id===e.id)}function Ie(i,e,t){const d=We(i,e),E=d===i.length-1?[d-1,d]:[d,d+1],k=t[d];return{...e.constraints,panelSize:k,pivotIndices:E}}function Po({disabled:i,handleId:e,resizeHandler:t,panelGroupElement:d}){N.useEffect(()=>{if(i||t==null||d==null)return;const y=Bt(e,d);if(y==null)return;const E=k=>{if(!k.defaultPrevented)switch(k.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{k.preventDefault(),t(k);break}case"F6":{k.preventDefault();const s=y.getAttribute(ae.groupId);Q(s,`No group element found for id "${s}"`);const a=it(s,d),u=Or(s,e,d);Q(u!==null,`No resize element found for id "${e}"`);const p=k.shiftKey?u>0?u-1:a.length-1:u+1<a.length?u+1:0;a[p].focus();break}}};return y.addEventListener("keydown",E),()=>{y.removeEventListener("keydown",E)}},[d,i,e,t])}function Vr({children:i=null,className:e="",disabled:t=!1,hitAreaMargins:d,id:y,onBlur:E,onClick:k,onDragging:s,onFocus:a,onPointerDown:u,onPointerUp:p,style:c={},tabIndex:h=0,tagName:f="div",...S}){var _,n;const o=N.useRef(null),r=N.useRef({onClick:k,onDragging:s,onPointerDown:u,onPointerUp:p});N.useEffect(()=>{r.current.onClick=k,r.current.onDragging=s,r.current.onPointerDown=u,r.current.onPointerUp=p});const l=N.useContext(Dt);if(l===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:m,groupId:w,registerResizeHandle:b,startDragging:x,stopDragging:g,panelGroupElement:C}=l,T=fs(y),[A,B]=N.useState("inactive"),[D,j]=N.useState(!1),[W,U]=N.useState(null),J=N.useRef({state:A});Oe(()=>{J.current.state=A}),N.useEffect(()=>{if(t)U(null);else{const M=b(T);U(()=>M)}},[t,T,b]);const K=(_=d?.coarse)!==null&&_!==void 0?_:15,R=(n=d?.fine)!==null&&n!==void 0?n:5;N.useEffect(()=>{if(t||W==null)return;const M=o.current;Q(M,"Element ref not attached");let O=!1;return mo(T,M,m,{coarse:K,fine:R},(z,q,V)=>{if(!q){B("inactive");return}switch(z){case"down":{B("drag"),O=!1,Q(V,'Expected event to be defined for "down" action'),x(T,V);const{onDragging:I,onPointerDown:L}=r.current;I?.(!0),L?.();break}case"move":{const{state:I}=J.current;O=!0,I!=="drag"&&B("hover"),Q(V,'Expected event to be defined for "move" action'),W(V);break}case"up":{B("hover"),g();const{onClick:I,onDragging:L,onPointerUp:F}=r.current;L?.(!1),F?.(),O||I?.();break}}})},[K,m,t,R,b,T,W,x,g]),Po({disabled:t,handleId:T,resizeHandler:W,panelGroupElement:C});const P={touchAction:"none",userSelect:"none"};return N.createElement(f,{...S,children:i,className:e,id:y,onBlur:()=>{j(!1),E?.()},onFocus:()=>{j(!0),a?.()},ref:o,role:"separator",style:{...P,...c},tabIndex:h,[ae.groupDirection]:m,[ae.groupId]:w,[ae.resizeHandle]:"",[ae.resizeHandleActive]:A==="drag"?"pointer":D?"keyboard":void 0,[ae.resizeHandleEnabled]:!t,[ae.resizeHandleId]:T,[ae.resizeHandleState]:A})}Vr.displayName="PanelResizeHandle";function ne(...i){return $i(vr(i))}function zs({className:i,...e}){return v.jsx(qr,{"data-slot":"resizable-panel-group",className:ne("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",i),...e})}function ht({...i}){return v.jsx(Rr,{"data-slot":"resizable-panel",...i})}function Ws({withHandle:i,className:e,...t}){return v.jsx(Vr,{"data-slot":"resizable-handle",className:ne("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",e),...t,children:i&&v.jsx("div",{className:"bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border",children:v.jsx(yn,{className:"size-2.5"})})})}const $s=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,Us=vr,ms=(i,e)=>t=>{var d;if(e?.variants==null)return Us(i,t?.class,t?.className);const{variants:y,defaultVariants:E}=e,k=Object.keys(y).map(u=>{const p=t?.[u],c=E?.[u];if(p===null)return null;const h=$s(p)||$s(c);return y[u][h]}),s=t&&Object.entries(t).reduce((u,p)=>{let[c,h]=p;return h===void 0||(u[c]=h),u},{}),a=e==null||(d=e.compoundVariants)===null||d===void 0?void 0:d.reduce((u,p)=>{let{class:c,className:h,...f}=p;return Object.entries(f).every(S=>{let[_,n]=S;return Array.isArray(n)?n.includes({...E,...s}[_]):{...E,...s}[_]===n})?[...u,c,h]:u},[]);return Us(i,k,a,t?.class,t?.className)},Bo=ms("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function ie({className:i,variant:e,size:t,asChild:d=!1,...y}){const E=d?dr:"button";return v.jsx(E,{"data-slot":"button",className:ne(Bo({variant:e,size:t,className:i})),...y})}function Mo(i,e){return N.useReducer((t,d)=>e[t][d]??t,i)}var gs="ScrollArea",[Kr,dc]=hs(gs),[Io,ge]=Kr(gs),Gr=N.forwardRef((i,e)=>{const{__scopeScrollArea:t,type:d="hover",dir:y,scrollHideDelay:E=600,...k}=i,[s,a]=N.useState(null),[u,p]=N.useState(null),[c,h]=N.useState(null),[f,S]=N.useState(null),[_,n]=N.useState(null),[o,r]=N.useState(0),[l,m]=N.useState(0),[w,b]=N.useState(!1),[x,g]=N.useState(!1),C=Ke(e,A=>a(A)),T=Bi(y);return v.jsx(Io,{scope:t,type:d,dir:T,scrollHideDelay:E,scrollArea:s,viewport:u,onViewportChange:p,content:c,onContentChange:h,scrollbarX:f,onScrollbarXChange:S,scrollbarXEnabled:w,onScrollbarXEnabledChange:b,scrollbarY:_,onScrollbarYChange:n,scrollbarYEnabled:x,onScrollbarYEnabledChange:g,onCornerWidthChange:r,onCornerHeightChange:m,children:v.jsx(xe.div,{dir:T,...k,ref:C,style:{position:"relative","--radix-scroll-area-corner-width":o+"px","--radix-scroll-area-corner-height":l+"px",...i.style}})})});Gr.displayName=gs;var Xr="ScrollAreaViewport",Jr=N.forwardRef((i,e)=>{const{__scopeScrollArea:t,children:d,nonce:y,...E}=i,k=ge(Xr,t),s=N.useRef(null),a=Ke(e,s,k.onViewportChange);return v.jsxs(v.Fragment,{children:[v.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:y}),v.jsx(xe.div,{"data-radix-scroll-area-viewport":"",...E,ref:a,style:{overflowX:k.scrollbarXEnabled?"scroll":"hidden",overflowY:k.scrollbarYEnabled?"scroll":"hidden",...i.style},children:v.jsx("div",{ref:k.onContentChange,style:{minWidth:"100%",display:"table"},children:d})})]})});Jr.displayName=Xr;var Ce="ScrollAreaScrollbar",Yr=N.forwardRef((i,e)=>{const{forceMount:t,...d}=i,y=ge(Ce,i.__scopeScrollArea),{onScrollbarXEnabledChange:E,onScrollbarYEnabledChange:k}=y,s=i.orientation==="horizontal";return N.useEffect(()=>(s?E(!0):k(!0),()=>{s?E(!1):k(!1)}),[s,E,k]),y.type==="hover"?v.jsx(No,{...d,ref:e,forceMount:t}):y.type==="scroll"?v.jsx(Oo,{...d,ref:e,forceMount:t}):y.type==="auto"?v.jsx(Zr,{...d,ref:e,forceMount:t}):y.type==="always"?v.jsx(vs,{...d,ref:e}):null});Yr.displayName=Ce;var No=N.forwardRef((i,e)=>{const{forceMount:t,...d}=i,y=ge(Ce,i.__scopeScrollArea),[E,k]=N.useState(!1);return N.useEffect(()=>{const s=y.scrollArea;let a=0;if(s){const u=()=>{window.clearTimeout(a),k(!0)},p=()=>{a=window.setTimeout(()=>k(!1),y.scrollHideDelay)};return s.addEventListener("pointerenter",u),s.addEventListener("pointerleave",p),()=>{window.clearTimeout(a),s.removeEventListener("pointerenter",u),s.removeEventListener("pointerleave",p)}}},[y.scrollArea,y.scrollHideDelay]),v.jsx(Lt,{present:t||E,children:v.jsx(Zr,{"data-state":E?"visible":"hidden",...d,ref:e})})}),Oo=N.forwardRef((i,e)=>{const{forceMount:t,...d}=i,y=ge(Ce,i.__scopeScrollArea),E=i.orientation==="horizontal",k=It(()=>a("SCROLL_END"),100),[s,a]=Mo("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return N.useEffect(()=>{if(s==="idle"){const u=window.setTimeout(()=>a("HIDE"),y.scrollHideDelay);return()=>window.clearTimeout(u)}},[s,y.scrollHideDelay,a]),N.useEffect(()=>{const u=y.viewport,p=E?"scrollLeft":"scrollTop";if(u){let c=u[p];const h=()=>{const f=u[p];c!==f&&(a("SCROLL"),k()),c=f};return u.addEventListener("scroll",h),()=>u.removeEventListener("scroll",h)}},[y.viewport,E,a,k]),v.jsx(Lt,{present:t||s!=="hidden",children:v.jsx(vs,{"data-state":s==="hidden"?"hidden":"visible",...d,ref:e,onPointerEnter:Ne(i.onPointerEnter,()=>a("POINTER_ENTER")),onPointerLeave:Ne(i.onPointerLeave,()=>a("POINTER_LEAVE"))})})}),Zr=N.forwardRef((i,e)=>{const t=ge(Ce,i.__scopeScrollArea),{forceMount:d,...y}=i,[E,k]=N.useState(!1),s=i.orientation==="horizontal",a=It(()=>{if(t.viewport){const u=t.viewport.offsetWidth<t.viewport.scrollWidth,p=t.viewport.offsetHeight<t.viewport.scrollHeight;k(s?u:p)}},10);return Ve(t.viewport,a),Ve(t.content,a),v.jsx(Lt,{present:d||E,children:v.jsx(vs,{"data-state":E?"visible":"hidden",...y,ref:e})})}),vs=N.forwardRef((i,e)=>{const{orientation:t="vertical",...d}=i,y=ge(Ce,i.__scopeScrollArea),E=N.useRef(null),k=N.useRef(0),[s,a]=N.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=ri(s.viewport,s.content),p={...d,sizes:s,onSizesChange:a,hasThumb:u>0&&u<1,onThumbChange:h=>E.current=h,onThumbPointerUp:()=>k.current=0,onThumbPointerDown:h=>k.current=h};function c(h,f){return $o(h,k.current,s,f)}return t==="horizontal"?v.jsx(jo,{...p,ref:e,onThumbPositionChange:()=>{if(y.viewport&&E.current){const h=y.viewport.scrollLeft,f=qs(h,s,y.dir);E.current.style.transform=`translate3d(${f}px, 0, 0)`}},onWheelScroll:h=>{y.viewport&&(y.viewport.scrollLeft=h)},onDragScroll:h=>{y.viewport&&(y.viewport.scrollLeft=c(h,y.dir))}}):t==="vertical"?v.jsx(Ho,{...p,ref:e,onThumbPositionChange:()=>{if(y.viewport&&E.current){const h=y.viewport.scrollTop,f=qs(h,s);E.current.style.transform=`translate3d(0, ${f}px, 0)`}},onWheelScroll:h=>{y.viewport&&(y.viewport.scrollTop=h)},onDragScroll:h=>{y.viewport&&(y.viewport.scrollTop=c(h))}}):null}),jo=N.forwardRef((i,e)=>{const{sizes:t,onSizesChange:d,...y}=i,E=ge(Ce,i.__scopeScrollArea),[k,s]=N.useState(),a=N.useRef(null),u=Ke(e,a,E.onScrollbarXChange);return N.useEffect(()=>{a.current&&s(getComputedStyle(a.current))},[a]),v.jsx(ei,{"data-orientation":"horizontal",...y,ref:u,sizes:t,style:{bottom:0,left:E.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:E.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Mt(t)+"px",...i.style},onThumbPointerDown:p=>i.onThumbPointerDown(p.x),onDragScroll:p=>i.onDragScroll(p.x),onWheelScroll:(p,c)=>{if(E.viewport){const h=E.viewport.scrollLeft+p.deltaX;i.onWheelScroll(h),ni(h,c)&&p.preventDefault()}},onResize:()=>{a.current&&E.viewport&&k&&d({content:E.viewport.scrollWidth,viewport:E.viewport.offsetWidth,scrollbar:{size:a.current.clientWidth,paddingStart:kt(k.paddingLeft),paddingEnd:kt(k.paddingRight)}})}})}),Ho=N.forwardRef((i,e)=>{const{sizes:t,onSizesChange:d,...y}=i,E=ge(Ce,i.__scopeScrollArea),[k,s]=N.useState(),a=N.useRef(null),u=Ke(e,a,E.onScrollbarYChange);return N.useEffect(()=>{a.current&&s(getComputedStyle(a.current))},[a]),v.jsx(ei,{"data-orientation":"vertical",...y,ref:u,sizes:t,style:{top:0,right:E.dir==="ltr"?0:void 0,left:E.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Mt(t)+"px",...i.style},onThumbPointerDown:p=>i.onThumbPointerDown(p.y),onDragScroll:p=>i.onDragScroll(p.y),onWheelScroll:(p,c)=>{if(E.viewport){const h=E.viewport.scrollTop+p.deltaY;i.onWheelScroll(h),ni(h,c)&&p.preventDefault()}},onResize:()=>{a.current&&E.viewport&&k&&d({content:E.viewport.scrollHeight,viewport:E.viewport.offsetHeight,scrollbar:{size:a.current.clientHeight,paddingStart:kt(k.paddingTop),paddingEnd:kt(k.paddingBottom)}})}})}),[Fo,Qr]=Kr(Ce),ei=N.forwardRef((i,e)=>{const{__scopeScrollArea:t,sizes:d,hasThumb:y,onThumbChange:E,onThumbPointerUp:k,onThumbPointerDown:s,onThumbPositionChange:a,onDragScroll:u,onWheelScroll:p,onResize:c,...h}=i,f=ge(Ce,t),[S,_]=N.useState(null),n=Ke(e,C=>_(C)),o=N.useRef(null),r=N.useRef(""),l=f.viewport,m=d.content-d.viewport,w=Ae(p),b=Ae(a),x=It(c,10);function g(C){if(o.current){const T=C.clientX-o.current.left,A=C.clientY-o.current.top;u({x:T,y:A})}}return N.useEffect(()=>{const C=T=>{const A=T.target;S?.contains(A)&&w(T,m)};return document.addEventListener("wheel",C,{passive:!1}),()=>document.removeEventListener("wheel",C,{passive:!1})},[l,S,m,w]),N.useEffect(b,[d,b]),Ve(S,x),Ve(f.content,x),v.jsx(Fo,{scope:t,scrollbar:S,hasThumb:y,onThumbChange:Ae(E),onThumbPointerUp:Ae(k),onThumbPositionChange:b,onThumbPointerDown:Ae(s),children:v.jsx(xe.div,{...h,ref:n,style:{position:"absolute",...h.style},onPointerDown:Ne(i.onPointerDown,C=>{C.button===0&&(C.target.setPointerCapture(C.pointerId),o.current=S.getBoundingClientRect(),r.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),g(C))}),onPointerMove:Ne(i.onPointerMove,g),onPointerUp:Ne(i.onPointerUp,C=>{const T=C.target;T.hasPointerCapture(C.pointerId)&&T.releasePointerCapture(C.pointerId),document.body.style.webkitUserSelect=r.current,f.viewport&&(f.viewport.style.scrollBehavior=""),o.current=null})})})}),Et="ScrollAreaThumb",ti=N.forwardRef((i,e)=>{const{forceMount:t,...d}=i,y=Qr(Et,i.__scopeScrollArea);return v.jsx(Lt,{present:t||y.hasThumb,children:v.jsx(zo,{ref:e,...d})})}),zo=N.forwardRef((i,e)=>{const{__scopeScrollArea:t,style:d,...y}=i,E=ge(Et,t),k=Qr(Et,t),{onThumbPositionChange:s}=k,a=Ke(e,c=>k.onThumbChange(c)),u=N.useRef(void 0),p=It(()=>{u.current&&(u.current(),u.current=void 0)},100);return N.useEffect(()=>{const c=E.viewport;if(c){const h=()=>{if(p(),!u.current){const f=Uo(c,s);u.current=f,s()}};return s(),c.addEventListener("scroll",h),()=>c.removeEventListener("scroll",h)}},[E.viewport,p,s]),v.jsx(xe.div,{"data-state":k.hasThumb?"visible":"hidden",...y,ref:a,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...d},onPointerDownCapture:Ne(i.onPointerDownCapture,c=>{const f=c.target.getBoundingClientRect(),S=c.clientX-f.left,_=c.clientY-f.top;k.onThumbPointerDown({x:S,y:_})}),onPointerUp:Ne(i.onPointerUp,k.onThumbPointerUp)})});ti.displayName=Et;var Ss="ScrollAreaCorner",si=N.forwardRef((i,e)=>{const t=ge(Ss,i.__scopeScrollArea),d=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&d?v.jsx(Wo,{...i,ref:e}):null});si.displayName=Ss;var Wo=N.forwardRef((i,e)=>{const{__scopeScrollArea:t,...d}=i,y=ge(Ss,t),[E,k]=N.useState(0),[s,a]=N.useState(0),u=!!(E&&s);return Ve(y.scrollbarX,()=>{const p=y.scrollbarX?.offsetHeight||0;y.onCornerHeightChange(p),a(p)}),Ve(y.scrollbarY,()=>{const p=y.scrollbarY?.offsetWidth||0;y.onCornerWidthChange(p),k(p)}),u?v.jsx(xe.div,{...d,ref:e,style:{width:E,height:s,position:"absolute",right:y.dir==="ltr"?0:void 0,left:y.dir==="rtl"?0:void 0,bottom:0,...i.style}}):null});function kt(i){return i?parseInt(i,10):0}function ri(i,e){const t=i/e;return isNaN(t)?0:t}function Mt(i){const e=ri(i.viewport,i.content),t=i.scrollbar.paddingStart+i.scrollbar.paddingEnd,d=(i.scrollbar.size-t)*e;return Math.max(d,18)}function $o(i,e,t,d="ltr"){const y=Mt(t),E=y/2,k=e||E,s=y-k,a=t.scrollbar.paddingStart+k,u=t.scrollbar.size-t.scrollbar.paddingEnd-s,p=t.content-t.viewport,c=d==="ltr"?[0,p]:[p*-1,0];return ii([a,u],c)(i)}function qs(i,e,t="ltr"){const d=Mt(e),y=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,E=e.scrollbar.size-y,k=e.content-e.viewport,s=E-d,a=t==="ltr"?[0,k]:[k*-1,0],u=Mi(i,a);return ii([0,k],[0,s])(u)}function ii(i,e){return t=>{if(i[0]===i[1]||e[0]===e[1])return e[0];const d=(e[1]-e[0])/(i[1]-i[0]);return e[0]+d*(t-i[0])}}function ni(i,e){return i>0&&i<e}var Uo=(i,e=()=>{})=>{let t={left:i.scrollLeft,top:i.scrollTop},d=0;return function y(){const E={left:i.scrollLeft,top:i.scrollTop},k=t.left!==E.left,s=t.top!==E.top;(k||s)&&e(),t=E,d=window.requestAnimationFrame(y)}(),()=>window.cancelAnimationFrame(d)};function It(i,e){const t=Ae(i),d=N.useRef(0);return N.useEffect(()=>()=>window.clearTimeout(d.current),[]),N.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(t,e)},[t,e])}function Ve(i,e){const t=Ae(e);yt(()=>{let d=0;if(i){const y=new ResizeObserver(()=>{cancelAnimationFrame(d),d=window.requestAnimationFrame(t)});return y.observe(i),()=>{window.cancelAnimationFrame(d),y.unobserve(i)}}},[i,t])}var qo=Gr,Vo=Jr,Ko=si;function nt({className:i,children:e,...t}){return v.jsxs(qo,{"data-slot":"scroll-area",className:ne("relative",i),...t,children:[v.jsx(Vo,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:e}),v.jsx(Go,{}),v.jsx(Ko,{})]})}function Go({className:i,orientation:e="vertical",...t}){return v.jsx(Yr,{"data-slot":"scroll-area-scrollbar",orientation:e,className:ne("flex touch-none p-px transition-colors select-none",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",i),...t,children:v.jsx(ti,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function oi({className:i,...e}){return v.jsx(Ii,{"data-slot":"tabs",className:ne("flex flex-col gap-2",i),...e})}function Xo({className:i,...e}){return v.jsx(Ni,{"data-slot":"tabs-list",className:ne("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",i),...e})}function Vs({className:i,...e}){return v.jsx(Oi,{"data-slot":"tabs-trigger",className:ne("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",i),...e})}function Ks({className:i,...e}){return v.jsx(ji,{"data-slot":"tabs-content",className:ne("flex-1 outline-none",i),...e})}const Jo=ms("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function mt({className:i,variant:e,asChild:t=!1,...d}){const y=t?dr:"span";return v.jsx(y,{"data-slot":"badge",className:ne(Jo({variant:e}),i),...d})}function Yo({...i}){return v.jsx(ur,{"data-slot":"sheet",...i})}function Zo({...i}){return v.jsx(mr,{"data-slot":"sheet-portal",...i})}function Qo({className:i,...e}){return v.jsx(gr,{"data-slot":"sheet-overlay",className:ne("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",i),...e})}function ea({className:i,children:e,side:t="right",...d}){return v.jsxs(Zo,{children:[v.jsx(Qo,{}),v.jsxs(fr,{"data-slot":"sheet-content",className:ne("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",t==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",t==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",t==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",t==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",i),...d,children:[e,v.jsxs(_r,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[v.jsx(ot,{className:"size-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function ta({className:i,...e}){return v.jsx("div",{"data-slot":"sheet-header",className:ne("flex flex-col gap-1.5 p-4",i),...e})}function sa({className:i,...e}){return v.jsx(pr,{"data-slot":"sheet-title",className:ne("text-foreground font-semibold",i),...e})}function ra({className:i,...e}){return v.jsx("textarea",{"data-slot":"textarea",className:ne("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),...e})}function ue({className:i,...e}){return v.jsx("div",{"data-slot":"skeleton",className:ne("bg-accent animate-pulse rounded-md",i),...e})}function ia({className:i}){return v.jsxs("div",{className:`p-4 space-y-4 ${i||""}`,children:[v.jsxs("div",{className:"flex gap-2 mb-4",children:[v.jsx(ue,{className:"h-8 w-12"}),v.jsx(ue,{className:"h-8 w-16"}),v.jsx(ue,{className:"h-8 w-20"})]}),[...Array(3)].map((e,t)=>v.jsxs("div",{className:"border border-border/30 rounded-lg p-3 space-y-2",children:[v.jsx("div",{className:"flex items-start justify-between",children:v.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[v.jsx(ue,{className:"h-4 w-4 rounded mt-1"}),v.jsxs("div",{className:"flex-1 space-y-2",children:[v.jsx(ue,{className:"h-4 w-48"}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(ue,{className:"h-5 w-16 rounded-full"}),v.jsx(ue,{className:"h-4 w-20"})]}),v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx(ue,{className:"h-3 w-12"}),v.jsx(ue,{className:"h-3 w-16"}),v.jsx(ue,{className:"h-3 w-8"})]})]})]})}),t===0&&v.jsxs("div",{className:"mt-3 space-y-2",children:[v.jsxs("div",{className:"ml-6 p-2 rounded bg-primary/10",children:[v.jsx(ue,{className:"h-4 w-64 mb-1"}),v.jsx(ue,{className:"h-3 w-16"})]}),v.jsxs("div",{className:"mr-6 p-2 rounded bg-secondary/10",children:[v.jsx(ue,{className:"h-4 w-72 mb-1"}),v.jsx(ue,{className:"h-4 w-48 mb-1"}),v.jsx(ue,{className:"h-3 w-16"})]})]})]},t))]})}const we=Object.create(null);we.open="0";we.close="1";we.ping="2";we.pong="3";we.message="4";we.upgrade="5";we.noop="6";const gt=Object.create(null);Object.keys(we).forEach(i=>{gt[we[i]]=i});const rs={type:"error",data:"parser error"},ai=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",li=typeof ArrayBuffer=="function",ci=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,bs=({type:i,data:e},t,d)=>ai&&e instanceof Blob?t?d(e):Gs(e,d):li&&(e instanceof ArrayBuffer||ci(e))?t?d(e):Gs(new Blob([e]),d):d(we[i]+(e||"")),Gs=(i,e)=>{const t=new FileReader;return t.onload=function(){const d=t.result.split(",")[1];e("b"+(d||""))},t.readAsDataURL(i)};function Xs(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let qt;function na(i,e){if(ai&&i.data instanceof Blob)return i.data.arrayBuffer().then(Xs).then(e);if(li&&(i.data instanceof ArrayBuffer||ci(i.data)))return e(Xs(i.data));bs(i,!1,t=>{qt||(qt=new TextEncoder),e(qt.encode(t))})}const Js="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",st=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<Js.length;i++)st[Js.charCodeAt(i)]=i;const oa=i=>{let e=i.length*.75,t=i.length,d,y=0,E,k,s,a;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const u=new ArrayBuffer(e),p=new Uint8Array(u);for(d=0;d<t;d+=4)E=st[i.charCodeAt(d)],k=st[i.charCodeAt(d+1)],s=st[i.charCodeAt(d+2)],a=st[i.charCodeAt(d+3)],p[y++]=E<<2|k>>4,p[y++]=(k&15)<<4|s>>2,p[y++]=(s&3)<<6|a&63;return u},aa=typeof ArrayBuffer=="function",ys=(i,e)=>{if(typeof i!="string")return{type:"message",data:hi(i,e)};const t=i.charAt(0);return t==="b"?{type:"message",data:la(i.substring(1),e)}:gt[t]?i.length>1?{type:gt[t],data:i.substring(1)}:{type:gt[t]}:rs},la=(i,e)=>{if(aa){const t=oa(i);return hi(t,e)}else return{base64:!0,data:i}},hi=(i,e)=>{switch(e){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},di="",ca=(i,e)=>{const t=i.length,d=new Array(t);let y=0;i.forEach((E,k)=>{bs(E,!1,s=>{d[k]=s,++y===t&&e(d.join(di))})})},ha=(i,e)=>{const t=i.split(di),d=[];for(let y=0;y<t.length;y++){const E=ys(t[y],e);if(d.push(E),E.type==="error")break}return d};function da(){return new TransformStream({transform(i,e){na(i,t=>{const d=t.length;let y;if(d<126)y=new Uint8Array(1),new DataView(y.buffer).setUint8(0,d);else if(d<65536){y=new Uint8Array(3);const E=new DataView(y.buffer);E.setUint8(0,126),E.setUint16(1,d)}else{y=new Uint8Array(9);const E=new DataView(y.buffer);E.setUint8(0,127),E.setBigUint64(1,BigInt(d))}i.data&&typeof i.data!="string"&&(y[0]|=128),e.enqueue(y),e.enqueue(t)})}})}let Vt;function dt(i){return i.reduce((e,t)=>e+t.length,0)}function ut(i,e){if(i[0].length===e)return i.shift();const t=new Uint8Array(e);let d=0;for(let y=0;y<e;y++)t[y]=i[0][d++],d===i[0].length&&(i.shift(),d=0);return i.length&&d<i[0].length&&(i[0]=i[0].slice(d)),t}function ua(i,e){Vt||(Vt=new TextDecoder);const t=[];let d=0,y=-1,E=!1;return new TransformStream({transform(k,s){for(t.push(k);;){if(d===0){if(dt(t)<1)break;const a=ut(t,1);E=(a[0]&128)===128,y=a[0]&127,y<126?d=3:y===126?d=1:d=2}else if(d===1){if(dt(t)<2)break;const a=ut(t,2);y=new DataView(a.buffer,a.byteOffset,a.length).getUint16(0),d=3}else if(d===2){if(dt(t)<8)break;const a=ut(t,8),u=new DataView(a.buffer,a.byteOffset,a.length),p=u.getUint32(0);if(p>Math.pow(2,21)-1){s.enqueue(rs);break}y=p*Math.pow(2,32)+u.getUint32(4),d=3}else{if(dt(t)<y)break;const a=ut(t,y);s.enqueue(ys(E?a:Vt.decode(a),e)),d=0}if(y===0||y>i){s.enqueue(rs);break}}}})}const ui=4;function ce(i){if(i)return fa(i)}function fa(i){for(var e in ce.prototype)i[e]=ce.prototype[e];return i}ce.prototype.on=ce.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};ce.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};ce.prototype.off=ce.prototype.removeListener=ce.prototype.removeAllListeners=ce.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var d,y=0;y<t.length;y++)if(d=t[y],d===e||d.fn===e){t.splice(y,1);break}return t.length===0&&delete this._callbacks["$"+i],this};ce.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],d=1;d<arguments.length;d++)e[d-1]=arguments[d];if(t){t=t.slice(0);for(var d=0,y=t.length;d<y;++d)t[d].apply(this,e)}return this};ce.prototype.emitReserved=ce.prototype.emit;ce.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};ce.prototype.hasListeners=function(i){return!!this.listeners(i).length};const Nt=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),pe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),_a="arraybuffer";function fi(i,...e){return e.reduce((t,d)=>(i.hasOwnProperty(d)&&(t[d]=i[d]),t),{})}const pa=pe.setTimeout,ma=pe.clearTimeout;function Ot(i,e){e.useNativeTimers?(i.setTimeoutFn=pa.bind(pe),i.clearTimeoutFn=ma.bind(pe)):(i.setTimeoutFn=pe.setTimeout.bind(pe),i.clearTimeoutFn=pe.clearTimeout.bind(pe))}const ga=1.33;function va(i){return typeof i=="string"?Sa(i):Math.ceil((i.byteLength||i.size)*ga)}function Sa(i){let e=0,t=0;for(let d=0,y=i.length;d<y;d++)e=i.charCodeAt(d),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(d++,t+=4);return t}function _i(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function ba(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function ya(i){let e={},t=i.split("&");for(let d=0,y=t.length;d<y;d++){let E=t[d].split("=");e[decodeURIComponent(E[0])]=decodeURIComponent(E[1])}return e}class wa extends Error{constructor(e,t,d){super(e),this.description=t,this.context=d,this.type="TransportError"}}class ws extends ce{constructor(e){super(),this.writable=!1,Ot(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,d){return super.emitReserved("error",new wa(e,t,d)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=ys(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=ba(e);return t.length?"?"+t:""}}class xa extends ws{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let d=0;this._polling&&(d++,this.once("pollComplete",function(){--d||t()})),this.writable||(d++,this.once("drain",function(){--d||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=d=>{if(this.readyState==="opening"&&d.type==="open"&&this.onOpen(),d.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(d)};ha(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ca(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=_i()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let pi=!1;try{pi=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ca=pi;function Ea(){}class ka extends xa{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let d=location.port;d||(d=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||d!==e.port}}doWrite(e,t){const d=this.request({method:"POST",data:e});d.on("success",t),d.on("error",(y,E)=>{this.onError("xhr post error",y,E)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,d)=>{this.onError("xhr poll error",t,d)}),this.pollXhr=e}}class ye extends ce{constructor(e,t,d){super(),this.createRequest=e,Ot(this,d),this._opts=d,this._method=d.method||"GET",this._uri=t,this._data=d.data!==void 0?d.data:null,this._create()}_create(){var e;const t=fi(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const d=this._xhr=this.createRequest(t);try{d.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){d.setDisableHeaderCheck&&d.setDisableHeaderCheck(!0);for(let y in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(y)&&d.setRequestHeader(y,this._opts.extraHeaders[y])}}catch{}if(this._method==="POST")try{d.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{d.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(d),"withCredentials"in d&&(d.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(d.timeout=this._opts.requestTimeout),d.onreadystatechange=()=>{var y;d.readyState===3&&((y=this._opts.cookieJar)===null||y===void 0||y.parseCookies(d.getResponseHeader("set-cookie"))),d.readyState===4&&(d.status===200||d.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof d.status=="number"?d.status:0)},0))},d.send(this._data)}catch(y){this.setTimeoutFn(()=>{this._onError(y)},0);return}typeof document<"u"&&(this._index=ye.requestsCount++,ye.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Ea,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ye.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ye.requestsCount=0;ye.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ys);else if(typeof addEventListener=="function"){const i="onpagehide"in pe?"pagehide":"unload";addEventListener(i,Ys,!1)}}function Ys(){for(let i in ye.requests)ye.requests.hasOwnProperty(i)&&ye.requests[i].abort()}const Ra=function(){const i=mi({xdomain:!1});return i&&i.responseType!==null}();class La extends ka{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Ra&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ye(mi,this.uri(),e)}}function mi(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Ca))return new XMLHttpRequest}catch{}if(!e)try{return new pe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const gi=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Aa extends ws{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,d=gi?{}:fi(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(d.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,d)}catch(y){return this.emitReserved("error",y)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const d=e[t],y=t===e.length-1;bs(d,this.supportsBinary,E=>{try{this.doWrite(d,E)}catch{}y&&Nt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=_i()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Kt=pe.WebSocket||pe.MozWebSocket;class Da extends Aa{createSocket(e,t,d){return gi?new Kt(e,t,d):t?new Kt(e,t):new Kt(e)}doWrite(e,t){this.ws.send(t)}}class Ta extends ws{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=ua(Number.MAX_SAFE_INTEGER,this.socket.binaryType),d=e.readable.pipeThrough(t).getReader(),y=da();y.readable.pipeTo(e.writable),this._writer=y.writable.getWriter();const E=()=>{d.read().then(({done:s,value:a})=>{s||(this.onPacket(a),E())}).catch(s=>{})};E();const k={type:"open"};this.query.sid&&(k.data=`{"sid":"${this.query.sid}"}`),this._writer.write(k).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const d=e[t],y=t===e.length-1;this._writer.write(d).then(()=>{y&&Nt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Pa={websocket:Da,webtransport:Ta,polling:La},Ba=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ma=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function is(i){if(i.length>8e3)throw"URI too long";const e=i,t=i.indexOf("["),d=i.indexOf("]");t!=-1&&d!=-1&&(i=i.substring(0,t)+i.substring(t,d).replace(/:/g,";")+i.substring(d,i.length));let y=Ba.exec(i||""),E={},k=14;for(;k--;)E[Ma[k]]=y[k]||"";return t!=-1&&d!=-1&&(E.source=e,E.host=E.host.substring(1,E.host.length-1).replace(/;/g,":"),E.authority=E.authority.replace("[","").replace("]","").replace(/;/g,":"),E.ipv6uri=!0),E.pathNames=Ia(E,E.path),E.queryKey=Na(E,E.query),E}function Ia(i,e){const t=/\/{2,9}/g,d=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&d.splice(0,1),e.slice(-1)=="/"&&d.splice(d.length-1,1),d}function Na(i,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(d,y,E){y&&(t[y]=E)}),t}const ns=typeof addEventListener=="function"&&typeof removeEventListener=="function",vt=[];ns&&addEventListener("offline",()=>{vt.forEach(i=>i())},!1);class Be extends ce{constructor(e,t){if(super(),this.binaryType=_a,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const d=is(e);t.hostname=d.host,t.secure=d.protocol==="https"||d.protocol==="wss",t.port=d.port,d.query&&(t.query=d.query)}else t.host&&(t.hostname=is(t.host).host);Ot(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(d=>{const y=d.prototype.name;this.transports.push(y),this._transportsByName[y]=d}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ya(this.opts.query)),ns&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},vt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=ui,t.transport=e,this.id&&(t.sid=this.id);const d=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](d)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Be.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Be.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let d=0;d<this.writeBuffer.length;d++){const y=this.writeBuffer[d].data;if(y&&(t+=va(y)),d>0&&t>this._maxPayload)return this.writeBuffer.slice(0,d);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Nt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,d){return this._sendPacket("message",e,t,d),this}send(e,t,d){return this._sendPacket("message",e,t,d),this}_sendPacket(e,t,d,y){if(typeof t=="function"&&(y=t,t=void 0),typeof d=="function"&&(y=d,d=null),this.readyState==="closing"||this.readyState==="closed")return;d=d||{},d.compress=d.compress!==!1;const E={type:e,data:t,options:d};this.emitReserved("packetCreate",E),this.writeBuffer.push(E),y&&this.once("flush",y),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},d=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?d():e()}):this.upgrading?d():e()),this}_onError(e){if(Be.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ns&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const d=vt.indexOf(this._offlineEventListener);d!==-1&&vt.splice(d,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Be.protocol=ui;class Oa extends Be{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),d=!1;Be.priorWebsocketSuccess=!1;const y=()=>{d||(t.send([{type:"ping",data:"probe"}]),t.once("packet",c=>{if(!d)if(c.type==="pong"&&c.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Be.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{d||this.readyState!=="closed"&&(p(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=t.name,this.emitReserved("upgradeError",h)}}))};function E(){d||(d=!0,p(),t.close(),t=null)}const k=c=>{const h=new Error("probe error: "+c);h.transport=t.name,E(),this.emitReserved("upgradeError",h)};function s(){k("transport closed")}function a(){k("socket closed")}function u(c){t&&c.name!==t.name&&E()}const p=()=>{t.removeListener("open",y),t.removeListener("error",k),t.removeListener("close",s),this.off("close",a),this.off("upgrading",u)};t.once("open",y),t.once("error",k),t.once("close",s),this.once("close",a),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{d||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let d=0;d<e.length;d++)~this.transports.indexOf(e[d])&&t.push(e[d]);return t}}let ja=class extends Oa{constructor(e,t={}){const d=typeof e=="object"?e:t;(!d.transports||d.transports&&typeof d.transports[0]=="string")&&(d.transports=(d.transports||["polling","websocket","webtransport"]).map(y=>Pa[y]).filter(y=>!!y)),super(e,d)}};function Ha(i,e="",t){let d=i;t=t||typeof location<"u"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t<"u"?i=t.protocol+"//"+i:i="https://"+i),d=is(i)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/";const E=d.host.indexOf(":")!==-1?"["+d.host+"]":d.host;return d.id=d.protocol+"://"+E+":"+d.port+e,d.href=d.protocol+"://"+E+(t&&t.port===d.port?"":":"+d.port),d}const Fa=typeof ArrayBuffer=="function",za=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,vi=Object.prototype.toString,Wa=typeof Blob=="function"||typeof Blob<"u"&&vi.call(Blob)==="[object BlobConstructor]",$a=typeof File=="function"||typeof File<"u"&&vi.call(File)==="[object FileConstructor]";function xs(i){return Fa&&(i instanceof ArrayBuffer||za(i))||Wa&&i instanceof Blob||$a&&i instanceof File}function St(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,d=i.length;t<d;t++)if(St(i[t]))return!0;return!1}if(xs(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return St(i.toJSON(),!0);for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&St(i[t]))return!0;return!1}function Ua(i){const e=[],t=i.data,d=i;return d.data=os(t,e),d.attachments=e.length,{packet:d,buffers:e}}function os(i,e){if(!i)return i;if(xs(i)){const t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){const t=new Array(i.length);for(let d=0;d<i.length;d++)t[d]=os(i[d],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){const t={};for(const d in i)Object.prototype.hasOwnProperty.call(i,d)&&(t[d]=os(i[d],e));return t}return i}function qa(i,e){return i.data=as(i.data,e),delete i.attachments,i}function as(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=as(i[t],e);else if(typeof i=="object")for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=as(i[t],e));return i}const Va=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ka=5;var te;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(te||(te={}));class Ga{constructor(e){this.replacer=e}encode(e){return(e.type===te.EVENT||e.type===te.ACK)&&St(e)?this.encodeAsBinary({type:e.type===te.EVENT?te.BINARY_EVENT:te.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===te.BINARY_EVENT||e.type===te.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ua(e),d=this.encodeAsString(t.packet),y=t.buffers;return y.unshift(d),y}}function Zs(i){return Object.prototype.toString.call(i)==="[object Object]"}class Cs extends ce{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const d=t.type===te.BINARY_EVENT;d||t.type===te.BINARY_ACK?(t.type=d?te.EVENT:te.ACK,this.reconstructor=new Xa(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(xs(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const d={type:Number(e.charAt(0))};if(te[d.type]===void 0)throw new Error("unknown packet type "+d.type);if(d.type===te.BINARY_EVENT||d.type===te.BINARY_ACK){const E=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const k=e.substring(E,t);if(k!=Number(k)||e.charAt(t)!=="-")throw new Error("Illegal attachments");d.attachments=Number(k)}if(e.charAt(t+1)==="/"){const E=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););d.nsp=e.substring(E,t)}else d.nsp="/";const y=e.charAt(t+1);if(y!==""&&Number(y)==y){const E=t+1;for(;++t;){const k=e.charAt(t);if(k==null||Number(k)!=k){--t;break}if(t===e.length)break}d.id=Number(e.substring(E,t+1))}if(e.charAt(++t)){const E=this.tryParse(e.substr(t));if(Cs.isPayloadValid(d.type,E))d.data=E;else throw new Error("invalid payload")}return d}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case te.CONNECT:return Zs(t);case te.DISCONNECT:return t===void 0;case te.CONNECT_ERROR:return typeof t=="string"||Zs(t);case te.EVENT:case te.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Va.indexOf(t[0])===-1);case te.ACK:case te.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Xa{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=qa(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ja=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Cs,Encoder:Ga,get PacketType(){return te},protocol:Ka},Symbol.toStringTag,{value:"Module"}));function ve(i,e,t){return i.on(e,t),function(){i.off(e,t)}}const Ya=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Si extends ce{constructor(e,t,d){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,d&&d.auth&&(this.auth=d.auth),this._opts=Object.assign({},d),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ve(e,"open",this.onopen.bind(this)),ve(e,"packet",this.onpacket.bind(this)),ve(e,"error",this.onerror.bind(this)),ve(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var d,y,E;if(Ya.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const k={type:te.EVENT,data:t};if(k.options={},k.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const p=this.ids++,c=t.pop();this._registerAckCallback(p,c),k.id=p}const s=(y=(d=this.io.engine)===null||d===void 0?void 0:d.transport)===null||y===void 0?void 0:y.writable,a=this.connected&&!(!((E=this.io.engine)===null||E===void 0)&&E._hasPingExpired());return this.flags.volatile&&!s||(a?(this.notifyOutgoingListeners(k),this.packet(k)):this.sendBuffer.push(k)),this.flags={},this}_registerAckCallback(e,t){var d;const y=(d=this.flags.timeout)!==null&&d!==void 0?d:this._opts.ackTimeout;if(y===void 0){this.acks[e]=t;return}const E=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},y),k=(...s)=>{this.io.clearTimeoutFn(E),t.apply(this,s)};k.withError=!0,this.acks[e]=k}emitWithAck(e,...t){return new Promise((d,y)=>{const E=(k,s)=>k?y(k):d(s);E.withError=!0,t.push(E),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const d={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((y,...E)=>d!==this._queue[0]?void 0:(y!==null?d.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(y)):(this._queue.shift(),t&&t(null,...E)),d.pending=!1,this._drainQueue())),this._queue.push(d),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:te.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(d=>String(d.id)===e)){const d=this.acks[e];delete this.acks[e],d.withError&&d.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case te.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case te.EVENT:case te.BINARY_EVENT:this.onevent(e);break;case te.ACK:case te.BINARY_ACK:this.onack(e);break;case te.DISCONNECT:this.ondisconnect();break;case te.CONNECT_ERROR:this.destroy();const d=new Error(e.data.message);d.data=e.data.data,this.emitReserved("connect_error",d);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const d of t)d.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let d=!1;return function(...y){d||(d=!0,t.packet({type:te.ACK,id:e,data:y}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:te.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let d=0;d<t.length;d++)if(e===t[d])return t.splice(d,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let d=0;d<t.length;d++)if(e===t[d])return t.splice(d,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const d of t)d.apply(this,e.data)}}}function Ge(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}Ge.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=(Math.floor(e*10)&1)==0?i-t:i+t}return Math.min(i,this.max)|0};Ge.prototype.reset=function(){this.attempts=0};Ge.prototype.setMin=function(i){this.ms=i};Ge.prototype.setMax=function(i){this.max=i};Ge.prototype.setJitter=function(i){this.jitter=i};class ls extends ce{constructor(e,t){var d;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Ot(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((d=t.randomizationFactor)!==null&&d!==void 0?d:.5),this.backoff=new Ge({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const y=t.parser||Ja;this.encoder=new y.Encoder,this.decoder=new y.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ja(this.uri,this.opts);const t=this.engine,d=this;this._readyState="opening",this.skipReconnect=!1;const y=ve(t,"open",function(){d.onopen(),e&&e()}),E=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),e?e(s):this.maybeReconnectOnOpen()},k=ve(t,"error",E);if(this._timeout!==!1){const s=this._timeout,a=this.setTimeoutFn(()=>{y(),E(new Error("timeout")),t.close()},s);this.opts.autoUnref&&a.unref(),this.subs.push(()=>{this.clearTimeoutFn(a)})}return this.subs.push(y),this.subs.push(k),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ve(e,"ping",this.onping.bind(this)),ve(e,"data",this.ondata.bind(this)),ve(e,"error",this.onerror.bind(this)),ve(e,"close",this.onclose.bind(this)),ve(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Nt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let d=this.nsps[e];return d?this._autoConnect&&!d.active&&d.connect():(d=new Si(this,e,t),this.nsps[e]=d),d}_destroy(e){const t=Object.keys(this.nsps);for(const d of t)if(this.nsps[d].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let d=0;d<t.length;d++)this.engine.write(t[d],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var d;this.cleanup(),(d=this.engine)===null||d===void 0||d.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const d=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(y=>{y?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",y)):e.onreconnect()}))},t);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Qe={};function bt(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const t=Ha(i,e.path||"/socket.io"),d=t.source,y=t.id,E=t.path,k=Qe[y]&&E in Qe[y].nsps,s=e.forceNew||e["force new connection"]||e.multiplex===!1||k;let a;return s?a=new ls(d,e):(Qe[y]||(Qe[y]=new ls(d,e)),a=Qe[y]),t.query&&!e.query&&(e.query=t.queryKey),a.socket(t.path,e)}Object.assign(bt,{Manager:ls,Socket:Si,io:bt,connect:bt});const Za={},Qa=()=>Za?.VITE_WS_URL||"ws://localhost:8080";class el{socket=null;eventListeners={};reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;messageQueue=[];isConnecting=!1;terminalSessions=new Map;connect(e){if(!(this.socket?.connected||this.isConnecting)){this.isConnecting=!0;try{const d=(e||Qa()).replace("ws://","http://").replace("wss://","https://");console.log(`Connecting to WebSocket server: ${d}`),this.socket=bt(d,{transports:["websocket"],path:"/ws",timeout:2e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:this.reconnectDelay}),this.setupEventListeners()}catch(t){console.error("Failed to connect to WebSocket server:",t),this.emit("error","Failed to connect to server"),this.isConnecting=!1}}}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("Connected to server"),this.isConnecting=!1,this.reconnectAttempts=0,this.processMessageQueue(),this.emit("connected")}),this.socket.on("disconnect",e=>{console.log("Disconnected from server:",e),this.emit("disconnected")}),this.socket.on("connect_error",e=>{console.error("Connection error:",e),this.handleReconnect()}),this.socket.on("message",e=>{try{const t=typeof e=="string"?JSON.parse(e):e;switch(t.type){case"message":this.emit("message",t.payload);break;case"code_stream":this.emit("code_stream",t.payload);break;case"agent_update":this.emit("agent_update",t.payload);break;case"file_tree_update":this.emit("file_tree_update",t.payload);break;case"project_status":this.emit("project_status",t.payload);break;case"terminal_data":this.emit("terminal_data",t.payload);break;case"terminal_session":this.handleTerminalSession(t.payload);break;case"wave_progress":this.emit("wave_progress",t.payload);break;case"llm_config_update":this.emit("llm_config_update",t.payload);break;case"llm_stream":this.emit("llm_stream",t.payload);break;case"agent_hierarchy":this.emit("agent_hierarchy",t.payload);break;case"token_usage":this.emit("token_usage",t.payload);break;default:console.warn("Unknown message type:",t.type)}}catch(t){console.error("Error parsing message:",t)}}),this.socket.on("error",e=>{console.error("WebSocket error:",e),this.emit("error",e.message||"WebSocket error occurred")}))}handleReconnect(){if(this.isConnecting=!1,this.reconnectAttempts++,this.reconnectAttempts>=this.maxReconnectAttempts){this.emit("error","Failed to connect after multiple attempts");return}setTimeout(()=>{console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connect()},this.reconnectDelay*this.reconnectAttempts)}processMessageQueue(){for(;this.messageQueue.length>0&&this.socket?.connected;){const e=this.messageQueue.shift();e&&this.socket.send(JSON.stringify(e))}}handleTerminalSession(e){this.terminalSessions.set(e.sessionId,e),this.emit("terminal_session",e)}sendPrompt(e,t="root"){const d={type:"prompt",payload:{prompt:e,agentId:t}};this.socket?.connected?this.socket.send(JSON.stringify(d)):(this.messageQueue.push({event:"prompt",data:d}),this.emit("error","Not connected to server. Message queued."))}selectFile(e){const t={type:"file_select",payload:{filePath:e}};this.socket?.connected&&this.socket.send(JSON.stringify(t))}createTerminalSession(e){const t={type:"terminal_create",payload:{projectId:e}};this.socket?.connected?this.socket.send(JSON.stringify(t)):this.messageQueue.push({event:"terminal_create",data:t})}sendTerminalData(e,t){const d={type:"terminal_data",payload:{sessionId:e,data:t}};this.socket?.connected&&this.socket.send(JSON.stringify(d))}resizeTerminal(e,t,d){const y={type:"terminal_resize",payload:{sessionId:e,cols:t,rows:d}};this.socket?.connected&&this.socket.send(JSON.stringify(y))}closeTerminal(e){const t={type:"terminal_close",payload:{sessionId:e}};this.socket?.connected&&this.socket.send(JSON.stringify(t)),this.terminalSessions.delete(e)}getTerminalSession(e){return this.terminalSessions.get(e)}configureLLM(e){try{const t={type:"llm_config",payload:e};this.socket?.connected?this.socket.send(JSON.stringify(t)):(this.messageQueue.push({event:"llm_config",data:t}),this.emit("error","Not connected to server. Configuration queued."))}catch(t){console.error("Error configuring LLM:",t),this.emit("error","Failed to configure LLM")}}setModel(e){try{const t={type:"set_model",payload:{model:e}};this.socket?.connected?this.socket.send(JSON.stringify(t)):this.emit("error","Not connected to server. Please connect first.")}catch(t){console.error("Error setting model:",t),this.emit("error","Failed to set model")}}setApiKey(e,t){try{if(!e||!t){this.emit("error","Invalid API key or provider");return}const d={type:"set_api_key",payload:{provider:e,apiKey:t}};this.socket?.connected?this.socket.send(JSON.stringify(d)):this.emit("error","Not connected to server. Please connect first.")}catch(d){console.error("Error setting API key:",d),this.emit("error","Failed to set API key")}}requestAgentHierarchy(){const e={type:"get_agent_hierarchy",payload:{}};this.socket?.connected&&this.socket.send(JSON.stringify(e))}on(e,t){this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t)}off(e,t){if(this.eventListeners[e])if(t){const d=this.eventListeners[e].indexOf(t);d>-1&&this.eventListeners[e].splice(d,1)}else this.eventListeners[e]=[]}emit(e,...t){const d=this.eventListeners[e];d&&d.forEach(y=>{try{y(...t)}catch(E){console.error(`Error in event listener for ${e}:`,E)}})}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.messageQueue=[],this.isConnecting=!1}isConnected(){return this.socket?.connected||!1}getConnectionStatus(){return this.socket?.connected?"connected":this.isConnecting?"connecting":"disconnected"}}const de=new el;function tl({onNewChat:i,messages:e=[],isConnected:t=!1,onMessagesUpdate:d,isLoading:y=!1,onLoadingChange:E}){const[k,s]=N.useState([]),[a,u]=N.useState(null),[p,c]=N.useState(!1),[h,f]=N.useState(0),[S,_]=N.useState(""),[n,o]=N.useState(!0),r=N.useRef(null),l=N.useRef(new Map);N.useEffect(()=>{const A=new Map;e.forEach(B=>{if(!B.threadId)return;A.has(B.threadId)||A.set(B.threadId,{taskId:B.threadId,summary:`Task ${B.threadId}`,agentName:B.agentId||"Agent",agentState:"working",createdAt:new Date().toISOString(),lastActivity:B.timestamp,messageCount:0,errorCount:0,hasUnread:!1,isCollapsed:!0,messages:[]});const D=A.get(B.threadId);D.messages.push({id:B.id,threadId:B.threadId,text:B.text,timestamp:B.timestamp,sender:B.sender==="user"?"user":"assistant",type:"normal",isRead:!1}),D.messageCount++,D.lastActivity=B.timestamp}),s(Array.from(A.values())),o(!1)},[e]),N.useEffect(()=>{const A=localStorage.getItem("threadCollapseStates");if(A){const B=JSON.parse(A);s(D=>D.map(j=>({...j,isCollapsed:B[j.taskId]??j.isCollapsed})))}},[]);const m=N.useCallback(A=>{const B={};A.forEach(D=>{B[D.taskId]=D.isCollapsed}),localStorage.setItem("threadCollapseStates",JSON.stringify(B))},[]),w=A=>{const B={idle:"bg-gray-500/20 text-gray-300 border-gray-500/30",working:"bg-blue-500/20 text-blue-300 border-blue-500/30",error:"bg-red-500/20 text-red-300 border-red-500/30",complete:"bg-green-500/20 text-green-300 border-green-500/30"},j={idle:yr,working:Er,error:Pe,complete:ts}[A];return v.jsxs(mt,{variant:"outline",className:`${B[A]} text-xs px-2 py-0.5 flex items-center gap-1`,children:[v.jsx(j,{className:`h-3 w-3 ${A==="working"?"animate-spin":""}`}),A]})},b=A=>{const B=new Date(A),j=new Date().getTime()-B.getTime(),W=Math.floor(j/6e4),U=Math.floor(j/36e5);return W<1?"now":W<60?`${W}m`:U<24?`${U}h`:B.toLocaleDateString()},x=N.useCallback(A=>{s(B=>{const D=B.map(j=>j.taskId===A?{...j,isCollapsed:!j.isCollapsed,hasUnread:!1}:j);return m(D),D})},[m]),g=N.useCallback(A=>{u(A),c(!0),_("")},[]);N.useEffect(()=>{const A=B=>{if(r.current?.contains(document.activeElement))switch(B.key){case"ArrowDown":B.preventDefault(),f(D=>Math.min(D+1,k.length-1));break;case"ArrowUp":B.preventDefault(),f(D=>Math.max(D-1,0));break;case"ArrowRight":B.preventDefault(),k[h]?.isCollapsed&&x(k[h].taskId);break;case"ArrowLeft":B.preventDefault(),k[h]&&!k[h].isCollapsed&&x(k[h].taskId);break;case"Enter":B.preventDefault(),k[h]&&g(k[h].taskId);break}};return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[h,k,x,g]);const C=()=>{if(!S.trim()||!a)return;t&&de.sendPrompt(S,a||"root");const A={id:`msg-${Date.now()}`,text:S,timestamp:new Date().toISOString(),sender:"user",threadId:a};d&&d([...e,A]),s(B=>B.map(D=>D.taskId===a?{...D,messages:[...D.messages,{id:A.id,threadId:a,text:S,timestamp:A.timestamp,sender:"user",type:"normal",isRead:!0}],messageCount:D.messageCount+1,lastActivity:A.timestamp,agentState:"working"}:D)),_(""),c(!1)},T=k.find(A=>A.taskId===a);return n||y?v.jsxs("div",{className:"h-full flex flex-col",children:[v.jsxs("div",{className:"p-4 flex items-center gap-2",children:[v.jsx(At,{className:"h-4 w-4 animate-spin text-primary"}),v.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading tasks..."})]}),v.jsx(ia,{})]}):k.length===0?v.jsx("div",{className:"h-full flex items-center justify-center",children:v.jsxs("div",{className:"text-center text-muted-foreground",children:[v.jsx(wt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),v.jsx("p",{className:"text-sm",children:"No active tasks"})]})}):v.jsxs("div",{ref:r,className:"h-full flex flex-col",role:"tree","aria-label":"Task threads",tabIndex:0,children:[v.jsx("div",{className:"flex-1",children:v.jsx(nt,{className:"h-full",children:v.jsx("div",{className:"p-2 space-y-2",children:k.map((A,B)=>v.jsxs("div",{ref:D=>{D&&l.current.set(A.taskId,D)},role:"group","aria-expanded":!A.isCollapsed,"aria-label":`Task: ${A.summary}`,className:`border border-border/30 rounded-lg transition-all duration-200 ${B===h?"ring-2 ring-primary/50":""}`,children:[v.jsx("div",{className:"p-3 cursor-pointer hover:bg-secondary/10 transition-colors",onClick:()=>x(A.taskId),onDoubleClick:()=>g(A.taskId),role:"article",tabIndex:0,children:v.jsx("div",{className:"flex items-start justify-between",children:v.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[v.jsx("div",{className:"flex-shrink-0 mt-1",children:A.isCollapsed?v.jsx(ts,{className:"h-4 w-4 text-muted-foreground"}):v.jsx(br,{className:"h-4 w-4 text-muted-foreground"})}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[v.jsx("h3",{className:"text-sm font-medium text-foreground truncate",children:A.summary}),A.hasUnread&&v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full flex-shrink-0"})]}),v.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[w(A.agentState),v.jsx("span",{className:"text-xs text-muted-foreground",children:A.agentName})]}),v.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[v.jsxs("span",{className:"flex items-center gap-1",children:[v.jsx(wt,{className:"h-3 w-3"}),A.messageCount," msgs"]}),A.errorCount>0&&v.jsxs("span",{className:"flex items-center gap-1 text-red-400",children:[v.jsx(Pe,{className:"h-3 w-3"}),A.errorCount," errors"]}),v.jsx("span",{children:b(A.lastActivity)})]})]})]})})}),!A.isCollapsed&&v.jsx("div",{className:"border-t border-border/20",children:v.jsx("div",{className:"p-3 space-y-2 max-h-64 overflow-y-auto",children:A.messages.map(D=>v.jsx("div",{className:`p-2 rounded text-sm ${D.sender==="user"?"bg-primary/10 text-primary-foreground ml-6":D.type==="error"?"bg-red-500/10 text-red-300 border border-red-500/20":"bg-secondary/10 text-secondary-foreground mr-6"}`,children:v.jsxs("div",{className:"flex items-start justify-between gap-2",children:[v.jsx("p",{className:"flex-1",children:D.text}),v.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:b(D.timestamp)})]})},D.id))})})]},A.taskId))})})}),v.jsx(Yo,{open:p,onOpenChange:c,children:v.jsxs(ea,{side:"right",className:"w-[500px] sm:w-[600px]",children:[v.jsx(ta,{children:v.jsxs(sa,{className:"flex items-center gap-2",children:[T?.summary,T&&w(T.agentState)]})}),T&&v.jsxs("div",{className:"mt-6 space-y-4",children:[v.jsx("div",{className:"p-4 bg-secondary/10 rounded-lg",children:v.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[v.jsxs("div",{children:[v.jsx("span",{className:"text-muted-foreground",children:"Agent:"}),v.jsx("span",{className:"ml-2",children:T.agentName})]}),v.jsxs("div",{children:[v.jsx("span",{className:"text-muted-foreground",children:"Created:"}),v.jsx("span",{className:"ml-2",children:b(T.createdAt)})]}),v.jsxs("div",{children:[v.jsx("span",{className:"text-muted-foreground",children:"Messages:"}),v.jsx("span",{className:"ml-2",children:T.messageCount})]}),v.jsxs("div",{children:[v.jsx("span",{className:"text-muted-foreground",children:"Errors:"}),v.jsx("span",{className:"ml-2 text-red-400",children:T.errorCount})]})]})}),v.jsxs("div",{children:[v.jsx("h4",{className:"font-medium mb-2",children:"Full Conversation"}),v.jsx(nt,{className:"h-64 border border-border/30 rounded-lg",children:v.jsx("div",{className:"p-3 space-y-3",children:T.messages.map(A=>v.jsxs("div",{className:`p-3 rounded-lg ${A.sender==="user"?"bg-primary/10 text-primary-foreground":A.type==="error"?"bg-red-500/10 text-red-300 border border-red-500/20":"bg-secondary/10 text-secondary-foreground"}`,children:[v.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[v.jsx("span",{className:"text-xs font-medium",children:A.sender==="user"?"You":T.agentName}),v.jsx("span",{className:"text-xs text-muted-foreground",children:b(A.timestamp)})]}),v.jsx("p",{className:"text-sm",children:A.text})]},A.id))})})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"font-medium mb-2",children:"Re-prompt"}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(ra,{value:S,onChange:A=>_(A.target.value),placeholder:"Add additional instructions or corrections...",className:"min-h-24 resize-none"}),v.jsxs("div",{className:"flex gap-2",children:[v.jsx(ie,{onClick:C,disabled:!S.trim(),className:"minimalist-button",children:"Send Re-prompt"}),v.jsx(ie,{variant:"outline",onClick:()=>c(!1),className:"minimalist-button",children:"Cancel"})]})]})]})]})]})})]})}function sl({messages:i,onNewChat:e,isConnected:t=!1,onMessagesUpdate:d,isLoading:y=!1,onLoadingChange:E}){const[k,s]=N.useState("chat"),a=N.useRef(null);N.useEffect(()=>{a.current?.scrollIntoView({behavior:"smooth"})},[i]);const u=f=>{const S=new Date(f),n=new Date().getTime()-S.getTime(),o=Math.floor(n/6e4),r=Math.floor(n/36e5);return o<1?"now":o<60?`${o}m`:r<24?`${r}h`:S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},p=i.length;return v.jsx("div",{className:"h-full flex flex-col",children:v.jsxs(oi,{value:k,onValueChange:s,className:"h-full flex flex-col",children:[v.jsx("div",{className:"flex-shrink-0 px-4 pt-4 pb-2 border-b border-border min-h-[60px]",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex gap-2",children:[v.jsxs(ie,{variant:k==="chat"?"secondary":"ghost",size:"sm",onClick:()=>s("chat"),className:"h-8 px-3",children:[v.jsx(wt,{className:"h-3 w-3 mr-2"}),"Chat",p>0&&v.jsx("span",{className:"bg-muted text-muted-foreground text-xs px-1.5 py-0.5 rounded ml-2",children:p})]}),v.jsxs(ie,{variant:k==="tasks"?"secondary":"ghost",size:"sm",onClick:()=>s("tasks"),className:"h-8 px-3",children:[v.jsx(_t,{className:"h-3 w-3 mr-2"}),"Tasks",v.jsx("span",{className:"bg-muted text-muted-foreground text-xs px-1.5 py-0.5 rounded ml-2",children:3})]}),v.jsxs(ie,{variant:k==="logs"?"secondary":"ghost",size:"sm",onClick:()=>s("logs"),className:"h-8 px-3",children:[v.jsx(Pe,{className:"h-3 w-3 mr-2"}),"Logs",v.jsx("span",{className:"bg-destructive/20 text-destructive text-xs px-1.5 py-0.5 rounded ml-2",children:2})]})]}),v.jsx(ie,{variant:"ghost",size:"sm",onClick:e,className:"minimalist-button",children:v.jsx(Cr,{className:"h-4 w-4"})})]})}),v.jsxs("div",{className:"flex-1 min-h-0",children:[k==="chat"&&v.jsx("div",{className:"h-full overflow-hidden",children:v.jsx(nt,{className:"h-full",children:v.jsx("div",{className:"px-4 py-2",children:i.length===0?v.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:v.jsxs("div",{className:"text-center",children:[v.jsx(wt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),v.jsx("p",{className:"text-body",children:"Start a conversation with Colony AI"})]})}):v.jsxs("div",{className:"space-y-4",children:[i.map(f=>v.jsxs("div",{className:"flex items-start gap-3 py-2",children:[v.jsx("div",{className:"flex-shrink-0 mt-1",children:f.sender==="user"?v.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 border border-primary/20 flex items-center justify-center",children:v.jsx(Qn,{className:"h-3 w-3 text-primary"})}):v.jsx("div",{className:"w-6 h-6 rounded-full bg-secondary/10 border border-border flex items-center justify-center",children:v.jsx(Zi,{className:"h-3 w-3 text-foreground"})})}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[v.jsx("span",{className:"text-tab font-medium",children:f.sender==="user"?"You":"Colony AI"}),v.jsx("span",{className:"text-xs text-muted-foreground",children:u(f.timestamp)})]}),v.jsx("div",{className:"text-body text-foreground leading-relaxed",children:f.text})]})]},f.id)),v.jsx("div",{ref:a})]})})})}),k==="tasks"&&v.jsx("div",{className:"h-full overflow-hidden",children:v.jsx(tl,{onNewChat:e,messages:i,isConnected:t,onMessagesUpdate:d,isLoading:y,onLoadingChange:E})}),k==="logs"&&v.jsx("div",{className:"h-full overflow-hidden",children:v.jsx(nt,{className:"h-full",children:v.jsxs("div",{className:"px-4 py-2 space-y-3",children:[v.jsxs("div",{className:"flex items-start gap-3 py-2 border-l-2 border-l-destructive pl-3",children:[v.jsx(Pe,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[v.jsx("span",{className:"text-tab font-medium text-destructive",children:"Error"}),v.jsx("span",{className:"text-xs text-muted-foreground",children:"2m ago"})]}),v.jsx("p",{className:"text-body text-destructive",children:"Failed to connect to database: Connection timeout"})]})]}),v.jsxs("div",{className:"flex items-start gap-3 py-2 border-l-2 border-l-yellow-500 pl-3",children:[v.jsx(Pe,{className:"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[v.jsx("span",{className:"text-tab font-medium text-yellow-500",children:"Warning"}),v.jsx("span",{className:"text-xs text-muted-foreground",children:"5m ago"})]}),v.jsx("p",{className:"text-body text-yellow-500",children:"API rate limit approaching: 80% of quota used"})]})]}),v.jsxs("div",{className:"flex items-start gap-3 py-2 border-l-2 border-l-blue-500 pl-3",children:[v.jsx(_t,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[v.jsx("span",{className:"text-tab font-medium text-blue-500",children:"Info"}),v.jsx("span",{className:"text-xs text-muted-foreground",children:"8m ago"})]}),v.jsx("p",{className:"text-body text-blue-500",children:"Code generation completed successfully for Button.tsx"})]})]}),v.jsxs("div",{className:"flex items-start gap-3 py-2 border-l-2 border-l-green-500 pl-3",children:[v.jsx(_t,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[v.jsx("span",{className:"text-tab font-medium text-green-500",children:"Success"}),v.jsx("span",{className:"text-xs text-muted-foreground",children:"12m ago"})]}),v.jsx("p",{className:"text-body text-green-500",children:"All tests passed for authentication module"})]})]})]})})})]})]})})}function rl({onSendMessage:i,isLoading:e=!1,disabled:t=!1,placeholder:d="Enter a prompt"}){const[y,E]=N.useState(""),[k,s]=N.useState([]),a=N.useRef(null),u=()=>{(y.trim()||k.length>0)&&(i(y,k),E(""),s([]))},p=N.useCallback(async f=>{const S=f.target.files;if(!S)return;const _=[];for(let n=0;n<S.length;n++){const o=S[n],r=`file-${Date.now()}-${n}`;if(o?.type.startsWith("text/")||o?.name.endsWith(".md")||o?.name.endsWith(".json")){const l=await o.text();_.push({id:r,name:o?.name||"unknown",size:o?.size||0,type:o?.type||"text/plain",content:l})}else _.push({id:r,name:o?.name||"unknown",size:o?.size||0,type:o?.type||"application/octet-stream"})}s(n=>[...n,..._]),a.current&&(a.current.value="")},[]),c=f=>{s(S=>S.filter(_=>_.id!==f))},h=f=>f<1024?f+" B":f<1024*1024?(f/1024).toFixed(1)+" KB":(f/(1024*1024)).toFixed(1)+" MB";return v.jsxs("div",{className:"relative flex flex-col min-h-[120px] max-h-[200px]",children:[k.length>0&&v.jsx("div",{className:"flex flex-wrap gap-2 p-2 border-b border-border",children:k.map(f=>v.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-muted/50 rounded-md text-sm",children:[v.jsx(ds,{className:"h-3 w-3 text-muted-foreground"}),v.jsx("span",{className:"text-foreground",children:f.name}),v.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",h(f.size),")"]}),v.jsx(ie,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>c(f.id),children:v.jsx(ot,{className:"h-3 w-3"})})]},f.id))}),v.jsxs("div",{className:"minimalist-input flex-1 relative",children:[v.jsx("textarea",{placeholder:d,value:y,onChange:f=>E(f.target.value),onKeyPress:f=>{f.key==="Enter"&&!f.shiftKey&&!t&&!e&&(f.preventDefault(),u())},className:"w-full h-full bg-transparent resize-none text-foreground placeholder-muted-foreground focus:outline-none text-body leading-relaxed pr-24",style:{border:"none"},disabled:t||e}),v.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2",children:[v.jsx(ie,{variant:"ghost",size:"sm",className:"p-2 hover:bg-muted/50",onClick:()=>a.current?.click(),disabled:t||e,children:v.jsx(In,{className:"h-4 w-4"})}),v.jsx(ie,{onClick:u,className:"minimalist-button p-2",disabled:!y.trim()&&k.length===0||t||e,children:e?v.jsx(At,{className:"h-4 w-4 animate-spin"}):v.jsx(zn,{className:"h-4 w-4"})})]}),v.jsx("input",{ref:a,type:"file",multiple:!0,onChange:p,className:"hidden",accept:"text/*,.md,.json,.js,.jsx,.ts,.tsx,.py,.java,.cpp,.c,.h,.cs,.go,.rb,.php,.html,.css,.xml,.yaml,.yml"})]})]})}function me(i,e){N.useEffect(()=>(de.on(i,e),()=>{de.off(i,e)}),[i,e])}const il={".js":"javascript",".jsx":"javascript",".ts":"typescript",".tsx":"typescript",".py":"python",".java":"java",".cpp":"cpp",".c":"c",".h":"c",".cs":"csharp",".go":"go",".rb":"ruby",".php":"php",".html":"html",".css":"css",".scss":"scss",".sass":"sass",".less":"less",".xml":"xml",".json":"json",".yaml":"yaml",".yml":"yaml",".md":"markdown",".mdx":"markdown",".sql":"sql",".sh":"bash",".bash":"bash",".zsh":"bash",".fish":"bash",".ps1":"powershell",".r":"r",".R":"r",".swift":"swift",".kt":"kotlin",".kts":"kotlin",".dart":"dart",".lua":"lua",".vim":"vim",".dockerfile":"dockerfile",".rs":"rust",".toml":"toml",".ini":"ini",".cfg":"ini",".conf":"ini",".env":"dotenv"},Qs=10*1024*1024,er=new Set([".jpg",".jpeg",".png",".gif",".bmp",".ico",".svg",".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".zip",".rar",".tar",".gz",".7z",".exe",".dll",".so",".dylib",".mp3",".mp4",".avi",".mov",".wav",".ttf",".otf",".woff",".woff2",".db",".sqlite"]),tr=new Set(["node_modules",".git",".svn",".hg","dist","build","out","target","bin","obj",".idea",".vscode",".vs","__pycache__",".pytest_cache",".mypy_cache","venv","env",".env"]);class cs{static async importFile(e){try{if(e.size>Qs)throw new Error(`File "${e.name}" exceeds the maximum size of 10MB`);const t=this.getFileExtension(e.name);if(er.has(t.toLowerCase()))return console.warn(`Skipping binary file: ${e.name}`),null;const d=await this.readFileAsText(e);return{id:this.generateId(),name:e.name,path:e.name,content:d,type:"file",language:this.getLanguageFromExtension(t),size:e.size}}catch(t){return console.error(`Error importing file ${e.name}:`,t),null}}static async importFiles(e){const t=[];for(let d=0;d<e.length;d++){const y=e[d];if(!y)continue;const E=await this.importFile(y);E&&t.push(E)}return t}static async importFolder(){try{if(!("showDirectoryPicker"in window))throw new Error("Your browser does not support folder import. Please use Chrome, Edge, or another Chromium-based browser.");const e=await window.showDirectoryPicker({mode:"read"});return await this.readDirectory(e,e.name)}catch(e){if(e.name==="AbortError")return null;throw console.error("Error importing folder:",e),e}}static async readDirectory(e,t,d=0,y=10){const E={id:this.generateId(),name:e.name,path:t,type:"folder",children:[]};if(d>y)return console.warn(`Max depth reached for folder: ${t}`),E;if(tr.has(e.name))return console.log(`Skipping folder: ${e.name}`),E;try{for await(const k of e.values()){const s=`${t}/${k.name}`;if(k.kind==="file"){const a=await k.getFile();if(!a)continue;if(a.size>Qs){console.warn(`Skipping large file: ${s} (${a.size} bytes)`);continue}const u=this.getFileExtension(a.name);if(er.has(u.toLowerCase())){console.log(`Skipping binary file: ${s}`);continue}try{const p=await this.readFileAsText(a);E.children.push({id:this.generateId(),name:a.name,path:s,content:p,type:"file",language:this.getLanguageFromExtension(u),size:a.size})}catch(p){console.error(`Error reading file ${s}:`,p)}}else if(k.kind==="directory"&&!tr.has(k.name)){const a=await this.readDirectory(k,s,d+1,y);a.children.length>0&&E.children.push(a)}}}catch(k){console.error(`Error reading directory ${t}:`,k)}return E.children.sort((k,s)=>k.type!==s.type?k.type==="folder"?-1:1:k.name.localeCompare(s.name)),E}static async readFileAsText(e){return new Promise((t,d)=>{const y=new FileReader;y.onload=E=>t(E.target?.result),y.onerror=d,y.readAsText(e)})}static getFileExtension(e){const t=e.lastIndexOf(".");return t===-1?"":e.substring(t)}static getLanguageFromExtension(e){return il[e.toLowerCase()]||"plaintext"}static generateId(){return`import-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static convertToFileTreeNodes(e){return e.map(t=>this.convertNode(t))}static convertNode(e){return e.type==="file"?{id:e.id,name:e.name,path:e.path,type:"file",content:e.content,language:e.language}:{id:e.id,name:e.name,path:e.path,type:"folder",children:e.children.map(t=>this.convertNode(t)),isExpanded:!1}}}function nl({onFileSelect:i,importedProject:e=[]}){const[t,d]=N.useState([]),[y,E]=N.useState(null);N.useEffect(()=>{if(e.length>0){const h=cs.convertToFileTreeNodes(e);d(h)}},[e]),me("file_tree_update",h=>{d(f=>{const S=[...f],_=h.filePath.split("/"),n=(o,r,l=0)=>{if(l===r.length-1){const b=o.findIndex(x=>x.name===r[l]);if(h.action==="delete")return o.filter(x=>x.name!==r[l]);if(h.action==="create"||h.action==="update"){const x={id:h.filePath,name:r[l]||"unknown",path:h.filePath,type:h.fileType,children:h.fileType==="folder"?[]:void 0};b>=0?o[b]={...o[b],...x}:o.push(x)}return o}const m=r[l]||"unknown";let w=o.find(b=>b.name===m&&b.type==="folder");return w||(w={id:r.slice(0,l+1).join("/"),name:m,path:r.slice(0,l+1).join("/"),type:"folder",children:[],isExpanded:!1},o.push(w)),w?.children&&(w.children=n(w.children,r,l+1)),o};return n(S,_)})});const k=h=>{const f=S=>S.map(_=>_.id===h?{..._,isExpanded:!_.isExpanded}:_.children?{..._,children:f(_.children)}:_);d(f(t))},s=h=>{h.type==="file"&&(E(h.id),h.content?i?.(h.path,h.content,h.language):(de.selectFile(h.path),i?.(h.path)))},a=h=>{switch(h.split(".").pop()?.toLowerCase()){case"tsx":case"jsx":case"ts":case"js":return v.jsx(ft,{className:"h-3 w-3 text-blue-400"});case"json":return v.jsx(hn,{className:"h-3 w-3 text-yellow-400"});case"md":return v.jsx(_t,{className:"h-3 w-3 text-gray-400"});case"html":return v.jsx(ft,{className:"h-3 w-3 text-orange-400"});case"css":return v.jsx(ft,{className:"h-3 w-3 text-purple-400"});case"png":case"jpg":case"jpeg":case"svg":return v.jsx(xn,{className:"h-3 w-3 text-green-400"});default:return v.jsx(ds,{className:"h-3 w-3 text-gray-400"})}},u=()=>{const h={name:"project-export",timestamp:new Date().toISOString(),files:[]},f=o=>{o.forEach(r=>{r.type==="file"&&r.content?h.files.push({path:r.path,content:r.content,language:r.language}):r.type==="folder"&&r.children&&f(r.children)})};f(t);const S=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),_=URL.createObjectURL(S),n=document.createElement("a");n.href=_,n.download=`project-${Date.now()}.json`,n.click(),URL.revokeObjectURL(_)},p=()=>{d([]),E(null)},c=(h,f=0)=>{const S=y===h.id;return v.jsxs("div",{className:"file-tree-item",children:[v.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 cursor-pointer hover:bg-muted/20 file-tree-small ${S?"bg-primary/10 text-primary":"text-foreground"}`,style:{paddingLeft:`${8+f*12}px`,fontFamily:"Quicksand, sans-serif"},onClick:()=>{h.type==="folder"?k(h.id):s(h)},children:[h.type==="folder"&&v.jsxs(v.Fragment,{children:[h.isExpanded?v.jsx(br,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}):v.jsx(ts,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),v.jsx("div",{className:"w-3 flex justify-center",children:h.isExpanded?v.jsx(vn,{className:"h-3 w-3 text-primary"}):v.jsx(xr,{className:"h-3 w-3 text-muted-foreground"})})]}),h.type==="file"&&v.jsx("div",{className:"w-3 flex justify-center ml-3",children:a(h.name)}),v.jsx("span",{className:"file-tree-node-name truncate text-xs",children:h.name})]}),h.type==="folder"&&h.isExpanded&&h.children&&v.jsx("div",{children:h.children.map(_=>c(_,f+1))})]},h.id)};return v.jsxs("div",{className:"h-full flex flex-col",children:[v.jsx("div",{className:"p-4 border-b border-border min-h-[73px] flex items-center",children:v.jsx("div",{className:"flex items-center justify-between w-full",children:v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(ie,{variant:"ghost",size:"sm",className:"minimalist-button p-1.5 text-[13px]",onClick:p,title:"Clear all files",children:v.jsx(Cr,{className:"h-4 w-4"})}),v.jsx(ie,{variant:"ghost",size:"sm",className:"minimalist-button p-1.5",onClick:u,title:"Download project",children:v.jsx(wr,{className:"h-4 w-4"})})]})})}),v.jsx(nt,{className:"flex-1",children:v.jsx("div",{className:"p-2",children:t.map(h=>c(h))})})]})}const ol=i=>{const e=document.createElement("div");return e.textContent=i,e.innerHTML},sr={typescript:["import","export","from","interface","type","class","function","const","let","var","if","else","for","while","return","extends","implements","public","private","protected","static","async","await","try","catch","finally","throw","new","this","super","null","undefined","true","false","as","in","of","typeof","instanceof","break","continue","switch","case","default","do","with","enum","namespace"],javascript:["import","export","from","class","function","const","let","var","if","else","for","while","return","extends","async","await","try","catch","finally","throw","new","this","super","null","undefined","true","false","in","of","typeof","instanceof","break","continue","switch","case","default","do","with"],python:["import","from","class","def","if","elif","else","for","while","return","try","except","finally","raise","pass","break","continue","lambda","with","as","yield","assert","del","global","nonlocal","in","is","not","and","or","None","True","False","self","async","await"],java:["import","package","class","interface","extends","implements","public","private","protected","static","final","abstract","void","int","long","float","double","boolean","char","byte","short","if","else","for","while","return","switch","case","default","break","continue","try","catch","finally","throw","throws","new","this","super","null","true","false","instanceof","synchronized","volatile"]},al=(i,e)=>{if(!i)return"";let t=ol(i);const d=sr[e]||sr.typescript||[],y=[],E=(f,S,_)=>{y.push({start:f,end:S,replacement:_})},k=/(\/\/[^\n]*|\/\*[\s\S]*?\*\/)/g;let s;for(;(s=k.exec(t))!==null;)E(s.index,s.index+s[0].length,`<span class="syntax-comment">${s[0]}</span>`);const a=/(["'`])(?:(?=(\\?))\2[\s\S])*?\1/g;for(;(s=a.exec(t))!==null;)y.some(S=>s.index>=S.start&&s.index<S.end)||E(s.index,s.index+s[0].length,`<span class="syntax-string">${s[0]}</span>`);const u=/\b(\d+\.?\d*)\b/g;for(;(s=u.exec(t))!==null;)y.some(S=>s.index>=S.start&&s.index<S.end)||E(s.index,s.index+s[0].length,`<span class="syntax-number">${s[0]}</span>`);const p=new RegExp(`\\b(${d.join("|")})\\b`,"g");for(;(s=p.exec(t))!==null;)y.some(S=>s.index>=S.start&&s.index<S.end)||E(s.index,s.index+s[0].length,`<span class="syntax-keyword">${s[0]}</span>`);const c=/\b([a-zA-Z_$][a-zA-Z0-9_$]*)\s*(?=\()/g;for(;(s=c.exec(t))!==null;){const f=y.some(_=>s.index>=_.start&&s.index<_.end),S=s[1]&&d.includes(s[1]);!f&&!S&&s[1]&&E(s.index,s.index+s[1].length,`<span class="syntax-function">${s[1]}</span>`)}const h=/\b([A-Z][a-zA-Z0-9_]*)\b(?!\s*\()/g;for(;(s=h.exec(t))!==null;)y.some(S=>s.index>=S.start&&s.index<S.end)||E(s.index,s.index+s[0].length,`<span class="syntax-type">${s[0]}</span>`);y.sort((f,S)=>S.start-f.start);for(const{start:f,end:S,replacement:_}of y)t=t.substring(0,f)+_+t.substring(S);return t},ll=i=>{const e=Math.floor((i.length-i.trimStart().length)/4);let t=i;if(e>0){let d="",y=0;for(let E=0;E<i.length;E++)if(i[E]===" "&&y<e*4)(y+1)%4===0?(d+='<span class="indent-guide">│</span>   ',E+=3,y+=4):(d+=i[E],y++);else{d+=i.substring(E);break}t=d}return t};function cl({value:i,onChange:e,language:t,placeholder:d="Start typing your code here..."}){const[y,E]=N.useState(""),k=N.useRef(null),s=N.useRef(null),a=N.useRef(null);N.useEffect(()=>{if(i){const S=i.split(`
`).map(_=>{const n=ll(_);return al(n,t)});E(S.join(`
`))}else E("")},[i,t]);const u=()=>{k.current&&s.current&&a.current&&(s.current.scrollTop=k.current.scrollTop,s.current.scrollLeft=k.current.scrollLeft,a.current.scrollTop=k.current.scrollTop)},p=f=>{e(f.target.value)},c=f=>{if(f.key==="Tab"){f.preventDefault();const S=f.currentTarget,_=S.selectionStart,n=S.selectionEnd,o=i.substring(0,_)+"    "+i.substring(n);e(o),setTimeout(()=>{S.selectionStart=S.selectionEnd=_+4},0)}},h=i?i.split(`
`).length:1;return v.jsxs("div",{className:"relative h-full w-full overflow-hidden bg-[#1e1e1e] flex",children:[v.jsx("div",{ref:a,className:"line-numbers overflow-hidden",style:{fontFamily:'"JetBrains Mono", monospace',fontSize:"13px",lineHeight:"1.5",padding:"1rem 0.5rem",paddingRight:"0.75rem",color:"#6e6e6e",backgroundColor:"#1a1a1a",borderRight:"1px solid #2d2d2d",userSelect:"none",minWidth:"3.5rem",textAlign:"right"},children:Array.from({length:h},(f,S)=>v.jsx("div",{style:{height:"19.5px"},children:S+1},S))}),v.jsxs("div",{className:"relative flex-1",children:[v.jsx("div",{ref:s,className:"absolute inset-0 overflow-auto pointer-events-none syntax-highlighted-content",style:{fontFamily:'"JetBrains Mono", monospace',fontSize:"13px",lineHeight:"1.5",padding:"1rem",paddingLeft:"1rem",color:"#d4d4d4"},children:v.jsx("pre",{style:{margin:0,padding:0,background:"transparent",fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"break-word"},dangerouslySetInnerHTML:{__html:y||"&nbsp;"}})}),v.jsx("textarea",{ref:k,value:i,onChange:p,onScroll:u,onKeyDown:c,placeholder:d,className:"absolute inset-0 w-full h-full resize-none bg-transparent border-0 outline-none code-editor-textarea",style:{fontFamily:'"JetBrains Mono", monospace',fontSize:"13px",lineHeight:"1.5",padding:"1rem",paddingLeft:"1rem",color:"transparent",caretColor:"#d4d4d4",WebkitTextFillColor:"transparent",whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"break-word"},spellCheck:!1,autoCapitalize:"off",autoComplete:"off",autoCorrect:"off"}),!i&&v.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{fontFamily:'"JetBrains Mono", monospace',fontSize:"13px",lineHeight:"1.5",padding:"1rem",paddingLeft:"1rem",color:"#6e6e6e"},children:d})]}),v.jsx("style",{children:`
        .indent-guide {
          color: #3a3a3a;
          font-weight: 300;
          display: inline-block;
          width: 1ch;
          text-align: center;
        }
        
        .syntax-comment { color: #6A9955; }
        .syntax-string { color: #CE9178; }
        .syntax-number { color: #B5CEA8; }
        .syntax-keyword { color: #569CD6; }
        .syntax-function { color: #DCDCAA; }
        .syntax-type { color: #4EC9B0; }
        
        /* Hide scrollbar for line numbers */
        .line-numbers::-webkit-scrollbar {
          display: none;
        }
        .line-numbers {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `})]})}function hl({currentPhase:i="spec",selectedFile:e}){const[t,d]=N.useState([]),[y,E]=N.useState("");N.useEffect(()=>{e&&(d(f=>{const S=`file-${e.path}`;if(f.some(n=>n.id===S))return f;const _=e.path.split("/").pop()||"untitled";return[...f,{id:S,name:_,path:e.path,language:e.language??"plaintext",code:e.content}]}),E(`file-${e.path}`))},[e]);const k=N.useCallback(f=>{d(S=>{const _=S.findIndex(o=>o.id===f);if(_===-1)return S;const n=[...S.slice(0,_),...S.slice(_+1)];if(f===y){const o=n[_-1]??n[_]??null;E(o?o.id:"")}return n})},[y]),s=N.useRef(y);N.useEffect(()=>{s.current=y},[y]),N.useEffect(()=>{const f=S=>{(S.ctrlKey||S.metaKey)&&S.key==="w"&&(S.preventDefault(),s.current&&k(s.current))};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[k]);const a=(f,S)=>{d(_=>_.map(n=>n.id===f?{...n,code:S}:n))},u=()=>{const f=t.find(S=>S.id===y);f&&navigator.clipboard.writeText(f.code)},p=()=>{const f=t.find(o=>o.id===y);if(!f)return;const S=new Blob([f.code],{type:"text/plain"}),_=URL.createObjectURL(S),n=document.createElement("a");n.href=_,n.download=f.name,n.click(),URL.revokeObjectURL(_)},c=f=>{switch(f){case"spec":return"border-blue-500";case"test":return"border-yellow-500";case"impl":return"border-violet-500";default:return"border-blue-500"}},h=t.find(f=>f.id===y);return t.length===0?v.jsx("div",{className:"h-full flex items-center justify-center bg-[#1e1e1e]",children:v.jsxs("div",{className:"text-center text-muted-foreground px-8",children:[v.jsx(ft,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),v.jsx("p",{className:"text-body mb-2",children:"No files open"}),v.jsx("p",{className:"text-sm",children:"Select a file from the file tree or import a project to start editing"})]})}):v.jsxs("div",{className:"h-full flex flex-col bg-[#1e1e1e]",children:[v.jsx("div",{className:"p-4 border-b border-border bg-card min-h-[73px] flex items-center overflow-hidden",children:v.jsxs("div",{className:"flex items-center w-full gap-4",children:[v.jsx("div",{className:"flex-1 min-w-0 overflow-x-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(255, 255, 255, 0.2) transparent"},children:v.jsx("div",{className:"flex gap-0.5 pr-2 w-max",children:t.map(f=>v.jsxs("div",{className:"relative flex items-center group flex-shrink-0",children:[y===f.id&&v.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-0.5 ${c(i)} rounded-full`}),v.jsxs("div",{className:`flex items-center rounded-md transition-all duration-200 ${y===f.id?"bg-primary/10 border border-primary/20":"bg-transparent border border-transparent hover:bg-muted/10"}`,style:{fontFamily:"Quicksand, sans-serif",fontSize:"13px",fontWeight:500,minWidth:"120px"},children:[v.jsx("button",{onClick:()=>E(f.id),className:`flex-1 px-3 py-2 text-left truncate transition-colors ${y===f.id?"text-primary":"text-muted-foreground hover:text-foreground"}`,children:f.name}),v.jsx("button",{onClick:S=>{S.stopPropagation(),S.preventDefault(),k(f.id)},onMouseDown:S=>{S.stopPropagation(),S.preventDefault()},className:"p-1.5 mr-1 rounded hover:bg-destructive/20 hover:text-destructive transition-all duration-150 opacity-50 hover:opacity-100 focus:opacity-100",title:"Close file (Ctrl/Cmd + W)",tabIndex:0,children:v.jsx(ot,{className:"h-3 w-3"})})]})]},f.id))})}),v.jsx("div",{className:"h-8 w-px bg-border flex-shrink-0"}),v.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[v.jsx(ie,{variant:"ghost",size:"sm",className:"minimalist-button p-1.5",onClick:u,title:"Copy code",children:v.jsx(ln,{className:"h-4 w-4"})}),v.jsx(ie,{variant:"ghost",size:"sm",className:"minimalist-button p-1.5",onClick:p,title:"Download file",children:v.jsx(wr,{className:"h-4 w-4"})}),v.jsx(ie,{variant:"ghost",size:"sm",className:"minimalist-button p-1.5",children:v.jsx(fn,{className:"h-4 w-4"})})]})]})}),v.jsx("div",{className:"flex-1 overflow-hidden bg-[#1e1e1e]",children:h&&v.jsx(cl,{value:h.code,onChange:f=>a(h.id,f),language:h.language,placeholder:"Start typing your code here..."})})]})}var Gt={exports:{}},rr;function dl(){return rr||(rr=1,function(i,e){(function(t,d){i.exports=d()})(globalThis,()=>(()=>{var t={4567:function(k,s,a){var u=this&&this.__decorate||function(r,l,m,w){var b,x=arguments.length,g=x<3?l:w===null?w=Object.getOwnPropertyDescriptor(l,m):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(r,l,m,w);else for(var C=r.length-1;C>=0;C--)(b=r[C])&&(g=(x<3?b(g):x>3?b(l,m,g):b(l,m))||g);return x>3&&g&&Object.defineProperty(l,m,g),g},p=this&&this.__param||function(r,l){return function(m,w){l(m,w,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.AccessibilityManager=void 0;const c=a(9042),h=a(9924),f=a(844),S=a(4725),_=a(2585),n=a(3656);let o=s.AccessibilityManager=class extends f.Disposable{constructor(r,l,m,w){super(),this._terminal=r,this._coreBrowserService=m,this._renderService=w,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let b=0;b<this._terminal.rows;b++)this._rowElements[b]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[b]);if(this._topBoundaryFocusListener=b=>this._handleBoundaryFocus(b,0),this._bottomBoundaryFocusListener=b=>this._handleBoundaryFocus(b,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new h.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(b=>this._handleResize(b.rows))),this.register(this._terminal.onRender(b=>this._refreshRows(b.start,b.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(b=>this._handleChar(b))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(b=>this._handleTab(b))),this.register(this._terminal.onKey(b=>this._handleKey(b.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,n.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,f.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(r){for(let l=0;l<r;l++)this._handleChar(" ")}_handleChar(r){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==r&&(this._charsToAnnounce+=r):this._charsToAnnounce+=r,r===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=c.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(r){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(r)||this._charsToConsume.push(r)}_refreshRows(r,l){this._liveRegionDebouncer.refresh(r,l,this._terminal.rows)}_renderRows(r,l){const m=this._terminal.buffer,w=m.lines.length.toString();for(let b=r;b<=l;b++){const x=m.lines.get(m.ydisp+b),g=[],C=x?.translateToString(!0,void 0,void 0,g)||"",T=(m.ydisp+b+1).toString(),A=this._rowElements[b];A&&(C.length===0?(A.innerText=" ",this._rowColumns.set(A,[0,1])):(A.textContent=C,this._rowColumns.set(A,g)),A.setAttribute("aria-posinset",T),A.setAttribute("aria-setsize",w))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(r,l){const m=r.target,w=this._rowElements[l===0?1:this._rowElements.length-2];if(m.getAttribute("aria-posinset")===(l===0?"1":`${this._terminal.buffer.lines.length}`)||r.relatedTarget!==w)return;let b,x;if(l===0?(b=m,x=this._rowElements.pop(),this._rowContainer.removeChild(x)):(b=this._rowElements.shift(),x=m,this._rowContainer.removeChild(b)),b.removeEventListener("focus",this._topBoundaryFocusListener),x.removeEventListener("focus",this._bottomBoundaryFocusListener),l===0){const g=this._createAccessibilityTreeNode();this._rowElements.unshift(g),this._rowContainer.insertAdjacentElement("afterbegin",g)}else{const g=this._createAccessibilityTreeNode();this._rowElements.push(g),this._rowContainer.appendChild(g)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(l===0?-1:1),this._rowElements[l===0?1:this._rowElements.length-2].focus(),r.preventDefault(),r.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;const r=document.getSelection();if(!r)return;if(r.isCollapsed)return void(this._rowContainer.contains(r.anchorNode)&&this._terminal.clearSelection());if(!r.anchorNode||!r.focusNode)return void console.error("anchorNode and/or focusNode are null");let l={node:r.anchorNode,offset:r.anchorOffset},m={node:r.focusNode,offset:r.focusOffset};if((l.node.compareDocumentPosition(m.node)&Node.DOCUMENT_POSITION_PRECEDING||l.node===m.node&&l.offset>m.offset)&&([l,m]=[m,l]),l.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(l={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(l.node))return;const w=this._rowElements.slice(-1)[0];if(m.node.compareDocumentPosition(w)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(m={node:w,offset:w.textContent?.length??0}),!this._rowContainer.contains(m.node))return;const b=({node:C,offset:T})=>{const A=C instanceof Text?C.parentNode:C;let B=parseInt(A?.getAttribute("aria-posinset"),10)-1;if(isNaN(B))return console.warn("row is invalid. Race condition?"),null;const D=this._rowColumns.get(A);if(!D)return console.warn("columns is null. Race condition?"),null;let j=T<D.length?D[T]:D.slice(-1)[0]+1;return j>=this._terminal.cols&&(++B,j=0),{row:B,column:j}},x=b(l),g=b(m);if(x&&g){if(x.row>g.row||x.row===g.row&&x.column>=g.column)throw new Error("invalid range");this._terminal.select(x.column,x.row,(g.row-x.row)*this._terminal.cols-x.column+g.column)}}_handleResize(r){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let l=this._rowContainer.children.length;l<this._terminal.rows;l++)this._rowElements[l]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[l]);for(;this._rowElements.length>r;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const r=this._coreBrowserService.mainDocument.createElement("div");return r.setAttribute("role","listitem"),r.tabIndex=-1,this._refreshRowDimensions(r),r}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let r=0;r<this._terminal.rows;r++)this._refreshRowDimensions(this._rowElements[r])}}_refreshRowDimensions(r){r.style.height=`${this._renderService.dimensions.css.cell.height}px`}};s.AccessibilityManager=o=u([p(1,_.IInstantiationService),p(2,S.ICoreBrowserService),p(3,S.IRenderService)],o)},3614:(k,s)=>{function a(h){return h.replace(/\r?\n/g,"\r")}function u(h,f){return f?"\x1B[200~"+h+"\x1B[201~":h}function p(h,f,S,_){h=u(h=a(h),S.decPrivateModes.bracketedPasteMode&&_.rawOptions.ignoreBracketedPasteMode!==!0),S.triggerDataEvent(h,!0),f.value=""}function c(h,f,S){const _=S.getBoundingClientRect(),n=h.clientX-_.left-10,o=h.clientY-_.top-10;f.style.width="20px",f.style.height="20px",f.style.left=`${n}px`,f.style.top=`${o}px`,f.style.zIndex="1000",f.focus()}Object.defineProperty(s,"__esModule",{value:!0}),s.rightClickHandler=s.moveTextAreaUnderMouseCursor=s.paste=s.handlePasteEvent=s.copyHandler=s.bracketTextForPaste=s.prepareTextForTerminal=void 0,s.prepareTextForTerminal=a,s.bracketTextForPaste=u,s.copyHandler=function(h,f){h.clipboardData&&h.clipboardData.setData("text/plain",f.selectionText),h.preventDefault()},s.handlePasteEvent=function(h,f,S,_){h.stopPropagation(),h.clipboardData&&p(h.clipboardData.getData("text/plain"),f,S,_)},s.paste=p,s.moveTextAreaUnderMouseCursor=c,s.rightClickHandler=function(h,f,S,_,n){c(h,f,S),n&&_.rightClickSelect(h),f.value=_.selectionText,f.select()}},7239:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorContrastCache=void 0;const u=a(1505);s.ColorContrastCache=class{constructor(){this._color=new u.TwoKeyMap,this._css=new u.TwoKeyMap}setCss(p,c,h){this._css.set(p,c,h)}getCss(p,c){return this._css.get(p,c)}setColor(p,c,h){this._color.set(p,c,h)}getColor(p,c){return this._color.get(p,c)}clear(){this._color.clear(),this._css.clear()}}},3656:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.addDisposableDomListener=void 0,s.addDisposableDomListener=function(a,u,p,c){a.addEventListener(u,p,c);let h=!1;return{dispose:()=>{h||(h=!0,a.removeEventListener(u,p,c))}}}},3551:function(k,s,a){var u=this&&this.__decorate||function(o,r,l,m){var w,b=arguments.length,x=b<3?r:m===null?m=Object.getOwnPropertyDescriptor(r,l):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(o,r,l,m);else for(var g=o.length-1;g>=0;g--)(w=o[g])&&(x=(b<3?w(x):b>3?w(r,l,x):w(r,l))||x);return b>3&&x&&Object.defineProperty(r,l,x),x},p=this&&this.__param||function(o,r){return function(l,m){r(l,m,o)}};Object.defineProperty(s,"__esModule",{value:!0}),s.Linkifier=void 0;const c=a(3656),h=a(8460),f=a(844),S=a(2585),_=a(4725);let n=s.Linkifier=class extends f.Disposable{get currentLink(){return this._currentLink}constructor(o,r,l,m,w){super(),this._element=o,this._mouseService=r,this._renderService=l,this._bufferService=m,this._linkProviderService=w,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new h.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new h.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,f.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,f.toDisposable)(()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,c.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,c.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,c.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,c.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(o){this._lastMouseEvent=o;const r=this._positionFromMouseEvent(o,this._element,this._mouseService);if(!r)return;this._isMouseOut=!1;const l=o.composedPath();for(let m=0;m<l.length;m++){const w=l[m];if(w.classList.contains("xterm"))break;if(w.classList.contains("xterm-hover"))return}this._lastBufferCell&&r.x===this._lastBufferCell.x&&r.y===this._lastBufferCell.y||(this._handleHover(r),this._lastBufferCell=r)}_handleHover(o){if(this._activeLine!==o.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(o,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,o)||(this._clearCurrentLink(),this._askForLink(o,!0))}_askForLink(o,r){this._activeProviderReplies&&r||(this._activeProviderReplies?.forEach(m=>{m?.forEach(w=>{w.link.dispose&&w.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=o.y);let l=!1;for(const[m,w]of this._linkProviderService.linkProviders.entries())r?this._activeProviderReplies?.get(m)&&(l=this._checkLinkProviderResult(m,o,l)):w.provideLinks(o.y,b=>{if(this._isMouseOut)return;const x=b?.map(g=>({link:g}));this._activeProviderReplies?.set(m,x),l=this._checkLinkProviderResult(m,o,l),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(o.y,this._activeProviderReplies)})}_removeIntersectingLinks(o,r){const l=new Set;for(let m=0;m<r.size;m++){const w=r.get(m);if(w)for(let b=0;b<w.length;b++){const x=w[b],g=x.link.range.start.y<o?0:x.link.range.start.x,C=x.link.range.end.y>o?this._bufferService.cols:x.link.range.end.x;for(let T=g;T<=C;T++){if(l.has(T)){w.splice(b--,1);break}l.add(T)}}}}_checkLinkProviderResult(o,r,l){if(!this._activeProviderReplies)return l;const m=this._activeProviderReplies.get(o);let w=!1;for(let b=0;b<o;b++)this._activeProviderReplies.has(b)&&!this._activeProviderReplies.get(b)||(w=!0);if(!w&&m){const b=m.find(x=>this._linkAtPosition(x.link,r));b&&(l=!0,this._handleNewLink(b))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!l)for(let b=0;b<this._activeProviderReplies.size;b++){const x=this._activeProviderReplies.get(b)?.find(g=>this._linkAtPosition(g.link,r));if(x){l=!0,this._handleNewLink(x);break}}return l}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(o){if(!this._currentLink)return;const r=this._positionFromMouseEvent(o,this._element,this._mouseService);r&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,r)&&this._currentLink.link.activate(o,this._currentLink.link.text)}_clearCurrentLink(o,r){this._currentLink&&this._lastMouseEvent&&(!o||!r||this._currentLink.link.range.start.y>=o&&this._currentLink.link.range.end.y<=r)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,f.disposeArray)(this._linkCacheDisposables))}_handleNewLink(o){if(!this._lastMouseEvent)return;const r=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);r&&this._linkAtPosition(o.link,r)&&(this._currentLink=o,this._currentLink.state={decorations:{underline:o.link.decorations===void 0||o.link.decorations.underline,pointerCursor:o.link.decorations===void 0||o.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,o.link,this._lastMouseEvent),o.link.decorations={},Object.defineProperties(o.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:l=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==l&&(this._currentLink.state.decorations.pointerCursor=l,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",l))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:l=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==l&&(this._currentLink.state.decorations.underline=l,this._currentLink.state.isHovered&&this._fireUnderlineEvent(o.link,l))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(l=>{if(!this._currentLink)return;const m=l.start===0?0:l.start+1+this._bufferService.buffer.ydisp,w=this._bufferService.buffer.ydisp+1+l.end;if(this._currentLink.link.range.start.y>=m&&this._currentLink.link.range.end.y<=w&&(this._clearCurrentLink(m,w),this._lastMouseEvent)){const b=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);b&&this._askForLink(b,!1)}})))}_linkHover(o,r,l){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(r,!0),this._currentLink.state.decorations.pointerCursor&&o.classList.add("xterm-cursor-pointer")),r.hover&&r.hover(l,r.text)}_fireUnderlineEvent(o,r){const l=o.range,m=this._bufferService.buffer.ydisp,w=this._createLinkUnderlineEvent(l.start.x-1,l.start.y-m-1,l.end.x,l.end.y-m-1,void 0);(r?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(w)}_linkLeave(o,r,l){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(r,!1),this._currentLink.state.decorations.pointerCursor&&o.classList.remove("xterm-cursor-pointer")),r.leave&&r.leave(l,r.text)}_linkAtPosition(o,r){const l=o.range.start.y*this._bufferService.cols+o.range.start.x,m=o.range.end.y*this._bufferService.cols+o.range.end.x,w=r.y*this._bufferService.cols+r.x;return l<=w&&w<=m}_positionFromMouseEvent(o,r,l){const m=l.getCoords(o,r,this._bufferService.cols,this._bufferService.rows);if(m)return{x:m[0],y:m[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(o,r,l,m,w){return{x1:o,y1:r,x2:l,y2:m,cols:this._bufferService.cols,fg:w}}};s.Linkifier=n=u([p(1,_.IMouseService),p(2,_.IRenderService),p(3,S.IBufferService),p(4,_.ILinkProviderService)],n)},9042:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.tooMuchOutput=s.promptLabel=void 0,s.promptLabel="Terminal input",s.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(k,s,a){var u=this&&this.__decorate||function(_,n,o,r){var l,m=arguments.length,w=m<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,o):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(_,n,o,r);else for(var b=_.length-1;b>=0;b--)(l=_[b])&&(w=(m<3?l(w):m>3?l(n,o,w):l(n,o))||w);return m>3&&w&&Object.defineProperty(n,o,w),w},p=this&&this.__param||function(_,n){return function(o,r){n(o,r,_)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OscLinkProvider=void 0;const c=a(511),h=a(2585);let f=s.OscLinkProvider=class{constructor(_,n,o){this._bufferService=_,this._optionsService=n,this._oscLinkService=o}provideLinks(_,n){const o=this._bufferService.buffer.lines.get(_-1);if(!o)return void n(void 0);const r=[],l=this._optionsService.rawOptions.linkHandler,m=new c.CellData,w=o.getTrimmedLength();let b=-1,x=-1,g=!1;for(let C=0;C<w;C++)if(x!==-1||o.hasContent(C)){if(o.loadCell(C,m),m.hasExtendedAttrs()&&m.extended.urlId){if(x===-1){x=C,b=m.extended.urlId;continue}g=m.extended.urlId!==b}else x!==-1&&(g=!0);if(g||x!==-1&&C===w-1){const T=this._oscLinkService.getLinkData(b)?.uri;if(T){const A={start:{x:x+1,y:_},end:{x:C+(g||C!==w-1?0:1),y:_}};let B=!1;if(!l?.allowNonHttpProtocols)try{const D=new URL(T);["http:","https:"].includes(D.protocol)||(B=!0)}catch{B=!0}B||r.push({text:T,range:A,activate:(D,j)=>l?l.activate(D,j,A):S(0,j),hover:(D,j)=>l?.hover?.(D,j,A),leave:(D,j)=>l?.leave?.(D,j,A)})}g=!1,m.hasExtendedAttrs()&&m.extended.urlId?(x=C,b=m.extended.urlId):(x=-1,b=-1)}}n(r)}};function S(_,n){if(confirm(`Do you want to navigate to ${n}?

WARNING: This link could potentially be dangerous`)){const o=window.open();if(o){try{o.opener=null}catch{}o.location.href=n}else console.warn("Opening link blocked as opener could not be cleared")}}s.OscLinkProvider=f=u([p(0,h.IBufferService),p(1,h.IOptionsService),p(2,h.IOscLinkService)],f)},6193:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.RenderDebouncer=void 0,s.RenderDebouncer=class{constructor(a,u){this._renderCallback=a,this._coreBrowserService=u,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(a,u,p){this._rowCount=p,a=a!==void 0?a:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const a=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,u),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},3236:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Terminal=void 0;const u=a(3614),p=a(3656),c=a(3551),h=a(9042),f=a(3730),S=a(1680),_=a(3107),n=a(5744),o=a(2950),r=a(1296),l=a(428),m=a(4269),w=a(5114),b=a(8934),x=a(3230),g=a(9312),C=a(4725),T=a(6731),A=a(8055),B=a(8969),D=a(8460),j=a(844),W=a(6114),U=a(8437),J=a(2584),K=a(7399),R=a(5941),P=a(9074),M=a(2585),O=a(5435),H=a(4567),z=a(779);class q extends B.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(I={}){super(I),this.browser=W,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new j.MutableDisposable),this._onCursorMove=this.register(new D.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new D.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new D.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new D.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new D.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new D.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new D.EventEmitter),this._onBlur=this.register(new D.EventEmitter),this._onA11yCharEmitter=this.register(new D.EventEmitter),this._onA11yTabEmitter=this.register(new D.EventEmitter),this._onWillOpen=this.register(new D.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(P.DecorationService),this._instantiationService.setService(M.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(z.LinkProviderService),this._instantiationService.setService(C.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(f.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((L,F)=>this.refresh(L,F))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(L=>this._reportWindowsOptions(L))),this.register(this._inputHandler.onColor(L=>this._handleColorEvent(L))),this.register((0,D.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,D.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,D.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,D.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(L=>this._afterResize(L.cols,L.rows))),this.register((0,j.toDisposable)(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}_handleColorEvent(I){if(this._themeService)for(const L of I){let F,$="";switch(L.index){case 256:F="foreground",$="10";break;case 257:F="background",$="11";break;case 258:F="cursor",$="12";break;default:F="ansi",$="4;"+L.index}switch(L.type){case 0:const X=A.color.toColorRGB(F==="ansi"?this._themeService.colors.ansi[L.index]:this._themeService.colors[F]);this.coreService.triggerDataEvent(`${J.C0.ESC}]${$};${(0,R.toRgbString)(X)}${J.C1_ESCAPED.ST}`);break;case 1:if(F==="ansi")this._themeService.modifyColors(G=>G.ansi[L.index]=A.channels.toColor(...L.color));else{const G=F;this._themeService.modifyColors(Y=>Y[G]=A.channels.toColor(...L.color))}break;case 2:this._themeService.restoreColor(L.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(I){I?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(H.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(I){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(J.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(J.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const I=this.buffer.ybase+this.buffer.y,L=this.buffer.lines.get(I);if(!L)return;const F=Math.min(this.buffer.x,this.cols-1),$=this._renderService.dimensions.css.cell.height,X=L.getWidth(F),G=this._renderService.dimensions.css.cell.width*X,Y=this.buffer.y*this._renderService.dimensions.css.cell.height,se=F*this._renderService.dimensions.css.cell.width;this.textarea.style.left=se+"px",this.textarea.style.top=Y+"px",this.textarea.style.width=G+"px",this.textarea.style.height=$+"px",this.textarea.style.lineHeight=$+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,p.addDisposableDomListener)(this.element,"copy",L=>{this.hasSelection()&&(0,u.copyHandler)(L,this._selectionService)}));const I=L=>(0,u.handlePasteEvent)(L,this.textarea,this.coreService,this.optionsService);this.register((0,p.addDisposableDomListener)(this.textarea,"paste",I)),this.register((0,p.addDisposableDomListener)(this.element,"paste",I)),W.isFirefox?this.register((0,p.addDisposableDomListener)(this.element,"mousedown",L=>{L.button===2&&(0,u.rightClickHandler)(L,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,p.addDisposableDomListener)(this.element,"contextmenu",L=>{(0,u.rightClickHandler)(L,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),W.isLinux&&this.register((0,p.addDisposableDomListener)(this.element,"auxclick",L=>{L.button===1&&(0,u.moveTextAreaUnderMouseCursor)(L,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,p.addDisposableDomListener)(this.textarea,"keyup",I=>this._keyUp(I),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"keydown",I=>this._keyDown(I),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"keypress",I=>this._keyPress(I),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionupdate",I=>this._compositionHelper.compositionupdate(I))),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,p.addDisposableDomListener)(this.textarea,"input",I=>this._inputEvent(I),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(I){if(!I)throw new Error("Terminal requires a parent element.");if(I.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=I.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),I.appendChild(this.element);const L=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),L.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,p.addDisposableDomListener)(this.screenElement,"mousemove",F=>this.updateCursorStyle(F))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),L.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",h.promptLabel),W.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(w.CoreBrowserService,this.textarea,I.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(C.ICoreBrowserService,this._coreBrowserService),this.register((0,p.addDisposableDomListener)(this.textarea,"focus",F=>this._handleTextAreaFocus(F))),this.register((0,p.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(l.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(C.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(T.ThemeService),this._instantiationService.setService(C.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(m.CharacterJoinerService),this._instantiationService.setService(C.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(x.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(C.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(F=>this._onRender.fire(F))),this.onResize(F=>this._renderService.resize(F.cols,F.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(o.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(b.MouseService),this._instantiationService.setService(C.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(c.Linkifier,this.screenElement)),this.element.appendChild(L);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(S.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(g.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(C.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(F=>this._renderService.handleSelectionChanged(F.start,F.end,F.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(F=>{this.textarea.value=F,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(F=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,p.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(_.BufferDecorationRenderer,this.screenElement)),this.register((0,p.addDisposableDomListener)(this.element,"mousedown",F=>this._selectionService.handleMouseDown(F))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(H.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",F=>this._handleScreenReaderModeOptionChange(F))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(n.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",F=>{!this._overviewRulerRenderer&&F&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(n.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(r.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const I=this,L=this.element;function F(G){const Y=I._mouseService.getMouseReportCoords(G,I.screenElement);if(!Y)return!1;let se,re;switch(G.overrideType||G.type){case"mousemove":re=32,G.buttons===void 0?(se=3,G.button!==void 0&&(se=G.button<3?G.button:3)):se=1&G.buttons?0:4&G.buttons?1:2&G.buttons?2:3;break;case"mouseup":re=0,se=G.button<3?G.button:3;break;case"mousedown":re=1,se=G.button<3?G.button:3;break;case"wheel":if(I._customWheelEventHandler&&I._customWheelEventHandler(G)===!1||I.viewport.getLinesScrolled(G)===0)return!1;re=G.deltaY<0?0:1,se=4;break;default:return!1}return!(re===void 0||se===void 0||se>4)&&I.coreMouseService.triggerMouseEvent({col:Y.col,row:Y.row,x:Y.x,y:Y.y,button:se,action:re,ctrl:G.ctrlKey,alt:G.altKey,shift:G.shiftKey})}const $={mouseup:null,wheel:null,mousedrag:null,mousemove:null},X={mouseup:G=>(F(G),G.buttons||(this._document.removeEventListener("mouseup",$.mouseup),$.mousedrag&&this._document.removeEventListener("mousemove",$.mousedrag)),this.cancel(G)),wheel:G=>(F(G),this.cancel(G,!0)),mousedrag:G=>{G.buttons&&F(G)},mousemove:G=>{G.buttons||F(G)}};this.register(this.coreMouseService.onProtocolChange(G=>{G?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(G)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&G?$.mousemove||(L.addEventListener("mousemove",X.mousemove),$.mousemove=X.mousemove):(L.removeEventListener("mousemove",$.mousemove),$.mousemove=null),16&G?$.wheel||(L.addEventListener("wheel",X.wheel,{passive:!1}),$.wheel=X.wheel):(L.removeEventListener("wheel",$.wheel),$.wheel=null),2&G?$.mouseup||($.mouseup=X.mouseup):(this._document.removeEventListener("mouseup",$.mouseup),$.mouseup=null),4&G?$.mousedrag||($.mousedrag=X.mousedrag):(this._document.removeEventListener("mousemove",$.mousedrag),$.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,p.addDisposableDomListener)(L,"mousedown",G=>{if(G.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(G))return F(G),$.mouseup&&this._document.addEventListener("mouseup",$.mouseup),$.mousedrag&&this._document.addEventListener("mousemove",$.mousedrag),this.cancel(G)})),this.register((0,p.addDisposableDomListener)(L,"wheel",G=>{if(!$.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(G)===!1)return!1;if(!this.buffer.hasScrollback){const Y=this.viewport.getLinesScrolled(G);if(Y===0)return;const se=J.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(G.deltaY<0?"A":"B");let re="";for(let he=0;he<Math.abs(Y);he++)re+=se;return this.coreService.triggerDataEvent(re,!0),this.cancel(G,!0)}return this.viewport.handleWheel(G)?this.cancel(G):void 0}},{passive:!1})),this.register((0,p.addDisposableDomListener)(L,"touchstart",G=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(G),this.cancel(G)},{passive:!0})),this.register((0,p.addDisposableDomListener)(L,"touchmove",G=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(G)?void 0:this.cancel(G)},{passive:!1}))}refresh(I,L){this._renderService?.refreshRows(I,L)}updateCursorStyle(I){this._selectionService?.shouldColumnSelect(I)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(I,L,F=0){F===1?(super.scrollLines(I,L,F),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(I)}paste(I){(0,u.paste)(I,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(I){this._customKeyEventHandler=I}attachCustomWheelEventHandler(I){this._customWheelEventHandler=I}registerLinkProvider(I){return this._linkProviderService.registerLinkProvider(I)}registerCharacterJoiner(I){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const L=this._characterJoinerService.register(I);return this.refresh(0,this.rows-1),L}deregisterCharacterJoiner(I){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(I)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(I){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+I)}registerDecoration(I){return this._decorationService.registerDecoration(I)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(I,L,F){this._selectionService.setSelection(I,L,F)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(I,L){this._selectionService?.selectLines(I,L)}_keyDown(I){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(I)===!1)return!1;const L=this.browser.isMac&&this.options.macOptionIsMeta&&I.altKey;if(!L&&!this._compositionHelper.keydown(I))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;L||I.key!=="Dead"&&I.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const F=(0,K.evaluateKeyboardEvent)(I,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(I),F.type===3||F.type===2){const $=this.rows-1;return this.scrollLines(F.type===2?-$:$),this.cancel(I,!0)}return F.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,I)||(F.cancel&&this.cancel(I,!0),!F.key||!!(I.key&&!I.ctrlKey&&!I.altKey&&!I.metaKey&&I.key.length===1&&I.key.charCodeAt(0)>=65&&I.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(F.key!==J.C0.ETX&&F.key!==J.C0.CR||(this.textarea.value=""),this._onKey.fire({key:F.key,domEvent:I}),this._showCursor(),this.coreService.triggerDataEvent(F.key,!0),!this.optionsService.rawOptions.screenReaderMode||I.altKey||I.ctrlKey?this.cancel(I,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(I,L){const F=I.isMac&&!this.options.macOptionIsMeta&&L.altKey&&!L.ctrlKey&&!L.metaKey||I.isWindows&&L.altKey&&L.ctrlKey&&!L.metaKey||I.isWindows&&L.getModifierState("AltGraph");return L.type==="keypress"?F:F&&(!L.keyCode||L.keyCode>47)}_keyUp(I){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(I)===!1||(function(L){return L.keyCode===16||L.keyCode===17||L.keyCode===18}(I)||this.focus(),this.updateCursorStyle(I),this._keyPressHandled=!1)}_keyPress(I){let L;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(I)===!1)return!1;if(this.cancel(I),I.charCode)L=I.charCode;else if(I.which===null||I.which===void 0)L=I.keyCode;else{if(I.which===0||I.charCode===0)return!1;L=I.which}return!(!L||(I.altKey||I.ctrlKey||I.metaKey)&&!this._isThirdLevelShift(this.browser,I)||(L=String.fromCharCode(L),this._onKey.fire({key:L,domEvent:I}),this._showCursor(),this.coreService.triggerDataEvent(L,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(I){if(I.data&&I.inputType==="insertText"&&(!I.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const L=I.data;return this.coreService.triggerDataEvent(L,!0),this.cancel(I),!0}return!1}resize(I,L){I!==this.cols||L!==this.rows?super.resize(I,L):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(I,L){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let I=1;I<this.rows;I++)this.buffer.lines.push(this.buffer.getBlankLine(U.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const I=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=I,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(J.C0.ESC+"[I"):this.coreService.triggerDataEvent(J.C0.ESC+"[O")}_reportWindowsOptions(I){if(this._renderService)switch(I){case O.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const L=this._renderService.dimensions.css.canvas.width.toFixed(0),F=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${J.C0.ESC}[4;${F};${L}t`);break;case O.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const $=this._renderService.dimensions.css.cell.width.toFixed(0),X=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${J.C0.ESC}[6;${X};${$}t`)}}cancel(I,L){if(this.options.cancelEvents||L)return I.preventDefault(),I.stopPropagation(),!1}}s.Terminal=q},9924:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TimeBasedDebouncer=void 0,s.TimeBasedDebouncer=class{constructor(a,u=1e3){this._renderCallback=a,this._debounceThresholdMS=u,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,u,p){this._rowCount=p,a=a!==void 0?a:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u;const c=Date.now();if(c-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=c,this._innerRefresh();else if(!this._additionalRefreshRequested){const h=c-this._lastRefreshMs,f=this._debounceThresholdMS-h;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},f)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const a=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,u)}}},1680:function(k,s,a){var u=this&&this.__decorate||function(o,r,l,m){var w,b=arguments.length,x=b<3?r:m===null?m=Object.getOwnPropertyDescriptor(r,l):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(o,r,l,m);else for(var g=o.length-1;g>=0;g--)(w=o[g])&&(x=(b<3?w(x):b>3?w(r,l,x):w(r,l))||x);return b>3&&x&&Object.defineProperty(r,l,x),x},p=this&&this.__param||function(o,r){return function(l,m){r(l,m,o)}};Object.defineProperty(s,"__esModule",{value:!0}),s.Viewport=void 0;const c=a(3656),h=a(4725),f=a(8460),S=a(844),_=a(2585);let n=s.Viewport=class extends S.Disposable{constructor(o,r,l,m,w,b,x,g){super(),this._viewportElement=o,this._scrollArea=r,this._bufferService=l,this._optionsService=m,this._charSizeService=w,this._renderService=b,this._coreBrowserService=x,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new f.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,c.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(C=>this._activeBuffer=C.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(C=>this._renderDimensions=C)),this._handleThemeChange(g.colors),this.register(g.onChangeColors(C=>this._handleThemeChange(C))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(o){this._viewportElement.style.backgroundColor=o.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(o){if(o)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const r=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==r&&(this._lastRecordedBufferHeight=r,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const o=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==o&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=o),this._refreshAnimationFrame=null}syncScrollArea(o=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(o);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(o)}_handleScroll(o){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const r=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:r,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const o=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(o*(this._smoothScrollState.target-this._smoothScrollState.origin)),o<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(o,r){const l=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(r<0&&this._viewportElement.scrollTop!==0||r>0&&l<this._lastRecordedBufferHeight)||(o.cancelable&&o.preventDefault(),!1)}handleWheel(o){const r=this._getPixelsScrolled(o);return r!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+r:this._smoothScrollState.target+=r,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=r,this._bubbleScroll(o,r))}scrollLines(o){if(o!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const r=o*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+r,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:o,suppressScrollEvent:!1})}_getPixelsScrolled(o){if(o.deltaY===0||o.shiftKey)return 0;let r=this._applyScrollModifier(o.deltaY,o);return o.deltaMode===WheelEvent.DOM_DELTA_LINE?r*=this._currentRowHeight:o.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=this._currentRowHeight*this._bufferService.rows),r}getBufferElements(o,r){let l,m="";const w=[],b=r??this._bufferService.buffer.lines.length,x=this._bufferService.buffer.lines;for(let g=o;g<b;g++){const C=x.get(g);if(!C)continue;const T=x.get(g+1)?.isWrapped;if(m+=C.translateToString(!T),!T||g===x.length-1){const A=document.createElement("div");A.textContent=m,w.push(A),m.length>0&&(l=A),m=""}}return{bufferElements:w,cursorElement:l}}getLinesScrolled(o){if(o.deltaY===0||o.shiftKey)return 0;let r=this._applyScrollModifier(o.deltaY,o);return o.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(r/=this._currentRowHeight+0,this._wheelPartialScroll+=r,r=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):o.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=this._bufferService.rows),r}_applyScrollModifier(o,r){const l=this._optionsService.rawOptions.fastScrollModifier;return l==="alt"&&r.altKey||l==="ctrl"&&r.ctrlKey||l==="shift"&&r.shiftKey?o*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:o*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(o){this._lastTouchY=o.touches[0].pageY}handleTouchMove(o){const r=this._lastTouchY-o.touches[0].pageY;return this._lastTouchY=o.touches[0].pageY,r!==0&&(this._viewportElement.scrollTop+=r,this._bubbleScroll(o,r))}};s.Viewport=n=u([p(2,_.IBufferService),p(3,_.IOptionsService),p(4,h.ICharSizeService),p(5,h.IRenderService),p(6,h.ICoreBrowserService),p(7,h.IThemeService)],n)},3107:function(k,s,a){var u=this&&this.__decorate||function(_,n,o,r){var l,m=arguments.length,w=m<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,o):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(_,n,o,r);else for(var b=_.length-1;b>=0;b--)(l=_[b])&&(w=(m<3?l(w):m>3?l(n,o,w):l(n,o))||w);return m>3&&w&&Object.defineProperty(n,o,w),w},p=this&&this.__param||function(_,n){return function(o,r){n(o,r,_)}};Object.defineProperty(s,"__esModule",{value:!0}),s.BufferDecorationRenderer=void 0;const c=a(4725),h=a(844),f=a(2585);let S=s.BufferDecorationRenderer=class extends h.Disposable{constructor(_,n,o,r,l){super(),this._screenElement=_,this._bufferService=n,this._coreBrowserService=o,this._decorationService=r,this._renderService=l,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(m=>this._removeDecoration(m))),this.register((0,h.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const _ of this._decorationService.decorations)this._renderDecoration(_);this._dimensionsChanged=!1}_renderDecoration(_){this._refreshStyle(_),this._dimensionsChanged&&this._refreshXPosition(_)}_createElement(_){const n=this._coreBrowserService.mainDocument.createElement("div");n.classList.add("xterm-decoration"),n.classList.toggle("xterm-decoration-top-layer",_?.options?.layer==="top"),n.style.width=`${Math.round((_.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,n.style.height=(_.options.height||1)*this._renderService.dimensions.css.cell.height+"px",n.style.top=(_.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",n.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const o=_.options.x??0;return o&&o>this._bufferService.cols&&(n.style.display="none"),this._refreshXPosition(_,n),n}_refreshStyle(_){const n=_.marker.line-this._bufferService.buffers.active.ydisp;if(n<0||n>=this._bufferService.rows)_.element&&(_.element.style.display="none",_.onRenderEmitter.fire(_.element));else{let o=this._decorationElements.get(_);o||(o=this._createElement(_),_.element=o,this._decorationElements.set(_,o),this._container.appendChild(o),_.onDispose(()=>{this._decorationElements.delete(_),o.remove()})),o.style.top=n*this._renderService.dimensions.css.cell.height+"px",o.style.display=this._altBufferIsActive?"none":"block",_.onRenderEmitter.fire(o)}}_refreshXPosition(_,n=_.element){if(!n)return;const o=_.options.x??0;(_.options.anchor||"left")==="right"?n.style.right=o?o*this._renderService.dimensions.css.cell.width+"px":"":n.style.left=o?o*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(_){this._decorationElements.get(_)?.remove(),this._decorationElements.delete(_),_.dispose()}};s.BufferDecorationRenderer=S=u([p(1,f.IBufferService),p(2,c.ICoreBrowserService),p(3,f.IDecorationService),p(4,c.IRenderService)],S)},5871:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorZoneStore=void 0,s.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(const u of this._zones)if(u.color===a.options.overviewRulerOptions.color&&u.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(u,a.marker.line))return;if(this._lineAdjacentToZone(u,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(u,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,u){return u>=a.startBufferLine&&u<=a.endBufferLine}_lineAdjacentToZone(a,u,p){return u>=a.startBufferLine-this._linePadding[p||"full"]&&u<=a.endBufferLine+this._linePadding[p||"full"]}_addLineToZone(a,u){a.startBufferLine=Math.min(a.startBufferLine,u),a.endBufferLine=Math.max(a.endBufferLine,u)}}},5744:function(k,s,a){var u=this&&this.__decorate||function(l,m,w,b){var x,g=arguments.length,C=g<3?m:b===null?b=Object.getOwnPropertyDescriptor(m,w):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(l,m,w,b);else for(var T=l.length-1;T>=0;T--)(x=l[T])&&(C=(g<3?x(C):g>3?x(m,w,C):x(m,w))||C);return g>3&&C&&Object.defineProperty(m,w,C),C},p=this&&this.__param||function(l,m){return function(w,b){m(w,b,l)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OverviewRulerRenderer=void 0;const c=a(5871),h=a(4725),f=a(844),S=a(2585),_={full:0,left:0,center:0,right:0},n={full:0,left:0,center:0,right:0},o={full:0,left:0,center:0,right:0};let r=s.OverviewRulerRenderer=class extends f.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(l,m,w,b,x,g,C){super(),this._viewportElement=l,this._screenElement=m,this._bufferService=w,this._decorationService=b,this._renderService=x,this._optionsService=g,this._coreBrowserService=C,this._colorZoneStore=new c.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const T=this._canvas.getContext("2d");if(!T)throw new Error("Ctx cannot be null");this._ctx=T,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,f.toDisposable)(()=>{this._canvas?.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const l=Math.floor(this._canvas.width/3),m=Math.ceil(this._canvas.width/3);n.full=this._canvas.width,n.left=l,n.center=m,n.right=l,this._refreshDrawHeightConstants(),o.full=0,o.left=0,o.center=n.left,o.right=n.left+n.center}_refreshDrawHeightConstants(){_.full=Math.round(2*this._coreBrowserService.dpr);const l=this._canvas.height/this._bufferService.buffer.lines.length,m=Math.round(Math.max(Math.min(l,12),6)*this._coreBrowserService.dpr);_.left=m,_.center=m,_.right=m}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const m of this._decorationService.decorations)this._colorZoneStore.addDecoration(m);this._ctx.lineWidth=1;const l=this._colorZoneStore.zones;for(const m of l)m.position!=="full"&&this._renderColorZone(m);for(const m of l)m.position==="full"&&this._renderColorZone(m);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(l){this._ctx.fillStyle=l.color,this._ctx.fillRect(o[l.position||"full"],Math.round((this._canvas.height-1)*(l.startBufferLine/this._bufferService.buffers.active.lines.length)-_[l.position||"full"]/2),n[l.position||"full"],Math.round((this._canvas.height-1)*((l.endBufferLine-l.startBufferLine)/this._bufferService.buffers.active.lines.length)+_[l.position||"full"]))}_queueRefresh(l,m){this._shouldUpdateDimensions=l||this._shouldUpdateDimensions,this._shouldUpdateAnchor=m||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};s.OverviewRulerRenderer=r=u([p(2,S.IBufferService),p(3,S.IDecorationService),p(4,h.IRenderService),p(5,S.IOptionsService),p(6,h.ICoreBrowserService)],r)},2950:function(k,s,a){var u=this&&this.__decorate||function(_,n,o,r){var l,m=arguments.length,w=m<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,o):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(_,n,o,r);else for(var b=_.length-1;b>=0;b--)(l=_[b])&&(w=(m<3?l(w):m>3?l(n,o,w):l(n,o))||w);return m>3&&w&&Object.defineProperty(n,o,w),w},p=this&&this.__param||function(_,n){return function(o,r){n(o,r,_)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CompositionHelper=void 0;const c=a(4725),h=a(2585),f=a(2584);let S=s.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(_,n,o,r,l,m){this._textarea=_,this._compositionView=n,this._bufferService=o,this._optionsService=r,this._coreService=l,this._renderService=m,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(_){this._compositionView.textContent=_.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(_){if(this._isComposing||this._isSendingComposition){if(_.keyCode===229||_.keyCode===16||_.keyCode===17||_.keyCode===18)return!1;this._finalizeComposition(!1)}return _.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(_){if(this._compositionView.classList.remove("active"),this._isComposing=!1,_){const n={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let o;this._isSendingComposition=!1,n.start+=this._dataAlreadySent.length,o=this._isComposing?this._textarea.value.substring(n.start,n.end):this._textarea.value.substring(n.start),o.length>0&&this._coreService.triggerDataEvent(o,!0)}},0)}else{this._isSendingComposition=!1;const n=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(n,!0)}}_handleAnyTextareaChanges(){const _=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const n=this._textarea.value,o=n.replace(_,"");this._dataAlreadySent=o,n.length>_.length?this._coreService.triggerDataEvent(o,!0):n.length<_.length?this._coreService.triggerDataEvent(`${f.C0.DEL}`,!0):n.length===_.length&&n!==_&&this._coreService.triggerDataEvent(n,!0)}},0)}updateCompositionElements(_){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const n=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),o=this._renderService.dimensions.css.cell.height,r=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,l=n*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=l+"px",this._compositionView.style.top=r+"px",this._compositionView.style.height=o+"px",this._compositionView.style.lineHeight=o+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const m=this._compositionView.getBoundingClientRect();this._textarea.style.left=l+"px",this._textarea.style.top=r+"px",this._textarea.style.width=Math.max(m.width,1)+"px",this._textarea.style.height=Math.max(m.height,1)+"px",this._textarea.style.lineHeight=m.height+"px"}_||setTimeout(()=>this.updateCompositionElements(!0),0)}}};s.CompositionHelper=S=u([p(2,h.IBufferService),p(3,h.IOptionsService),p(4,h.ICoreService),p(5,c.IRenderService)],S)},9806:(k,s)=>{function a(u,p,c){const h=c.getBoundingClientRect(),f=u.getComputedStyle(c),S=parseInt(f.getPropertyValue("padding-left")),_=parseInt(f.getPropertyValue("padding-top"));return[p.clientX-h.left-S,p.clientY-h.top-_]}Object.defineProperty(s,"__esModule",{value:!0}),s.getCoords=s.getCoordsRelativeToElement=void 0,s.getCoordsRelativeToElement=a,s.getCoords=function(u,p,c,h,f,S,_,n,o){if(!S)return;const r=a(u,p,c);return r?(r[0]=Math.ceil((r[0]+(o?_/2:0))/_),r[1]=Math.ceil(r[1]/n),r[0]=Math.min(Math.max(r[0],1),h+(o?1:0)),r[1]=Math.min(Math.max(r[1],1),f),r):void 0}},9504:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.moveToCellSequence=void 0;const u=a(2584);function p(n,o,r,l){const m=n-c(n,r),w=o-c(o,r),b=Math.abs(m-w)-function(x,g,C){let T=0;const A=x-c(x,C),B=g-c(g,C);for(let D=0;D<Math.abs(A-B);D++){const j=h(x,g)==="A"?-1:1;C.buffer.lines.get(A+j*D)?.isWrapped&&T++}return T}(n,o,r);return _(b,S(h(n,o),l))}function c(n,o){let r=0,l=o.buffer.lines.get(n),m=l?.isWrapped;for(;m&&n>=0&&n<o.rows;)r++,l=o.buffer.lines.get(--n),m=l?.isWrapped;return r}function h(n,o){return n>o?"A":"B"}function f(n,o,r,l,m,w){let b=n,x=o,g="";for(;b!==r||x!==l;)b+=m?1:-1,m&&b>w.cols-1?(g+=w.buffer.translateBufferLineToString(x,!1,n,b),b=0,n=0,x++):!m&&b<0&&(g+=w.buffer.translateBufferLineToString(x,!1,0,n+1),b=w.cols-1,n=b,x--);return g+w.buffer.translateBufferLineToString(x,!1,n,b)}function S(n,o){const r=o?"O":"[";return u.C0.ESC+r+n}function _(n,o){n=Math.floor(n);let r="";for(let l=0;l<n;l++)r+=o;return r}s.moveToCellSequence=function(n,o,r,l){const m=r.buffer.x,w=r.buffer.y;if(!r.buffer.hasScrollback)return function(g,C,T,A,B,D){return p(C,A,B,D).length===0?"":_(f(g,C,g,C-c(C,B),!1,B).length,S("D",D))}(m,w,0,o,r,l)+p(w,o,r,l)+function(g,C,T,A,B,D){let j;j=p(C,A,B,D).length>0?A-c(A,B):C;const W=A,U=function(J,K,R,P,M,O){let H;return H=p(R,P,M,O).length>0?P-c(P,M):K,J<R&&H<=P||J>=R&&H<P?"C":"D"}(g,C,T,A,B,D);return _(f(g,j,T,W,U==="C",B).length,S(U,D))}(m,w,n,o,r,l);let b;if(w===o)return b=m>n?"D":"C",_(Math.abs(m-n),S(b,l));b=w>o?"D":"C";const x=Math.abs(w-o);return _(function(g,C){return C.cols-g}(w>o?n:m,r)+(x-1)*r.cols+1+((w>o?m:n)-1),S(b,l))}},1296:function(k,s,a){var u=this&&this.__decorate||function(D,j,W,U){var J,K=arguments.length,R=K<3?j:U===null?U=Object.getOwnPropertyDescriptor(j,W):U;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(D,j,W,U);else for(var P=D.length-1;P>=0;P--)(J=D[P])&&(R=(K<3?J(R):K>3?J(j,W,R):J(j,W))||R);return K>3&&R&&Object.defineProperty(j,W,R),R},p=this&&this.__param||function(D,j){return function(W,U){j(W,U,D)}};Object.defineProperty(s,"__esModule",{value:!0}),s.DomRenderer=void 0;const c=a(3787),h=a(2550),f=a(2223),S=a(6171),_=a(6052),n=a(4725),o=a(8055),r=a(8460),l=a(844),m=a(2585),w="xterm-dom-renderer-owner-",b="xterm-rows",x="xterm-fg-",g="xterm-bg-",C="xterm-focus",T="xterm-selection";let A=1,B=s.DomRenderer=class extends l.Disposable{constructor(D,j,W,U,J,K,R,P,M,O,H,z,q){super(),this._terminal=D,this._document=j,this._element=W,this._screenElement=U,this._viewportElement=J,this._helperContainer=K,this._linkifier2=R,this._charSizeService=M,this._optionsService=O,this._bufferService=H,this._coreBrowserService=z,this._themeService=q,this._terminalClass=A++,this._rowElements=[],this._selectionRenderModel=(0,_.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new r.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(b),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(T),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,S.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(V=>this._injectCss(V))),this._injectCss(this._themeService.colors),this._rowFactory=P.createInstance(c.DomRendererRowFactory,document),this._element.classList.add(w+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(V=>this._handleLinkHover(V))),this.register(this._linkifier2.onHideLinkUnderline(V=>this._handleLinkLeave(V))),this.register((0,l.toDisposable)(()=>{this._element.classList.remove(w+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new h.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const D=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*D,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*D),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/D),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/D),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const W of this._rowElements)W.style.width=`${this.dimensions.css.canvas.width}px`,W.style.height=`${this.dimensions.css.cell.height}px`,W.style.lineHeight=`${this.dimensions.css.cell.height}px`,W.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const j=`${this._terminalSelector} .${b} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=j,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(D){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let j=`${this._terminalSelector} .${b} { color: ${D.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;j+=`${this._terminalSelector} .${b} .xterm-dim { color: ${o.color.multiplyOpacity(D.foreground,.5).css};}`,j+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const W=`blink_underline_${this._terminalClass}`,U=`blink_bar_${this._terminalClass}`,J=`blink_block_${this._terminalClass}`;j+=`@keyframes ${W} { 50% {  border-bottom-style: hidden; }}`,j+=`@keyframes ${U} { 50% {  box-shadow: none; }}`,j+=`@keyframes ${J} { 0% {  background-color: ${D.cursor.css};  color: ${D.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${D.cursor.css}; }}`,j+=`${this._terminalSelector} .${b}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${W} 1s step-end infinite;}${this._terminalSelector} .${b}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${U} 1s step-end infinite;}${this._terminalSelector} .${b}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${J} 1s step-end infinite;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-block { background-color: ${D.cursor.css}; color: ${D.cursorAccent.css};}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${D.cursor.css} !important; color: ${D.cursorAccent.css} !important;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${D.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${D.cursor.css} inset;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${D.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,j+=`${this._terminalSelector} .${T} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${T} div { position: absolute; background-color: ${D.selectionBackgroundOpaque.css};}${this._terminalSelector} .${T} div { position: absolute; background-color: ${D.selectionInactiveBackgroundOpaque.css};}`;for(const[K,R]of D.ansi.entries())j+=`${this._terminalSelector} .${x}${K} { color: ${R.css}; }${this._terminalSelector} .${x}${K}.xterm-dim { color: ${o.color.multiplyOpacity(R,.5).css}; }${this._terminalSelector} .${g}${K} { background-color: ${R.css}; }`;j+=`${this._terminalSelector} .${x}${f.INVERTED_DEFAULT_COLOR} { color: ${o.color.opaque(D.background).css}; }${this._terminalSelector} .${x}${f.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${o.color.multiplyOpacity(o.color.opaque(D.background),.5).css}; }${this._terminalSelector} .${g}${f.INVERTED_DEFAULT_COLOR} { background-color: ${D.foreground.css}; }`,this._themeStyleElement.textContent=j}_setDefaultSpacing(){const D=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${D}px`,this._rowFactory.defaultSpacing=D}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(D,j){for(let W=this._rowElements.length;W<=j;W++){const U=this._document.createElement("div");this._rowContainer.appendChild(U),this._rowElements.push(U)}for(;this._rowElements.length>j;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(D,j){this._refreshRowElements(D,j),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(C),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(C),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(D,j,W){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(D,j,W),this.renderRows(0,this._bufferService.rows-1),!D||!j)return;this._selectionRenderModel.update(this._terminal,D,j,W);const U=this._selectionRenderModel.viewportStartRow,J=this._selectionRenderModel.viewportEndRow,K=this._selectionRenderModel.viewportCappedStartRow,R=this._selectionRenderModel.viewportCappedEndRow;if(K>=this._bufferService.rows||R<0)return;const P=this._document.createDocumentFragment();if(W){const M=D[0]>j[0];P.appendChild(this._createSelectionElement(K,M?j[0]:D[0],M?D[0]:j[0],R-K+1))}else{const M=U===K?D[0]:0,O=K===J?j[0]:this._bufferService.cols;P.appendChild(this._createSelectionElement(K,M,O));const H=R-K-1;if(P.appendChild(this._createSelectionElement(K+1,0,this._bufferService.cols,H)),K!==R){const z=J===R?j[0]:this._bufferService.cols;P.appendChild(this._createSelectionElement(R,0,z))}}this._selectionContainer.appendChild(P)}_createSelectionElement(D,j,W,U=1){const J=this._document.createElement("div"),K=j*this.dimensions.css.cell.width;let R=this.dimensions.css.cell.width*(W-j);return K+R>this.dimensions.css.canvas.width&&(R=this.dimensions.css.canvas.width-K),J.style.height=U*this.dimensions.css.cell.height+"px",J.style.top=D*this.dimensions.css.cell.height+"px",J.style.left=`${K}px`,J.style.width=`${R}px`,J}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const D of this._rowElements)D.replaceChildren()}renderRows(D,j){const W=this._bufferService.buffer,U=W.ybase+W.y,J=Math.min(W.x,this._bufferService.cols-1),K=this._optionsService.rawOptions.cursorBlink,R=this._optionsService.rawOptions.cursorStyle,P=this._optionsService.rawOptions.cursorInactiveStyle;for(let M=D;M<=j;M++){const O=M+W.ydisp,H=this._rowElements[M],z=W.lines.get(O);if(!H||!z)break;H.replaceChildren(...this._rowFactory.createRow(z,O,O===U,R,P,J,K,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${w}${this._terminalClass}`}_handleLinkHover(D){this._setCellUnderline(D.x1,D.x2,D.y1,D.y2,D.cols,!0)}_handleLinkLeave(D){this._setCellUnderline(D.x1,D.x2,D.y1,D.y2,D.cols,!1)}_setCellUnderline(D,j,W,U,J,K){W<0&&(D=0),U<0&&(j=0);const R=this._bufferService.rows-1;W=Math.max(Math.min(W,R),0),U=Math.max(Math.min(U,R),0),J=Math.min(J,this._bufferService.cols);const P=this._bufferService.buffer,M=P.ybase+P.y,O=Math.min(P.x,J-1),H=this._optionsService.rawOptions.cursorBlink,z=this._optionsService.rawOptions.cursorStyle,q=this._optionsService.rawOptions.cursorInactiveStyle;for(let V=W;V<=U;++V){const I=V+P.ydisp,L=this._rowElements[V],F=P.lines.get(I);if(!L||!F)break;L.replaceChildren(...this._rowFactory.createRow(F,I,I===M,z,q,O,H,this.dimensions.css.cell.width,this._widthCache,K?V===W?D:0:-1,K?(V===U?j:J)-1:-1))}}};s.DomRenderer=B=u([p(7,m.IInstantiationService),p(8,n.ICharSizeService),p(9,m.IOptionsService),p(10,m.IBufferService),p(11,n.ICoreBrowserService),p(12,n.IThemeService)],B)},3787:function(k,s,a){var u=this&&this.__decorate||function(b,x,g,C){var T,A=arguments.length,B=A<3?x:C===null?C=Object.getOwnPropertyDescriptor(x,g):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(b,x,g,C);else for(var D=b.length-1;D>=0;D--)(T=b[D])&&(B=(A<3?T(B):A>3?T(x,g,B):T(x,g))||B);return A>3&&B&&Object.defineProperty(x,g,B),B},p=this&&this.__param||function(b,x){return function(g,C){x(g,C,b)}};Object.defineProperty(s,"__esModule",{value:!0}),s.DomRendererRowFactory=void 0;const c=a(2223),h=a(643),f=a(511),S=a(2585),_=a(8055),n=a(4725),o=a(4269),r=a(6171),l=a(3734);let m=s.DomRendererRowFactory=class{constructor(b,x,g,C,T,A,B){this._document=b,this._characterJoinerService=x,this._optionsService=g,this._coreBrowserService=C,this._coreService=T,this._decorationService=A,this._themeService=B,this._workCell=new f.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(b,x,g){this._selectionStart=b,this._selectionEnd=x,this._columnSelectMode=g}createRow(b,x,g,C,T,A,B,D,j,W,U){const J=[],K=this._characterJoinerService.getJoinedCharacters(x),R=this._themeService.colors;let P,M=b.getNoBgTrimmedLength();g&&M<A+1&&(M=A+1);let O=0,H="",z=0,q=0,V=0,I=!1,L=0,F=!1,$=0;const X=[],G=W!==-1&&U!==-1;for(let Y=0;Y<M;Y++){b.loadCell(Y,this._workCell);let se=this._workCell.getWidth();if(se===0)continue;let re=!1,he=Y,Z=this._workCell;if(K.length>0&&Y===K[0][0]){re=!0;const oe=K.shift();Z=new o.JoinedCellData(this._workCell,b.translateToString(!0,oe[0],oe[1]),oe[1]-oe[0]),he=oe[1]-1,se=Z.getWidth()}const le=this._isCellInSelection(Y,x),He=g&&Y===A,Xe=G&&Y>=W&&Y<=U;let Ee=!1;this._decorationService.forEachDecorationAtCell(Y,x,void 0,oe=>{Ee=!0});let Me=Z.getChars()||h.WHITESPACE_CELL_CHAR;if(Me===" "&&(Z.isUnderline()||Z.isOverline())&&(Me=" "),$=se*D-j.get(Me,Z.isBold(),Z.isItalic()),P){if(O&&(le&&F||!le&&!F&&Z.bg===z)&&(le&&F&&R.selectionForeground||Z.fg===q)&&Z.extended.ext===V&&Xe===I&&$===L&&!He&&!re&&!Ee){Z.isInvisible()?H+=h.WHITESPACE_CELL_CHAR:H+=Me,O++;continue}O&&(P.textContent=H),P=this._document.createElement("span"),O=0,H=""}else P=this._document.createElement("span");if(z=Z.bg,q=Z.fg,V=Z.extended.ext,I=Xe,L=$,F=le,re&&A>=Y&&A<=he&&(A=Y),!this._coreService.isCursorHidden&&He&&this._coreService.isCursorInitialized){if(X.push("xterm-cursor"),this._coreBrowserService.isFocused)B&&X.push("xterm-cursor-blink"),X.push(C==="bar"?"xterm-cursor-bar":C==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(T)switch(T){case"outline":X.push("xterm-cursor-outline");break;case"block":X.push("xterm-cursor-block");break;case"bar":X.push("xterm-cursor-bar");break;case"underline":X.push("xterm-cursor-underline")}}if(Z.isBold()&&X.push("xterm-bold"),Z.isItalic()&&X.push("xterm-italic"),Z.isDim()&&X.push("xterm-dim"),H=Z.isInvisible()?h.WHITESPACE_CELL_CHAR:Z.getChars()||h.WHITESPACE_CELL_CHAR,Z.isUnderline()&&(X.push(`xterm-underline-${Z.extended.underlineStyle}`),H===" "&&(H=" "),!Z.isUnderlineColorDefault()))if(Z.isUnderlineColorRGB())P.style.textDecorationColor=`rgb(${l.AttributeData.toColorRGB(Z.getUnderlineColor()).join(",")})`;else{let oe=Z.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Z.isBold()&&oe<8&&(oe+=8),P.style.textDecorationColor=R.ansi[oe].css}Z.isOverline()&&(X.push("xterm-overline"),H===" "&&(H=" ")),Z.isStrikethrough()&&X.push("xterm-strikethrough"),Xe&&(P.style.textDecoration="underline");let fe=Z.getFgColor(),Je=Z.getFgColorMode(),be=Z.getBgColor(),Ye=Z.getBgColorMode();const jt=!!Z.isInverse();if(jt){const oe=fe;fe=be,be=oe;const Ti=Je;Je=Ye,Ye=Ti}let Re,at,Le,Ze=!1;switch(this._decorationService.forEachDecorationAtCell(Y,x,void 0,oe=>{oe.options.layer!=="top"&&Ze||(oe.backgroundColorRGB&&(Ye=50331648,be=oe.backgroundColorRGB.rgba>>8&16777215,Re=oe.backgroundColorRGB),oe.foregroundColorRGB&&(Je=50331648,fe=oe.foregroundColorRGB.rgba>>8&16777215,at=oe.foregroundColorRGB),Ze=oe.options.layer==="top")}),!Ze&&le&&(Re=this._coreBrowserService.isFocused?R.selectionBackgroundOpaque:R.selectionInactiveBackgroundOpaque,be=Re.rgba>>8&16777215,Ye=50331648,Ze=!0,R.selectionForeground&&(Je=50331648,fe=R.selectionForeground.rgba>>8&16777215,at=R.selectionForeground)),Ze&&X.push("xterm-decoration-top"),Ye){case 16777216:case 33554432:Le=R.ansi[be],X.push(`xterm-bg-${be}`);break;case 50331648:Le=_.channels.toColor(be>>16,be>>8&255,255&be),this._addStyle(P,`background-color:#${w((be>>>0).toString(16),"0",6)}`);break;default:jt?(Le=R.foreground,X.push(`xterm-bg-${c.INVERTED_DEFAULT_COLOR}`)):Le=R.background}switch(Re||Z.isDim()&&(Re=_.color.multiplyOpacity(Le,.5)),Je){case 16777216:case 33554432:Z.isBold()&&fe<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(fe+=8),this._applyMinimumContrast(P,Le,R.ansi[fe],Z,Re,void 0)||X.push(`xterm-fg-${fe}`);break;case 50331648:const oe=_.channels.toColor(fe>>16&255,fe>>8&255,255&fe);this._applyMinimumContrast(P,Le,oe,Z,Re,at)||this._addStyle(P,`color:#${w(fe.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(P,Le,R.foreground,Z,Re,at)||jt&&X.push(`xterm-fg-${c.INVERTED_DEFAULT_COLOR}`)}X.length&&(P.className=X.join(" "),X.length=0),He||re||Ee?P.textContent=H:O++,$!==this.defaultSpacing&&(P.style.letterSpacing=`${$}px`),J.push(P),Y=he}return P&&O&&(P.textContent=H),J}_applyMinimumContrast(b,x,g,C,T,A){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,r.treatGlyphAsBackgroundColor)(C.getCode()))return!1;const B=this._getContrastCache(C);let D;if(T||A||(D=B.getColor(x.rgba,g.rgba)),D===void 0){const j=this._optionsService.rawOptions.minimumContrastRatio/(C.isDim()?2:1);D=_.color.ensureContrastRatio(T||x,A||g,j),B.setColor((T||x).rgba,(A||g).rgba,D??null)}return!!D&&(this._addStyle(b,`color:${D.css}`),!0)}_getContrastCache(b){return b.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(b,x){b.setAttribute("style",`${b.getAttribute("style")||""}${x};`)}_isCellInSelection(b,x){const g=this._selectionStart,C=this._selectionEnd;return!(!g||!C)&&(this._columnSelectMode?g[0]<=C[0]?b>=g[0]&&x>=g[1]&&b<C[0]&&x<=C[1]:b<g[0]&&x>=g[1]&&b>=C[0]&&x<=C[1]:x>g[1]&&x<C[1]||g[1]===C[1]&&x===g[1]&&b>=g[0]&&b<C[0]||g[1]<C[1]&&x===C[1]&&b<C[0]||g[1]<C[1]&&x===g[1]&&b>=g[0])}};function w(b,x,g){for(;b.length<g;)b=x+b;return b}s.DomRendererRowFactory=m=u([p(1,n.ICharacterJoinerService),p(2,S.IOptionsService),p(3,n.ICoreBrowserService),p(4,S.ICoreService),p(5,S.IDecorationService),p(6,n.IThemeService)],m)},2550:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WidthCache=void 0,s.WidthCache=class{constructor(a,u){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const p=a.createElement("span");p.classList.add("xterm-char-measure-element");const c=a.createElement("span");c.classList.add("xterm-char-measure-element"),c.style.fontWeight="bold";const h=a.createElement("span");h.classList.add("xterm-char-measure-element"),h.style.fontStyle="italic";const f=a.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontWeight="bold",f.style.fontStyle="italic",this._measureElements=[p,c,h,f],this._container.appendChild(p),this._container.appendChild(c),this._container.appendChild(h),this._container.appendChild(f),u.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,u,p,c){a===this._font&&u===this._fontSize&&p===this._weight&&c===this._weightBold||(this._font=a,this._fontSize=u,this._weight=p,this._weightBold=c,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${p}`,this._measureElements[1].style.fontWeight=`${c}`,this._measureElements[2].style.fontWeight=`${p}`,this._measureElements[3].style.fontWeight=`${c}`,this.clear())}get(a,u,p){let c=0;if(!u&&!p&&a.length===1&&(c=a.charCodeAt(0))<256){if(this._flat[c]!==-9999)return this._flat[c];const S=this._measure(a,0);return S>0&&(this._flat[c]=S),S}let h=a;u&&(h+="B"),p&&(h+="I");let f=this._holey.get(h);if(f===void 0){let S=0;u&&(S|=1),p&&(S|=2),f=this._measure(a,S),f>0&&this._holey.set(h,f)}return f}_measure(a,u){const p=this._measureElements[u];return p.textContent=a.repeat(32),p.offsetWidth/32}}},2223:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TEXT_BASELINE=s.DIM_OPACITY=s.INVERTED_DEFAULT_COLOR=void 0;const u=a(6114);s.INVERTED_DEFAULT_COLOR=257,s.DIM_OPACITY=.5,s.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic"},6171:(k,s)=>{function a(p){return 57508<=p&&p<=57558}function u(p){return p>=128512&&p<=128591||p>=127744&&p<=128511||p>=128640&&p<=128767||p>=9728&&p<=9983||p>=9984&&p<=10175||p>=65024&&p<=65039||p>=129280&&p<=129535||p>=127462&&p<=127487}Object.defineProperty(s,"__esModule",{value:!0}),s.computeNextVariantOffset=s.createRenderDimensions=s.treatGlyphAsBackgroundColor=s.allowRescaling=s.isEmoji=s.isRestrictedPowerlineGlyph=s.isPowerlineGlyph=s.throwIfFalsy=void 0,s.throwIfFalsy=function(p){if(!p)throw new Error("value must not be falsy");return p},s.isPowerlineGlyph=a,s.isRestrictedPowerlineGlyph=function(p){return 57520<=p&&p<=57527},s.isEmoji=u,s.allowRescaling=function(p,c,h,f){return c===1&&h>Math.ceil(1.5*f)&&p!==void 0&&p>255&&!u(p)&&!a(p)&&!function(S){return 57344<=S&&S<=63743}(p)},s.treatGlyphAsBackgroundColor=function(p){return a(p)||function(c){return 9472<=c&&c<=9631}(p)},s.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},s.computeNextVariantOffset=function(p,c,h=0){return(p-(2*Math.round(c)-h))%(2*Math.round(c))}},6052:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(p,c,h,f=!1){if(this.selectionStart=c,this.selectionEnd=h,!c||!h||c[0]===h[0]&&c[1]===h[1])return void this.clear();const S=p.buffers.active.ydisp,_=c[1]-S,n=h[1]-S,o=Math.max(_,0),r=Math.min(n,p.rows-1);o>=p.rows||r<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=f,this.viewportStartRow=_,this.viewportEndRow=n,this.viewportCappedStartRow=o,this.viewportCappedEndRow=r,this.startCol=c[0],this.endCol=h[0])}isCellSelected(p,c,h){return!!this.hasSelection&&(h-=p.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?c>=this.startCol&&h>=this.viewportCappedStartRow&&c<this.endCol&&h<=this.viewportCappedEndRow:c<this.startCol&&h>=this.viewportCappedStartRow&&c>=this.endCol&&h<=this.viewportCappedEndRow:h>this.viewportStartRow&&h<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&h===this.viewportStartRow&&c>=this.startCol&&c<this.endCol||this.viewportStartRow<this.viewportEndRow&&h===this.viewportEndRow&&c<this.endCol||this.viewportStartRow<this.viewportEndRow&&h===this.viewportStartRow&&c>=this.startCol)}}s.createSelectionRenderModel=function(){return new a}},456:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SelectionModel=void 0,s.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const a=this.selectionStart,u=this.selectionEnd;return!(!a||!u)&&(a[1]>u[1]||a[1]===u[1]&&a[0]>u[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(k,s,a){var u=this&&this.__decorate||function(r,l,m,w){var b,x=arguments.length,g=x<3?l:w===null?w=Object.getOwnPropertyDescriptor(l,m):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(r,l,m,w);else for(var C=r.length-1;C>=0;C--)(b=r[C])&&(g=(x<3?b(g):x>3?b(l,m,g):b(l,m))||g);return x>3&&g&&Object.defineProperty(l,m,g),g},p=this&&this.__param||function(r,l){return function(m,w){l(m,w,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CharSizeService=void 0;const c=a(2585),h=a(8460),f=a(844);let S=s.CharSizeService=class extends f.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(r,l,m){super(),this._optionsService=m,this.width=0,this.height=0,this._onCharSizeChange=this.register(new h.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new o(this._optionsService))}catch{this._measureStrategy=this.register(new n(r,l,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const r=this._measureStrategy.measure();r.width===this.width&&r.height===this.height||(this.width=r.width,this.height=r.height,this._onCharSizeChange.fire())}};s.CharSizeService=S=u([p(2,c.IOptionsService)],S);class _ extends f.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(l,m){l!==void 0&&l>0&&m!==void 0&&m>0&&(this._result.width=l,this._result.height=m)}}class n extends _{constructor(l,m,w){super(),this._document=l,this._parentElement=m,this._optionsService=w,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class o extends _{constructor(l){super(),this._optionsService=l,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const m=this._ctx.measureText("W");if(!("width"in m&&"fontBoundingBoxAscent"in m&&"fontBoundingBoxDescent"in m))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const l=this._ctx.measureText("W");return this._validateAndSet(l.width,l.fontBoundingBoxAscent+l.fontBoundingBoxDescent),this._result}}},4269:function(k,s,a){var u=this&&this.__decorate||function(o,r,l,m){var w,b=arguments.length,x=b<3?r:m===null?m=Object.getOwnPropertyDescriptor(r,l):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(o,r,l,m);else for(var g=o.length-1;g>=0;g--)(w=o[g])&&(x=(b<3?w(x):b>3?w(r,l,x):w(r,l))||x);return b>3&&x&&Object.defineProperty(r,l,x),x},p=this&&this.__param||function(o,r){return function(l,m){r(l,m,o)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CharacterJoinerService=s.JoinedCellData=void 0;const c=a(3734),h=a(643),f=a(511),S=a(2585);class _ extends c.AttributeData{constructor(r,l,m){super(),this.content=0,this.combinedData="",this.fg=r.fg,this.bg=r.bg,this.combinedData=l,this._width=m}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(r){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}s.JoinedCellData=_;let n=s.CharacterJoinerService=class bi{constructor(r){this._bufferService=r,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new f.CellData}register(r){const l={id:this._nextCharacterJoinerId++,handler:r};return this._characterJoiners.push(l),l.id}deregister(r){for(let l=0;l<this._characterJoiners.length;l++)if(this._characterJoiners[l].id===r)return this._characterJoiners.splice(l,1),!0;return!1}getJoinedCharacters(r){if(this._characterJoiners.length===0)return[];const l=this._bufferService.buffer.lines.get(r);if(!l||l.length===0)return[];const m=[],w=l.translateToString(!0);let b=0,x=0,g=0,C=l.getFg(0),T=l.getBg(0);for(let A=0;A<l.getTrimmedLength();A++)if(l.loadCell(A,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==C||this._workCell.bg!==T){if(A-b>1){const B=this._getJoinedRanges(w,g,x,l,b);for(let D=0;D<B.length;D++)m.push(B[D])}b=A,g=x,C=this._workCell.fg,T=this._workCell.bg}x+=this._workCell.getChars().length||h.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-b>1){const A=this._getJoinedRanges(w,g,x,l,b);for(let B=0;B<A.length;B++)m.push(A[B])}return m}_getJoinedRanges(r,l,m,w,b){const x=r.substring(l,m);let g=[];try{g=this._characterJoiners[0].handler(x)}catch(C){console.error(C)}for(let C=1;C<this._characterJoiners.length;C++)try{const T=this._characterJoiners[C].handler(x);for(let A=0;A<T.length;A++)bi._mergeRanges(g,T[A])}catch(T){console.error(T)}return this._stringRangesToCellRanges(g,w,b),g}_stringRangesToCellRanges(r,l,m){let w=0,b=!1,x=0,g=r[w];if(g){for(let C=m;C<this._bufferService.cols;C++){const T=l.getWidth(C),A=l.getString(C).length||h.WHITESPACE_CELL_CHAR.length;if(T!==0){if(!b&&g[0]<=x&&(g[0]=C,b=!0),g[1]<=x){if(g[1]=C,g=r[++w],!g)break;g[0]<=x?(g[0]=C,b=!0):b=!1}x+=A}}g&&(g[1]=this._bufferService.cols)}}static _mergeRanges(r,l){let m=!1;for(let w=0;w<r.length;w++){const b=r[w];if(m){if(l[1]<=b[0])return r[w-1][1]=l[1],r;if(l[1]<=b[1])return r[w-1][1]=Math.max(l[1],b[1]),r.splice(w,1),r;r.splice(w,1),w--}else{if(l[1]<=b[0])return r.splice(w,0,l),r;if(l[1]<=b[1])return b[0]=Math.min(l[0],b[0]),r;l[0]<b[1]&&(b[0]=Math.min(l[0],b[0]),m=!0)}}return m?r[r.length-1][1]=l[1]:r.push(l),r}};s.CharacterJoinerService=n=u([p(0,S.IBufferService)],n)},5114:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CoreBrowserService=void 0;const u=a(844),p=a(8460),c=a(3656);class h extends u.Disposable{constructor(_,n,o){super(),this._textarea=_,this._window=n,this.mainDocument=o,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new f(this._window),this._onDprChange=this.register(new p.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new p.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(r=>this._screenDprMonitor.setWindow(r))),this.register((0,p.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(_){this._window!==_&&(this._window=_,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}s.CoreBrowserService=h;class f extends u.Disposable{constructor(_){super(),this._parentWindow=_,this._windowResizeListener=this.register(new u.MutableDisposable),this._onDprChange=this.register(new p.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,u.toDisposable)(()=>this.clearListener()))}setWindow(_){this._parentWindow=_,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,c.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.LinkProviderService=void 0;const u=a(844);class p extends u.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,u.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(h){return this.linkProviders.push(h),{dispose:()=>{const f=this.linkProviders.indexOf(h);f!==-1&&this.linkProviders.splice(f,1)}}}}s.LinkProviderService=p},8934:function(k,s,a){var u=this&&this.__decorate||function(S,_,n,o){var r,l=arguments.length,m=l<3?_:o===null?o=Object.getOwnPropertyDescriptor(_,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(S,_,n,o);else for(var w=S.length-1;w>=0;w--)(r=S[w])&&(m=(l<3?r(m):l>3?r(_,n,m):r(_,n))||m);return l>3&&m&&Object.defineProperty(_,n,m),m},p=this&&this.__param||function(S,_){return function(n,o){_(n,o,S)}};Object.defineProperty(s,"__esModule",{value:!0}),s.MouseService=void 0;const c=a(4725),h=a(9806);let f=s.MouseService=class{constructor(S,_){this._renderService=S,this._charSizeService=_}getCoords(S,_,n,o,r){return(0,h.getCoords)(window,S,_,n,o,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,r)}getMouseReportCoords(S,_){const n=(0,h.getCoordsRelativeToElement)(window,S,_);if(this._charSizeService.hasValidSize)return n[0]=Math.min(Math.max(n[0],0),this._renderService.dimensions.css.canvas.width-1),n[1]=Math.min(Math.max(n[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(n[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(n[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(n[0]),y:Math.floor(n[1])}}};s.MouseService=f=u([p(0,c.IRenderService),p(1,c.ICharSizeService)],f)},3230:function(k,s,a){var u=this&&this.__decorate||function(r,l,m,w){var b,x=arguments.length,g=x<3?l:w===null?w=Object.getOwnPropertyDescriptor(l,m):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(r,l,m,w);else for(var C=r.length-1;C>=0;C--)(b=r[C])&&(g=(x<3?b(g):x>3?b(l,m,g):b(l,m))||g);return x>3&&g&&Object.defineProperty(l,m,g),g},p=this&&this.__param||function(r,l){return function(m,w){l(m,w,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.RenderService=void 0;const c=a(6193),h=a(4725),f=a(8460),S=a(844),_=a(7226),n=a(2585);let o=s.RenderService=class extends S.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(r,l,m,w,b,x,g,C){super(),this._rowCount=r,this._charSizeService=w,this._renderer=this.register(new S.MutableDisposable),this._pausedResizeTask=new _.DebouncedIdleTask,this._observerDisposable=this.register(new S.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new f.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new f.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new f.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new f.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new c.RenderDebouncer((T,A)=>this._renderRows(T,A),g),this.register(this._renderDebouncer),this.register(g.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(x.onResize(()=>this._fullRefresh())),this.register(x.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this.register(m.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(b.onDecorationRegistered(()=>this._fullRefresh())),this.register(b.onDecorationRemoved(()=>this._fullRefresh())),this.register(m.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(x.cols,x.rows),this._fullRefresh()})),this.register(m.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(x.buffer.y,x.buffer.y,!0))),this.register(C.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(g.window,l),this.register(g.onWindowChange(T=>this._registerIntersectionObserver(T,l)))}_registerIntersectionObserver(r,l){if("IntersectionObserver"in r){const m=new r.IntersectionObserver(w=>this._handleIntersectionChange(w[w.length-1]),{threshold:0});m.observe(l),this._observerDisposable.value=(0,S.toDisposable)(()=>m.disconnect())}}_handleIntersectionChange(r){this._isPaused=r.isIntersecting===void 0?r.intersectionRatio===0:!r.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(r,l,m=!1){this._isPaused?this._needsFullRefresh=!0:(m||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(r,l,this._rowCount))}_renderRows(r,l){this._renderer.value&&(r=Math.min(r,this._rowCount-1),l=Math.min(l,this._rowCount-1),this._renderer.value.renderRows(r,l),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:r,end:l}),this._onRender.fire({start:r,end:l}),this._isNextRenderRedrawOnly=!0)}resize(r,l){this._rowCount=l,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(r){this._renderer.value=r,this._renderer.value&&(this._renderer.value.onRequestRedraw(l=>this.refreshRows(l.start,l.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(r){return this._renderDebouncer.addRefreshCallback(r)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(r,l){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(r,l)):this._renderer.value.handleResize(r,l),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(r,l,m){this._selectionState.start=r,this._selectionState.end=l,this._selectionState.columnSelectMode=m,this._renderer.value?.handleSelectionChanged(r,l,m)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};s.RenderService=o=u([p(2,n.IOptionsService),p(3,h.ICharSizeService),p(4,n.IDecorationService),p(5,n.IBufferService),p(6,h.ICoreBrowserService),p(7,h.IThemeService)],o)},9312:function(k,s,a){var u=this&&this.__decorate||function(g,C,T,A){var B,D=arguments.length,j=D<3?C:A===null?A=Object.getOwnPropertyDescriptor(C,T):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(g,C,T,A);else for(var W=g.length-1;W>=0;W--)(B=g[W])&&(j=(D<3?B(j):D>3?B(C,T,j):B(C,T))||j);return D>3&&j&&Object.defineProperty(C,T,j),j},p=this&&this.__param||function(g,C){return function(T,A){C(T,A,g)}};Object.defineProperty(s,"__esModule",{value:!0}),s.SelectionService=void 0;const c=a(9806),h=a(9504),f=a(456),S=a(4725),_=a(8460),n=a(844),o=a(6114),r=a(4841),l=a(511),m=a(2585),w=" ",b=new RegExp(w,"g");let x=s.SelectionService=class extends n.Disposable{constructor(g,C,T,A,B,D,j,W,U){super(),this._element=g,this._screenElement=C,this._linkifier=T,this._bufferService=A,this._coreService=B,this._mouseService=D,this._optionsService=j,this._renderService=W,this._coreBrowserService=U,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new l.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new _.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new _.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new _.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=J=>this._handleMouseMove(J),this._mouseUpListener=J=>this._handleMouseUp(J),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(J=>this._handleTrim(J)),this.register(this._bufferService.buffers.onBufferActivate(J=>this._handleBufferActivate(J))),this.enable(),this._model=new f.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,n.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const g=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;return!(!g||!C||g[0]===C[0]&&g[1]===C[1])}get selectionText(){const g=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;if(!g||!C)return"";const T=this._bufferService.buffer,A=[];if(this._activeSelectionMode===3){if(g[0]===C[0])return"";const B=g[0]<C[0]?g[0]:C[0],D=g[0]<C[0]?C[0]:g[0];for(let j=g[1];j<=C[1];j++){const W=T.translateBufferLineToString(j,!0,B,D);A.push(W)}}else{const B=g[1]===C[1]?C[0]:void 0;A.push(T.translateBufferLineToString(g[1],!0,g[0],B));for(let D=g[1]+1;D<=C[1]-1;D++){const j=T.lines.get(D),W=T.translateBufferLineToString(D,!0);j?.isWrapped?A[A.length-1]+=W:A.push(W)}if(g[1]!==C[1]){const D=T.lines.get(C[1]),j=T.translateBufferLineToString(C[1],!0,0,C[0]);D&&D.isWrapped?A[A.length-1]+=j:A.push(j)}}return A.map(B=>B.replace(b," ")).join(o.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(g){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),o.isLinux&&g&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(g){const C=this._getMouseBufferCoords(g),T=this._model.finalSelectionStart,A=this._model.finalSelectionEnd;return!!(T&&A&&C)&&this._areCoordsInSelection(C,T,A)}isCellInSelection(g,C){const T=this._model.finalSelectionStart,A=this._model.finalSelectionEnd;return!(!T||!A)&&this._areCoordsInSelection([g,C],T,A)}_areCoordsInSelection(g,C,T){return g[1]>C[1]&&g[1]<T[1]||C[1]===T[1]&&g[1]===C[1]&&g[0]>=C[0]&&g[0]<T[0]||C[1]<T[1]&&g[1]===T[1]&&g[0]<T[0]||C[1]<T[1]&&g[1]===C[1]&&g[0]>=C[0]}_selectWordAtCursor(g,C){const T=this._linkifier.currentLink?.link?.range;if(T)return this._model.selectionStart=[T.start.x-1,T.start.y-1],this._model.selectionStartLength=(0,r.getRangeLength)(T,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const A=this._getMouseBufferCoords(g);return!!A&&(this._selectWordAt(A,C),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(g,C){this._model.clearSelection(),g=Math.max(g,0),C=Math.min(C,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,g],this._model.selectionEnd=[this._bufferService.cols,C],this.refresh(),this._onSelectionChange.fire()}_handleTrim(g){this._model.handleTrim(g)&&this.refresh()}_getMouseBufferCoords(g){const C=this._mouseService.getCoords(g,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(C)return C[0]--,C[1]--,C[1]+=this._bufferService.buffer.ydisp,C}_getMouseEventScrollAmount(g){let C=(0,c.getCoordsRelativeToElement)(this._coreBrowserService.window,g,this._screenElement)[1];const T=this._renderService.dimensions.css.canvas.height;return C>=0&&C<=T?0:(C>T&&(C-=T),C=Math.min(Math.max(C,-50),50),C/=50,C/Math.abs(C)+Math.round(14*C))}shouldForceSelection(g){return o.isMac?g.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:g.shiftKey}handleMouseDown(g){if(this._mouseDownTimeStamp=g.timeStamp,(g.button!==2||!this.hasSelection)&&g.button===0){if(!this._enabled){if(!this.shouldForceSelection(g))return;g.stopPropagation()}g.preventDefault(),this._dragScrollAmount=0,this._enabled&&g.shiftKey?this._handleIncrementalClick(g):g.detail===1?this._handleSingleClick(g):g.detail===2?this._handleDoubleClick(g):g.detail===3&&this._handleTripleClick(g),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(g){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(g))}_handleSingleClick(g){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(g)?3:0,this._model.selectionStart=this._getMouseBufferCoords(g),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const C=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);C&&C.length!==this._model.selectionStart[0]&&C.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(g){this._selectWordAtCursor(g,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(g){const C=this._getMouseBufferCoords(g);C&&(this._activeSelectionMode=2,this._selectLineAt(C[1]))}shouldColumnSelect(g){return g.altKey&&!(o.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(g){if(g.stopImmediatePropagation(),!this._model.selectionStart)return;const C=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(g),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(g),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const T=this._bufferService.buffer;if(this._model.selectionEnd[1]<T.lines.length){const A=T.lines.get(this._model.selectionEnd[1]);A&&A.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}C&&C[0]===this._model.selectionEnd[0]&&C[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const g=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(g.ydisp+this._bufferService.rows,g.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=g.ydisp),this.refresh()}}_handleMouseUp(g){const C=g.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&C<500&&g.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const T=this._mouseService.getCoords(g,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(T&&T[0]!==void 0&&T[1]!==void 0){const A=(0,h.moveToCellSequence)(T[0]-1,T[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(A,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const g=this._model.finalSelectionStart,C=this._model.finalSelectionEnd,T=!(!g||!C||g[0]===C[0]&&g[1]===C[1]);T?g&&C&&(this._oldSelectionStart&&this._oldSelectionEnd&&g[0]===this._oldSelectionStart[0]&&g[1]===this._oldSelectionStart[1]&&C[0]===this._oldSelectionEnd[0]&&C[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(g,C,T)):this._oldHasSelection&&this._fireOnSelectionChange(g,C,T)}_fireOnSelectionChange(g,C,T){this._oldSelectionStart=g,this._oldSelectionEnd=C,this._oldHasSelection=T,this._onSelectionChange.fire()}_handleBufferActivate(g){this.clearSelection(),this._trimListener.dispose(),this._trimListener=g.activeBuffer.lines.onTrim(C=>this._handleTrim(C))}_convertViewportColToCharacterIndex(g,C){let T=C;for(let A=0;C>=A;A++){const B=g.loadCell(A,this._workCell).getChars().length;this._workCell.getWidth()===0?T--:B>1&&C!==A&&(T+=B-1)}return T}setSelection(g,C,T){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[g,C],this._model.selectionStartLength=T,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(g){this._isClickInSelection(g)||(this._selectWordAtCursor(g,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(g,C,T=!0,A=!0){if(g[0]>=this._bufferService.cols)return;const B=this._bufferService.buffer,D=B.lines.get(g[1]);if(!D)return;const j=B.translateBufferLineToString(g[1],!1);let W=this._convertViewportColToCharacterIndex(D,g[0]),U=W;const J=g[0]-W;let K=0,R=0,P=0,M=0;if(j.charAt(W)===" "){for(;W>0&&j.charAt(W-1)===" ";)W--;for(;U<j.length&&j.charAt(U+1)===" ";)U++}else{let z=g[0],q=g[0];D.getWidth(z)===0&&(K++,z--),D.getWidth(q)===2&&(R++,q++);const V=D.getString(q).length;for(V>1&&(M+=V-1,U+=V-1);z>0&&W>0&&!this._isCharWordSeparator(D.loadCell(z-1,this._workCell));){D.loadCell(z-1,this._workCell);const I=this._workCell.getChars().length;this._workCell.getWidth()===0?(K++,z--):I>1&&(P+=I-1,W-=I-1),W--,z--}for(;q<D.length&&U+1<j.length&&!this._isCharWordSeparator(D.loadCell(q+1,this._workCell));){D.loadCell(q+1,this._workCell);const I=this._workCell.getChars().length;this._workCell.getWidth()===2?(R++,q++):I>1&&(M+=I-1,U+=I-1),U++,q++}}U++;let O=W+J-K+P,H=Math.min(this._bufferService.cols,U-W+K+R-P-M);if(C||j.slice(W,U).trim()!==""){if(T&&O===0&&D.getCodePoint(0)!==32){const z=B.lines.get(g[1]-1);if(z&&D.isWrapped&&z.getCodePoint(this._bufferService.cols-1)!==32){const q=this._getWordAt([this._bufferService.cols-1,g[1]-1],!1,!0,!1);if(q){const V=this._bufferService.cols-q.start;O-=V,H+=V}}}if(A&&O+H===this._bufferService.cols&&D.getCodePoint(this._bufferService.cols-1)!==32){const z=B.lines.get(g[1]+1);if(z?.isWrapped&&z.getCodePoint(0)!==32){const q=this._getWordAt([0,g[1]+1],!1,!1,!0);q&&(H+=q.length)}}return{start:O,length:H}}}_selectWordAt(g,C){const T=this._getWordAt(g,C);if(T){for(;T.start<0;)T.start+=this._bufferService.cols,g[1]--;this._model.selectionStart=[T.start,g[1]],this._model.selectionStartLength=T.length}}_selectToWordAt(g){const C=this._getWordAt(g,!0);if(C){let T=g[1];for(;C.start<0;)C.start+=this._bufferService.cols,T--;if(!this._model.areSelectionValuesReversed())for(;C.start+C.length>this._bufferService.cols;)C.length-=this._bufferService.cols,T++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?C.start:C.start+C.length,T]}}_isCharWordSeparator(g){return g.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(g.getChars())>=0}_selectLineAt(g){const C=this._bufferService.buffer.getWrappedRangeForLine(g),T={start:{x:0,y:C.first},end:{x:this._bufferService.cols-1,y:C.last}};this._model.selectionStart=[0,C.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,r.getRangeLength)(T,this._bufferService.cols)}};s.SelectionService=x=u([p(3,m.IBufferService),p(4,m.ICoreService),p(5,S.IMouseService),p(6,m.IOptionsService),p(7,S.IRenderService),p(8,S.ICoreBrowserService)],x)},4725:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ILinkProviderService=s.IThemeService=s.ICharacterJoinerService=s.ISelectionService=s.IRenderService=s.IMouseService=s.ICoreBrowserService=s.ICharSizeService=void 0;const u=a(8343);s.ICharSizeService=(0,u.createDecorator)("CharSizeService"),s.ICoreBrowserService=(0,u.createDecorator)("CoreBrowserService"),s.IMouseService=(0,u.createDecorator)("MouseService"),s.IRenderService=(0,u.createDecorator)("RenderService"),s.ISelectionService=(0,u.createDecorator)("SelectionService"),s.ICharacterJoinerService=(0,u.createDecorator)("CharacterJoinerService"),s.IThemeService=(0,u.createDecorator)("ThemeService"),s.ILinkProviderService=(0,u.createDecorator)("LinkProviderService")},6731:function(k,s,a){var u=this&&this.__decorate||function(x,g,C,T){var A,B=arguments.length,D=B<3?g:T===null?T=Object.getOwnPropertyDescriptor(g,C):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")D=Reflect.decorate(x,g,C,T);else for(var j=x.length-1;j>=0;j--)(A=x[j])&&(D=(B<3?A(D):B>3?A(g,C,D):A(g,C))||D);return B>3&&D&&Object.defineProperty(g,C,D),D},p=this&&this.__param||function(x,g){return function(C,T){g(C,T,x)}};Object.defineProperty(s,"__esModule",{value:!0}),s.ThemeService=s.DEFAULT_ANSI_COLORS=void 0;const c=a(7239),h=a(8055),f=a(8460),S=a(844),_=a(2585),n=h.css.toColor("#ffffff"),o=h.css.toColor("#000000"),r=h.css.toColor("#ffffff"),l=h.css.toColor("#000000"),m={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};s.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const x=[h.css.toColor("#2e3436"),h.css.toColor("#cc0000"),h.css.toColor("#4e9a06"),h.css.toColor("#c4a000"),h.css.toColor("#3465a4"),h.css.toColor("#75507b"),h.css.toColor("#06989a"),h.css.toColor("#d3d7cf"),h.css.toColor("#555753"),h.css.toColor("#ef2929"),h.css.toColor("#8ae234"),h.css.toColor("#fce94f"),h.css.toColor("#729fcf"),h.css.toColor("#ad7fa8"),h.css.toColor("#34e2e2"),h.css.toColor("#eeeeec")],g=[0,95,135,175,215,255];for(let C=0;C<216;C++){const T=g[C/36%6|0],A=g[C/6%6|0],B=g[C%6];x.push({css:h.channels.toCss(T,A,B),rgba:h.channels.toRgba(T,A,B)})}for(let C=0;C<24;C++){const T=8+10*C;x.push({css:h.channels.toCss(T,T,T),rgba:h.channels.toRgba(T,T,T)})}return x})());let w=s.ThemeService=class extends S.Disposable{get colors(){return this._colors}constructor(x){super(),this._optionsService=x,this._contrastCache=new c.ColorContrastCache,this._halfContrastCache=new c.ColorContrastCache,this._onChangeColors=this.register(new f.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:n,background:o,cursor:r,cursorAccent:l,selectionForeground:void 0,selectionBackgroundTransparent:m,selectionBackgroundOpaque:h.color.blend(o,m),selectionInactiveBackgroundTransparent:m,selectionInactiveBackgroundOpaque:h.color.blend(o,m),ansi:s.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(x={}){const g=this._colors;if(g.foreground=b(x.foreground,n),g.background=b(x.background,o),g.cursor=b(x.cursor,r),g.cursorAccent=b(x.cursorAccent,l),g.selectionBackgroundTransparent=b(x.selectionBackground,m),g.selectionBackgroundOpaque=h.color.blend(g.background,g.selectionBackgroundTransparent),g.selectionInactiveBackgroundTransparent=b(x.selectionInactiveBackground,g.selectionBackgroundTransparent),g.selectionInactiveBackgroundOpaque=h.color.blend(g.background,g.selectionInactiveBackgroundTransparent),g.selectionForeground=x.selectionForeground?b(x.selectionForeground,h.NULL_COLOR):void 0,g.selectionForeground===h.NULL_COLOR&&(g.selectionForeground=void 0),h.color.isOpaque(g.selectionBackgroundTransparent)&&(g.selectionBackgroundTransparent=h.color.opacity(g.selectionBackgroundTransparent,.3)),h.color.isOpaque(g.selectionInactiveBackgroundTransparent)&&(g.selectionInactiveBackgroundTransparent=h.color.opacity(g.selectionInactiveBackgroundTransparent,.3)),g.ansi=s.DEFAULT_ANSI_COLORS.slice(),g.ansi[0]=b(x.black,s.DEFAULT_ANSI_COLORS[0]),g.ansi[1]=b(x.red,s.DEFAULT_ANSI_COLORS[1]),g.ansi[2]=b(x.green,s.DEFAULT_ANSI_COLORS[2]),g.ansi[3]=b(x.yellow,s.DEFAULT_ANSI_COLORS[3]),g.ansi[4]=b(x.blue,s.DEFAULT_ANSI_COLORS[4]),g.ansi[5]=b(x.magenta,s.DEFAULT_ANSI_COLORS[5]),g.ansi[6]=b(x.cyan,s.DEFAULT_ANSI_COLORS[6]),g.ansi[7]=b(x.white,s.DEFAULT_ANSI_COLORS[7]),g.ansi[8]=b(x.brightBlack,s.DEFAULT_ANSI_COLORS[8]),g.ansi[9]=b(x.brightRed,s.DEFAULT_ANSI_COLORS[9]),g.ansi[10]=b(x.brightGreen,s.DEFAULT_ANSI_COLORS[10]),g.ansi[11]=b(x.brightYellow,s.DEFAULT_ANSI_COLORS[11]),g.ansi[12]=b(x.brightBlue,s.DEFAULT_ANSI_COLORS[12]),g.ansi[13]=b(x.brightMagenta,s.DEFAULT_ANSI_COLORS[13]),g.ansi[14]=b(x.brightCyan,s.DEFAULT_ANSI_COLORS[14]),g.ansi[15]=b(x.brightWhite,s.DEFAULT_ANSI_COLORS[15]),x.extendedAnsi){const C=Math.min(g.ansi.length-16,x.extendedAnsi.length);for(let T=0;T<C;T++)g.ansi[T+16]=b(x.extendedAnsi[T],s.DEFAULT_ANSI_COLORS[T+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(x){this._restoreColor(x),this._onChangeColors.fire(this.colors)}_restoreColor(x){if(x!==void 0)switch(x){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[x]=this._restoreColors.ansi[x]}else for(let g=0;g<this._restoreColors.ansi.length;++g)this._colors.ansi[g]=this._restoreColors.ansi[g]}modifyColors(x){x(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function b(x,g){if(x!==void 0)try{return h.css.toColor(x)}catch{}return g}s.ThemeService=w=u([p(0,_.IOptionsService)],w)},6349:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CircularList=void 0;const u=a(8460),p=a(844);class c extends p.Disposable{constructor(f){super(),this._maxLength=f,this.onDeleteEmitter=this.register(new u.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new u.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new u.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(f){if(this._maxLength===f)return;const S=new Array(f);for(let _=0;_<Math.min(f,this.length);_++)S[_]=this._array[this._getCyclicIndex(_)];this._array=S,this._maxLength=f,this._startIndex=0}get length(){return this._length}set length(f){if(f>this._length)for(let S=this._length;S<f;S++)this._array[S]=void 0;this._length=f}get(f){return this._array[this._getCyclicIndex(f)]}set(f,S){this._array[this._getCyclicIndex(f)]=S}push(f){this._array[this._getCyclicIndex(this._length)]=f,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(f,S,..._){if(S){for(let n=f;n<this._length-S;n++)this._array[this._getCyclicIndex(n)]=this._array[this._getCyclicIndex(n+S)];this._length-=S,this.onDeleteEmitter.fire({index:f,amount:S})}for(let n=this._length-1;n>=f;n--)this._array[this._getCyclicIndex(n+_.length)]=this._array[this._getCyclicIndex(n)];for(let n=0;n<_.length;n++)this._array[this._getCyclicIndex(f+n)]=_[n];if(_.length&&this.onInsertEmitter.fire({index:f,amount:_.length}),this._length+_.length>this._maxLength){const n=this._length+_.length-this._maxLength;this._startIndex+=n,this._length=this._maxLength,this.onTrimEmitter.fire(n)}else this._length+=_.length}trimStart(f){f>this._length&&(f=this._length),this._startIndex+=f,this._length-=f,this.onTrimEmitter.fire(f)}shiftElements(f,S,_){if(!(S<=0)){if(f<0||f>=this._length)throw new Error("start argument out of range");if(f+_<0)throw new Error("Cannot shift elements in list beyond index 0");if(_>0){for(let o=S-1;o>=0;o--)this.set(f+o+_,this.get(f+o));const n=f+S+_-this._length;if(n>0)for(this._length+=n;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let n=0;n<S;n++)this.set(f+n+_,this.get(f+n))}}_getCyclicIndex(f){return(this._startIndex+f)%this._maxLength}}s.CircularList=c},1439:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.clone=void 0,s.clone=function a(u,p=5){if(typeof u!="object")return u;const c=Array.isArray(u)?[]:{};for(const h in u)c[h]=p<=1?u[h]:u[h]&&a(u[h],p-1);return c}},8055:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.contrastRatio=s.toPaddedHex=s.rgba=s.rgb=s.css=s.color=s.channels=s.NULL_COLOR=void 0;let a=0,u=0,p=0,c=0;var h,f,S,_,n;function o(l){const m=l.toString(16);return m.length<2?"0"+m:m}function r(l,m){return l<m?(m+.05)/(l+.05):(l+.05)/(m+.05)}s.NULL_COLOR={css:"#00000000",rgba:0},function(l){l.toCss=function(m,w,b,x){return x!==void 0?`#${o(m)}${o(w)}${o(b)}${o(x)}`:`#${o(m)}${o(w)}${o(b)}`},l.toRgba=function(m,w,b,x=255){return(m<<24|w<<16|b<<8|x)>>>0},l.toColor=function(m,w,b,x){return{css:l.toCss(m,w,b,x),rgba:l.toRgba(m,w,b,x)}}}(h||(s.channels=h={})),function(l){function m(w,b){return c=Math.round(255*b),[a,u,p]=n.toChannels(w.rgba),{css:h.toCss(a,u,p,c),rgba:h.toRgba(a,u,p,c)}}l.blend=function(w,b){if(c=(255&b.rgba)/255,c===1)return{css:b.css,rgba:b.rgba};const x=b.rgba>>24&255,g=b.rgba>>16&255,C=b.rgba>>8&255,T=w.rgba>>24&255,A=w.rgba>>16&255,B=w.rgba>>8&255;return a=T+Math.round((x-T)*c),u=A+Math.round((g-A)*c),p=B+Math.round((C-B)*c),{css:h.toCss(a,u,p),rgba:h.toRgba(a,u,p)}},l.isOpaque=function(w){return(255&w.rgba)==255},l.ensureContrastRatio=function(w,b,x){const g=n.ensureContrastRatio(w.rgba,b.rgba,x);if(g)return h.toColor(g>>24&255,g>>16&255,g>>8&255)},l.opaque=function(w){const b=(255|w.rgba)>>>0;return[a,u,p]=n.toChannels(b),{css:h.toCss(a,u,p),rgba:b}},l.opacity=m,l.multiplyOpacity=function(w,b){return c=255&w.rgba,m(w,c*b/255)},l.toColorRGB=function(w){return[w.rgba>>24&255,w.rgba>>16&255,w.rgba>>8&255]}}(f||(s.color=f={})),function(l){let m,w;try{const b=document.createElement("canvas");b.width=1,b.height=1;const x=b.getContext("2d",{willReadFrequently:!0});x&&(m=x,m.globalCompositeOperation="copy",w=m.createLinearGradient(0,0,1,1))}catch{}l.toColor=function(b){if(b.match(/#[\da-f]{3,8}/i))switch(b.length){case 4:return a=parseInt(b.slice(1,2).repeat(2),16),u=parseInt(b.slice(2,3).repeat(2),16),p=parseInt(b.slice(3,4).repeat(2),16),h.toColor(a,u,p);case 5:return a=parseInt(b.slice(1,2).repeat(2),16),u=parseInt(b.slice(2,3).repeat(2),16),p=parseInt(b.slice(3,4).repeat(2),16),c=parseInt(b.slice(4,5).repeat(2),16),h.toColor(a,u,p,c);case 7:return{css:b,rgba:(parseInt(b.slice(1),16)<<8|255)>>>0};case 9:return{css:b,rgba:parseInt(b.slice(1),16)>>>0}}const x=b.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(x)return a=parseInt(x[1]),u=parseInt(x[2]),p=parseInt(x[3]),c=Math.round(255*(x[5]===void 0?1:parseFloat(x[5]))),h.toColor(a,u,p,c);if(!m||!w)throw new Error("css.toColor: Unsupported css format");if(m.fillStyle=w,m.fillStyle=b,typeof m.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(m.fillRect(0,0,1,1),[a,u,p,c]=m.getImageData(0,0,1,1).data,c!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:h.toRgba(a,u,p,c),css:b}}}(S||(s.css=S={})),function(l){function m(w,b,x){const g=w/255,C=b/255,T=x/255;return .2126*(g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4))+.7152*(C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4))+.0722*(T<=.03928?T/12.92:Math.pow((T+.055)/1.055,2.4))}l.relativeLuminance=function(w){return m(w>>16&255,w>>8&255,255&w)},l.relativeLuminance2=m}(_||(s.rgb=_={})),function(l){function m(b,x,g){const C=b>>24&255,T=b>>16&255,A=b>>8&255;let B=x>>24&255,D=x>>16&255,j=x>>8&255,W=r(_.relativeLuminance2(B,D,j),_.relativeLuminance2(C,T,A));for(;W<g&&(B>0||D>0||j>0);)B-=Math.max(0,Math.ceil(.1*B)),D-=Math.max(0,Math.ceil(.1*D)),j-=Math.max(0,Math.ceil(.1*j)),W=r(_.relativeLuminance2(B,D,j),_.relativeLuminance2(C,T,A));return(B<<24|D<<16|j<<8|255)>>>0}function w(b,x,g){const C=b>>24&255,T=b>>16&255,A=b>>8&255;let B=x>>24&255,D=x>>16&255,j=x>>8&255,W=r(_.relativeLuminance2(B,D,j),_.relativeLuminance2(C,T,A));for(;W<g&&(B<255||D<255||j<255);)B=Math.min(255,B+Math.ceil(.1*(255-B))),D=Math.min(255,D+Math.ceil(.1*(255-D))),j=Math.min(255,j+Math.ceil(.1*(255-j))),W=r(_.relativeLuminance2(B,D,j),_.relativeLuminance2(C,T,A));return(B<<24|D<<16|j<<8|255)>>>0}l.blend=function(b,x){if(c=(255&x)/255,c===1)return x;const g=x>>24&255,C=x>>16&255,T=x>>8&255,A=b>>24&255,B=b>>16&255,D=b>>8&255;return a=A+Math.round((g-A)*c),u=B+Math.round((C-B)*c),p=D+Math.round((T-D)*c),h.toRgba(a,u,p)},l.ensureContrastRatio=function(b,x,g){const C=_.relativeLuminance(b>>8),T=_.relativeLuminance(x>>8);if(r(C,T)<g){if(T<C){const D=m(b,x,g),j=r(C,_.relativeLuminance(D>>8));if(j<g){const W=w(b,x,g);return j>r(C,_.relativeLuminance(W>>8))?D:W}return D}const A=w(b,x,g),B=r(C,_.relativeLuminance(A>>8));if(B<g){const D=m(b,x,g);return B>r(C,_.relativeLuminance(D>>8))?A:D}return A}},l.reduceLuminance=m,l.increaseLuminance=w,l.toChannels=function(b){return[b>>24&255,b>>16&255,b>>8&255,255&b]}}(n||(s.rgba=n={})),s.toPaddedHex=o,s.contrastRatio=r},8969:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CoreTerminal=void 0;const u=a(844),p=a(2585),c=a(4348),h=a(7866),f=a(744),S=a(7302),_=a(6975),n=a(8460),o=a(1753),r=a(1480),l=a(7994),m=a(9282),w=a(5435),b=a(5981),x=a(2660);let g=!1;class C extends u.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new n.EventEmitter),this._onScroll.event(A=>{this._onScrollApi?.fire(A.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(A){for(const B in A)this.optionsService.options[B]=A[B]}constructor(A){super(),this._windowsWrappingHeuristics=this.register(new u.MutableDisposable),this._onBinary=this.register(new n.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new n.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new n.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new n.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new n.EventEmitter),this._instantiationService=new c.InstantiationService,this.optionsService=this.register(new S.OptionsService(A)),this._instantiationService.setService(p.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(f.BufferService)),this._instantiationService.setService(p.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(h.LogService)),this._instantiationService.setService(p.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(_.CoreService)),this._instantiationService.setService(p.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(o.CoreMouseService)),this._instantiationService.setService(p.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(r.UnicodeService)),this._instantiationService.setService(p.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(l.CharsetService),this._instantiationService.setService(p.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(x.OscLinkService),this._instantiationService.setService(p.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new w.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,n.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,n.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,n.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,n.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new b.WriteBuffer((B,D)=>this._inputHandler.parse(B,D))),this.register((0,n.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(A,B){this._writeBuffer.write(A,B)}writeSync(A,B){this._logService.logLevel<=p.LogLevelEnum.WARN&&!g&&(this._logService.warn("writeSync is unreliable and will be removed soon."),g=!0),this._writeBuffer.writeSync(A,B)}input(A,B=!0){this.coreService.triggerDataEvent(A,B)}resize(A,B){isNaN(A)||isNaN(B)||(A=Math.max(A,f.MINIMUM_COLS),B=Math.max(B,f.MINIMUM_ROWS),this._bufferService.resize(A,B))}scroll(A,B=!1){this._bufferService.scroll(A,B)}scrollLines(A,B,D){this._bufferService.scrollLines(A,B,D)}scrollPages(A){this.scrollLines(A*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(A){const B=A-this._bufferService.buffer.ydisp;B!==0&&this.scrollLines(B)}registerEscHandler(A,B){return this._inputHandler.registerEscHandler(A,B)}registerDcsHandler(A,B){return this._inputHandler.registerDcsHandler(A,B)}registerCsiHandler(A,B){return this._inputHandler.registerCsiHandler(A,B)}registerOscHandler(A,B){return this._inputHandler.registerOscHandler(A,B)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let A=!1;const B=this.optionsService.rawOptions.windowsPty;B&&B.buildNumber!==void 0&&B.buildNumber!==void 0?A=B.backend==="conpty"&&B.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(A=!0),A?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const A=[];A.push(this.onLineFeed(m.updateWindowsModeWrappedState.bind(null,this._bufferService))),A.push(this.registerCsiHandler({final:"H"},()=>((0,m.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,u.toDisposable)(()=>{for(const B of A)B.dispose()})}}}s.CoreTerminal=C},8460:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.runAndSubscribe=s.forwardEvent=s.EventEmitter=void 0,s.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===a)return void this._listeners.splice(u,1)}}})),this._event}fire(a,u){const p=[];for(let c=0;c<this._listeners.length;c++)p.push(this._listeners[c]);for(let c=0;c<p.length;c++)p[c].call(void 0,a,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},s.forwardEvent=function(a,u){return a(p=>u.fire(p))},s.runAndSubscribe=function(a,u){return u(void 0),a(p=>u(p))}},5435:function(k,s,a){var u=this&&this.__decorate||function(K,R,P,M){var O,H=arguments.length,z=H<3?R:M===null?M=Object.getOwnPropertyDescriptor(R,P):M;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")z=Reflect.decorate(K,R,P,M);else for(var q=K.length-1;q>=0;q--)(O=K[q])&&(z=(H<3?O(z):H>3?O(R,P,z):O(R,P))||z);return H>3&&z&&Object.defineProperty(R,P,z),z},p=this&&this.__param||function(K,R){return function(P,M){R(P,M,K)}};Object.defineProperty(s,"__esModule",{value:!0}),s.InputHandler=s.WindowsOptionsReportType=void 0;const c=a(2584),h=a(7116),f=a(2015),S=a(844),_=a(482),n=a(8437),o=a(8460),r=a(643),l=a(511),m=a(3734),w=a(2585),b=a(1480),x=a(6242),g=a(6351),C=a(5941),T={"(":0,")":1,"*":2,"+":3,"-":1,".":2},A=131072;function B(K,R){if(K>24)return R.setWinLines||!1;switch(K){case 1:return!!R.restoreWin;case 2:return!!R.minimizeWin;case 3:return!!R.setWinPosition;case 4:return!!R.setWinSizePixels;case 5:return!!R.raiseWin;case 6:return!!R.lowerWin;case 7:return!!R.refreshWin;case 8:return!!R.setWinSizeChars;case 9:return!!R.maximizeWin;case 10:return!!R.fullscreenWin;case 11:return!!R.getWinState;case 13:return!!R.getWinPosition;case 14:return!!R.getWinSizePixels;case 15:return!!R.getScreenSizePixels;case 16:return!!R.getCellSizePixels;case 18:return!!R.getWinSizeChars;case 19:return!!R.getScreenSizeChars;case 20:return!!R.getIconTitle;case 21:return!!R.getWinTitle;case 22:return!!R.pushTitle;case 23:return!!R.popTitle;case 24:return!!R.setWinLines}return!1}var D;(function(K){K[K.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",K[K.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(D||(s.WindowsOptionsReportType=D={}));let j=0;class W extends S.Disposable{getAttrData(){return this._curAttrData}constructor(R,P,M,O,H,z,q,V,I=new f.EscapeSequenceParser){super(),this._bufferService=R,this._charsetService=P,this._coreService=M,this._logService=O,this._optionsService=H,this._oscLinkService=z,this._coreMouseService=q,this._unicodeService=V,this._parser=I,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new _.StringToUtf32,this._utf8Decoder=new _.Utf8ToUtf32,this._workCell=new l.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=n.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=n.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new o.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new o.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new o.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new o.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new o.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new o.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new o.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new o.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new o.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new o.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new o.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new o.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new U(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(L=>this._activeBuffer=L.activeBuffer)),this._parser.setCsiHandlerFallback((L,F)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(L),params:F.toArray()})}),this._parser.setEscHandlerFallback(L=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(L)})}),this._parser.setExecuteHandlerFallback(L=>{this._logService.debug("Unknown EXECUTE code: ",{code:L})}),this._parser.setOscHandlerFallback((L,F,$)=>{this._logService.debug("Unknown OSC code: ",{identifier:L,action:F,data:$})}),this._parser.setDcsHandlerFallback((L,F,$)=>{F==="HOOK"&&($=$.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(L),action:F,payload:$})}),this._parser.setPrintHandler((L,F,$)=>this.print(L,F,$)),this._parser.registerCsiHandler({final:"@"},L=>this.insertChars(L)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},L=>this.scrollLeft(L)),this._parser.registerCsiHandler({final:"A"},L=>this.cursorUp(L)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},L=>this.scrollRight(L)),this._parser.registerCsiHandler({final:"B"},L=>this.cursorDown(L)),this._parser.registerCsiHandler({final:"C"},L=>this.cursorForward(L)),this._parser.registerCsiHandler({final:"D"},L=>this.cursorBackward(L)),this._parser.registerCsiHandler({final:"E"},L=>this.cursorNextLine(L)),this._parser.registerCsiHandler({final:"F"},L=>this.cursorPrecedingLine(L)),this._parser.registerCsiHandler({final:"G"},L=>this.cursorCharAbsolute(L)),this._parser.registerCsiHandler({final:"H"},L=>this.cursorPosition(L)),this._parser.registerCsiHandler({final:"I"},L=>this.cursorForwardTab(L)),this._parser.registerCsiHandler({final:"J"},L=>this.eraseInDisplay(L,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},L=>this.eraseInDisplay(L,!0)),this._parser.registerCsiHandler({final:"K"},L=>this.eraseInLine(L,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},L=>this.eraseInLine(L,!0)),this._parser.registerCsiHandler({final:"L"},L=>this.insertLines(L)),this._parser.registerCsiHandler({final:"M"},L=>this.deleteLines(L)),this._parser.registerCsiHandler({final:"P"},L=>this.deleteChars(L)),this._parser.registerCsiHandler({final:"S"},L=>this.scrollUp(L)),this._parser.registerCsiHandler({final:"T"},L=>this.scrollDown(L)),this._parser.registerCsiHandler({final:"X"},L=>this.eraseChars(L)),this._parser.registerCsiHandler({final:"Z"},L=>this.cursorBackwardTab(L)),this._parser.registerCsiHandler({final:"`"},L=>this.charPosAbsolute(L)),this._parser.registerCsiHandler({final:"a"},L=>this.hPositionRelative(L)),this._parser.registerCsiHandler({final:"b"},L=>this.repeatPrecedingCharacter(L)),this._parser.registerCsiHandler({final:"c"},L=>this.sendDeviceAttributesPrimary(L)),this._parser.registerCsiHandler({prefix:">",final:"c"},L=>this.sendDeviceAttributesSecondary(L)),this._parser.registerCsiHandler({final:"d"},L=>this.linePosAbsolute(L)),this._parser.registerCsiHandler({final:"e"},L=>this.vPositionRelative(L)),this._parser.registerCsiHandler({final:"f"},L=>this.hVPosition(L)),this._parser.registerCsiHandler({final:"g"},L=>this.tabClear(L)),this._parser.registerCsiHandler({final:"h"},L=>this.setMode(L)),this._parser.registerCsiHandler({prefix:"?",final:"h"},L=>this.setModePrivate(L)),this._parser.registerCsiHandler({final:"l"},L=>this.resetMode(L)),this._parser.registerCsiHandler({prefix:"?",final:"l"},L=>this.resetModePrivate(L)),this._parser.registerCsiHandler({final:"m"},L=>this.charAttributes(L)),this._parser.registerCsiHandler({final:"n"},L=>this.deviceStatus(L)),this._parser.registerCsiHandler({prefix:"?",final:"n"},L=>this.deviceStatusPrivate(L)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},L=>this.softReset(L)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},L=>this.setCursorStyle(L)),this._parser.registerCsiHandler({final:"r"},L=>this.setScrollRegion(L)),this._parser.registerCsiHandler({final:"s"},L=>this.saveCursor(L)),this._parser.registerCsiHandler({final:"t"},L=>this.windowOptions(L)),this._parser.registerCsiHandler({final:"u"},L=>this.restoreCursor(L)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},L=>this.insertColumns(L)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},L=>this.deleteColumns(L)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},L=>this.selectProtected(L)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},L=>this.requestMode(L,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},L=>this.requestMode(L,!1)),this._parser.setExecuteHandler(c.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(c.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(c.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(c.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(c.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(c.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(c.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(c.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(c.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(c.C1.IND,()=>this.index()),this._parser.setExecuteHandler(c.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(c.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new x.OscHandler(L=>(this.setTitle(L),this.setIconName(L),!0))),this._parser.registerOscHandler(1,new x.OscHandler(L=>this.setIconName(L))),this._parser.registerOscHandler(2,new x.OscHandler(L=>this.setTitle(L))),this._parser.registerOscHandler(4,new x.OscHandler(L=>this.setOrReportIndexedColor(L))),this._parser.registerOscHandler(8,new x.OscHandler(L=>this.setHyperlink(L))),this._parser.registerOscHandler(10,new x.OscHandler(L=>this.setOrReportFgColor(L))),this._parser.registerOscHandler(11,new x.OscHandler(L=>this.setOrReportBgColor(L))),this._parser.registerOscHandler(12,new x.OscHandler(L=>this.setOrReportCursorColor(L))),this._parser.registerOscHandler(104,new x.OscHandler(L=>this.restoreIndexedColor(L))),this._parser.registerOscHandler(110,new x.OscHandler(L=>this.restoreFgColor(L))),this._parser.registerOscHandler(111,new x.OscHandler(L=>this.restoreBgColor(L))),this._parser.registerOscHandler(112,new x.OscHandler(L=>this.restoreCursorColor(L))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const L in h.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:L},()=>this.selectCharset("("+L)),this._parser.registerEscHandler({intermediates:")",final:L},()=>this.selectCharset(")"+L)),this._parser.registerEscHandler({intermediates:"*",final:L},()=>this.selectCharset("*"+L)),this._parser.registerEscHandler({intermediates:"+",final:L},()=>this.selectCharset("+"+L)),this._parser.registerEscHandler({intermediates:"-",final:L},()=>this.selectCharset("-"+L)),this._parser.registerEscHandler({intermediates:".",final:L},()=>this.selectCharset("."+L)),this._parser.registerEscHandler({intermediates:"/",final:L},()=>this.selectCharset("/"+L));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(L=>(this._logService.error("Parsing error: ",L),L)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new g.DcsHandler((L,F)=>this.requestStatusString(L,F)))}_preserveStack(R,P,M,O){this._parseStack.paused=!0,this._parseStack.cursorStartX=R,this._parseStack.cursorStartY=P,this._parseStack.decodedLength=M,this._parseStack.position=O}_logSlowResolvingAsync(R){this._logService.logLevel<=w.LogLevelEnum.WARN&&Promise.race([R,new Promise((P,M)=>setTimeout(()=>M("#SLOW_TIMEOUT"),5e3))]).catch(P=>{if(P!=="#SLOW_TIMEOUT")throw P;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(R,P){let M,O=this._activeBuffer.x,H=this._activeBuffer.y,z=0;const q=this._parseStack.paused;if(q){if(M=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,P))return this._logSlowResolvingAsync(M),M;O=this._parseStack.cursorStartX,H=this._parseStack.cursorStartY,this._parseStack.paused=!1,R.length>A&&(z=this._parseStack.position+A)}if(this._logService.logLevel<=w.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof R=="string"?` "${R}"`:` "${Array.prototype.map.call(R,L=>String.fromCharCode(L)).join("")}"`),typeof R=="string"?R.split("").map(L=>L.charCodeAt(0)):R),this._parseBuffer.length<R.length&&this._parseBuffer.length<A&&(this._parseBuffer=new Uint32Array(Math.min(R.length,A))),q||this._dirtyRowTracker.clearRange(),R.length>A)for(let L=z;L<R.length;L+=A){const F=L+A<R.length?L+A:R.length,$=typeof R=="string"?this._stringDecoder.decode(R.substring(L,F),this._parseBuffer):this._utf8Decoder.decode(R.subarray(L,F),this._parseBuffer);if(M=this._parser.parse(this._parseBuffer,$))return this._preserveStack(O,H,$,L),this._logSlowResolvingAsync(M),M}else if(!q){const L=typeof R=="string"?this._stringDecoder.decode(R,this._parseBuffer):this._utf8Decoder.decode(R,this._parseBuffer);if(M=this._parser.parse(this._parseBuffer,L))return this._preserveStack(O,H,L,0),this._logSlowResolvingAsync(M),M}this._activeBuffer.x===O&&this._activeBuffer.y===H||this._onCursorMove.fire();const V=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),I=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);I<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(I,this._bufferService.rows-1),Math.min(V,this._bufferService.rows-1))}print(R,P,M){let O,H;const z=this._charsetService.charset,q=this._optionsService.rawOptions.screenReaderMode,V=this._bufferService.cols,I=this._coreService.decPrivateModes.wraparound,L=this._coreService.modes.insertMode,F=this._curAttrData;let $=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&M-P>0&&$.getWidth(this._activeBuffer.x-1)===2&&$.setCellFromCodepoint(this._activeBuffer.x-1,0,1,F);let X=this._parser.precedingJoinState;for(let G=P;G<M;++G){if(O=R[G],O<127&&z){const he=z[String.fromCharCode(O)];he&&(O=he.charCodeAt(0))}const Y=this._unicodeService.charProperties(O,X);H=b.UnicodeService.extractWidth(Y);const se=b.UnicodeService.extractShouldJoin(Y),re=se?b.UnicodeService.extractWidth(X):0;if(X=Y,q&&this._onA11yChar.fire((0,_.stringFromCodePoint)(O)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+H-re>V){if(I){const he=$;let Z=this._activeBuffer.x-re;for(this._activeBuffer.x=re,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),$=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),re>0&&$ instanceof n.BufferLine&&$.copyCellsFrom(he,Z,0,re,!1);Z<V;)he.setCellFromCodepoint(Z++,0,1,F)}else if(this._activeBuffer.x=V-1,H===2)continue}if(se&&this._activeBuffer.x){const he=$.getWidth(this._activeBuffer.x-1)?1:2;$.addCodepointToCell(this._activeBuffer.x-he,O,H);for(let Z=H-re;--Z>=0;)$.setCellFromCodepoint(this._activeBuffer.x++,0,0,F)}else if(L&&($.insertCells(this._activeBuffer.x,H-re,this._activeBuffer.getNullCell(F)),$.getWidth(V-1)===2&&$.setCellFromCodepoint(V-1,r.NULL_CELL_CODE,r.NULL_CELL_WIDTH,F)),$.setCellFromCodepoint(this._activeBuffer.x++,O,H,F),H>0)for(;--H;)$.setCellFromCodepoint(this._activeBuffer.x++,0,0,F)}this._parser.precedingJoinState=X,this._activeBuffer.x<V&&M-P>0&&$.getWidth(this._activeBuffer.x)===0&&!$.hasContent(this._activeBuffer.x)&&$.setCellFromCodepoint(this._activeBuffer.x,0,1,F),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(R,P){return R.final!=="t"||R.prefix||R.intermediates?this._parser.registerCsiHandler(R,P):this._parser.registerCsiHandler(R,M=>!B(M.params[0],this._optionsService.rawOptions.windowOptions)||P(M))}registerDcsHandler(R,P){return this._parser.registerDcsHandler(R,new g.DcsHandler(P))}registerEscHandler(R,P){return this._parser.registerEscHandler(R,P)}registerOscHandler(R,P){return this._parser.registerOscHandler(R,new x.OscHandler(P))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);R.hasWidth(this._activeBuffer.x)&&!R.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const R=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-R),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(R=this._bufferService.cols-1){this._activeBuffer.x=Math.min(R,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(R,P){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=R,this._activeBuffer.y=this._activeBuffer.scrollTop+P):(this._activeBuffer.x=R,this._activeBuffer.y=P),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(R,P){this._restrictCursor(),this._setCursor(this._activeBuffer.x+R,this._activeBuffer.y+P)}cursorUp(R){const P=this._activeBuffer.y-this._activeBuffer.scrollTop;return P>=0?this._moveCursor(0,-Math.min(P,R.params[0]||1)):this._moveCursor(0,-(R.params[0]||1)),!0}cursorDown(R){const P=this._activeBuffer.scrollBottom-this._activeBuffer.y;return P>=0?this._moveCursor(0,Math.min(P,R.params[0]||1)):this._moveCursor(0,R.params[0]||1),!0}cursorForward(R){return this._moveCursor(R.params[0]||1,0),!0}cursorBackward(R){return this._moveCursor(-(R.params[0]||1),0),!0}cursorNextLine(R){return this.cursorDown(R),this._activeBuffer.x=0,!0}cursorPrecedingLine(R){return this.cursorUp(R),this._activeBuffer.x=0,!0}cursorCharAbsolute(R){return this._setCursor((R.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(R){return this._setCursor(R.length>=2?(R.params[1]||1)-1:0,(R.params[0]||1)-1),!0}charPosAbsolute(R){return this._setCursor((R.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(R){return this._moveCursor(R.params[0]||1,0),!0}linePosAbsolute(R){return this._setCursor(this._activeBuffer.x,(R.params[0]||1)-1),!0}vPositionRelative(R){return this._moveCursor(0,R.params[0]||1),!0}hVPosition(R){return this.cursorPosition(R),!0}tabClear(R){const P=R.params[0];return P===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:P===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(R){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let P=R.params[0]||1;for(;P--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(R){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let P=R.params[0]||1;for(;P--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(R){const P=R.params[0];return P===1&&(this._curAttrData.bg|=536870912),P!==2&&P!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(R,P,M,O=!1,H=!1){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);z.replaceCells(P,M,this._activeBuffer.getNullCell(this._eraseAttrData()),H),O&&(z.isWrapped=!1)}_resetBufferLine(R,P=!1){const M=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);M&&(M.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),P),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+R),M.isWrapped=!1)}eraseInDisplay(R,P=!1){let M;switch(this._restrictCursor(this._bufferService.cols),R.params[0]){case 0:for(M=this._activeBuffer.y,this._dirtyRowTracker.markDirty(M),this._eraseInBufferLine(M++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,P);M<this._bufferService.rows;M++)this._resetBufferLine(M,P);this._dirtyRowTracker.markDirty(M);break;case 1:for(M=this._activeBuffer.y,this._dirtyRowTracker.markDirty(M),this._eraseInBufferLine(M,0,this._activeBuffer.x+1,!0,P),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(M+1).isWrapped=!1);M--;)this._resetBufferLine(M,P);this._dirtyRowTracker.markDirty(0);break;case 2:for(M=this._bufferService.rows,this._dirtyRowTracker.markDirty(M-1);M--;)this._resetBufferLine(M,P);this._dirtyRowTracker.markDirty(0);break;case 3:const O=this._activeBuffer.lines.length-this._bufferService.rows;O>0&&(this._activeBuffer.lines.trimStart(O),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-O,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-O,0),this._onScroll.fire(0))}return!0}eraseInLine(R,P=!1){switch(this._restrictCursor(this._bufferService.cols),R.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,P);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,P);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,P)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(R){this._restrictCursor();let P=R.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const M=this._activeBuffer.ybase+this._activeBuffer.y,O=this._bufferService.rows-1-this._activeBuffer.scrollBottom,H=this._bufferService.rows-1+this._activeBuffer.ybase-O+1;for(;P--;)this._activeBuffer.lines.splice(H-1,1),this._activeBuffer.lines.splice(M,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(R){this._restrictCursor();let P=R.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const M=this._activeBuffer.ybase+this._activeBuffer.y;let O;for(O=this._bufferService.rows-1-this._activeBuffer.scrollBottom,O=this._bufferService.rows-1+this._activeBuffer.ybase-O;P--;)this._activeBuffer.lines.splice(M,1),this._activeBuffer.lines.splice(O,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(R){this._restrictCursor();const P=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return P&&(P.insertCells(this._activeBuffer.x,R.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(R){this._restrictCursor();const P=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return P&&(P.deleteCells(this._activeBuffer.x,R.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(R){let P=R.params[0]||1;for(;P--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(R){let P=R.params[0]||1;for(;P--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(n.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(R){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const P=R.params[0]||1;for(let M=this._activeBuffer.scrollTop;M<=this._activeBuffer.scrollBottom;++M){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+M);O.deleteCells(0,P,this._activeBuffer.getNullCell(this._eraseAttrData())),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(R){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const P=R.params[0]||1;for(let M=this._activeBuffer.scrollTop;M<=this._activeBuffer.scrollBottom;++M){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+M);O.insertCells(0,P,this._activeBuffer.getNullCell(this._eraseAttrData())),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(R){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const P=R.params[0]||1;for(let M=this._activeBuffer.scrollTop;M<=this._activeBuffer.scrollBottom;++M){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+M);O.insertCells(this._activeBuffer.x,P,this._activeBuffer.getNullCell(this._eraseAttrData())),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(R){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const P=R.params[0]||1;for(let M=this._activeBuffer.scrollTop;M<=this._activeBuffer.scrollBottom;++M){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+M);O.deleteCells(this._activeBuffer.x,P,this._activeBuffer.getNullCell(this._eraseAttrData())),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(R){this._restrictCursor();const P=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return P&&(P.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(R.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(R){const P=this._parser.precedingJoinState;if(!P)return!0;const M=R.params[0]||1,O=b.UnicodeService.extractWidth(P),H=this._activeBuffer.x-O,z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(H),q=new Uint32Array(z.length*M);let V=0;for(let L=0;L<z.length;){const F=z.codePointAt(L)||0;q[V++]=F,L+=F>65535?2:1}let I=V;for(let L=1;L<M;++L)q.copyWithin(I,0,V),I+=V;return this.print(q,0,I),!0}sendDeviceAttributesPrimary(R){return R.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(c.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(c.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(R){return R.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(c.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(c.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(R.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(c.C0.ESC+"[>83;40003;0c")),!0}_is(R){return(this._optionsService.rawOptions.termName+"").indexOf(R)===0}setMode(R){for(let P=0;P<R.length;P++)switch(R.params[P]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(R){for(let P=0;P<R.length;P++)switch(R.params[P]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,h.DEFAULT_CHARSET),this._charsetService.setgCharset(1,h.DEFAULT_CHARSET),this._charsetService.setgCharset(2,h.DEFAULT_CHARSET),this._charsetService.setgCharset(3,h.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(R){for(let P=0;P<R.length;P++)switch(R.params[P]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(R){for(let P=0;P<R.length;P++)switch(R.params[P]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),R.params[P]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(R,P){const M=this._coreService.decPrivateModes,{activeProtocol:O,activeEncoding:H}=this._coreMouseService,z=this._coreService,{buffers:q,cols:V}=this._bufferService,{active:I,alt:L}=q,F=this._optionsService.rawOptions,$=se=>se?1:2,X=R.params[0];return G=X,Y=P?X===2?4:X===4?$(z.modes.insertMode):X===12?3:X===20?$(F.convertEol):0:X===1?$(M.applicationCursorKeys):X===3?F.windowOptions.setWinLines?V===80?2:V===132?1:0:0:X===6?$(M.origin):X===7?$(M.wraparound):X===8?3:X===9?$(O==="X10"):X===12?$(F.cursorBlink):X===25?$(!z.isCursorHidden):X===45?$(M.reverseWraparound):X===66?$(M.applicationKeypad):X===67?4:X===1e3?$(O==="VT200"):X===1002?$(O==="DRAG"):X===1003?$(O==="ANY"):X===1004?$(M.sendFocus):X===1005?4:X===1006?$(H==="SGR"):X===1015?4:X===1016?$(H==="SGR_PIXELS"):X===1048?1:X===47||X===1047||X===1049?$(I===L):X===2004?$(M.bracketedPasteMode):0,z.triggerDataEvent(`${c.C0.ESC}[${P?"":"?"}${G};${Y}$y`),!0;var G,Y}_updateAttrColor(R,P,M,O,H){return P===2?(R|=50331648,R&=-16777216,R|=m.AttributeData.fromColorRGB([M,O,H])):P===5&&(R&=-50331904,R|=33554432|255&M),R}_extractColor(R,P,M){const O=[0,0,-1,0,0,0];let H=0,z=0;do{if(O[z+H]=R.params[P+z],R.hasSubParams(P+z)){const q=R.getSubParams(P+z);let V=0;do O[1]===5&&(H=1),O[z+V+1+H]=q[V];while(++V<q.length&&V+z+1+H<O.length);break}if(O[1]===5&&z+H>=2||O[1]===2&&z+H>=5)break;O[1]&&(H=1)}while(++z+P<R.length&&z+H<O.length);for(let q=2;q<O.length;++q)O[q]===-1&&(O[q]=0);switch(O[0]){case 38:M.fg=this._updateAttrColor(M.fg,O[1],O[3],O[4],O[5]);break;case 48:M.bg=this._updateAttrColor(M.bg,O[1],O[3],O[4],O[5]);break;case 58:M.extended=M.extended.clone(),M.extended.underlineColor=this._updateAttrColor(M.extended.underlineColor,O[1],O[3],O[4],O[5])}return z}_processUnderline(R,P){P.extended=P.extended.clone(),(!~R||R>5)&&(R=1),P.extended.underlineStyle=R,P.fg|=268435456,R===0&&(P.fg&=-268435457),P.updateExtended()}_processSGR0(R){R.fg=n.DEFAULT_ATTR_DATA.fg,R.bg=n.DEFAULT_ATTR_DATA.bg,R.extended=R.extended.clone(),R.extended.underlineStyle=0,R.extended.underlineColor&=-67108864,R.updateExtended()}charAttributes(R){if(R.length===1&&R.params[0]===0)return this._processSGR0(this._curAttrData),!0;const P=R.length;let M;const O=this._curAttrData;for(let H=0;H<P;H++)M=R.params[H],M>=30&&M<=37?(O.fg&=-50331904,O.fg|=16777216|M-30):M>=40&&M<=47?(O.bg&=-50331904,O.bg|=16777216|M-40):M>=90&&M<=97?(O.fg&=-50331904,O.fg|=16777224|M-90):M>=100&&M<=107?(O.bg&=-50331904,O.bg|=16777224|M-100):M===0?this._processSGR0(O):M===1?O.fg|=134217728:M===3?O.bg|=67108864:M===4?(O.fg|=268435456,this._processUnderline(R.hasSubParams(H)?R.getSubParams(H)[0]:1,O)):M===5?O.fg|=536870912:M===7?O.fg|=67108864:M===8?O.fg|=1073741824:M===9?O.fg|=2147483648:M===2?O.bg|=134217728:M===21?this._processUnderline(2,O):M===22?(O.fg&=-134217729,O.bg&=-134217729):M===23?O.bg&=-67108865:M===24?(O.fg&=-268435457,this._processUnderline(0,O)):M===25?O.fg&=-536870913:M===27?O.fg&=-67108865:M===28?O.fg&=-1073741825:M===29?O.fg&=2147483647:M===39?(O.fg&=-67108864,O.fg|=16777215&n.DEFAULT_ATTR_DATA.fg):M===49?(O.bg&=-67108864,O.bg|=16777215&n.DEFAULT_ATTR_DATA.bg):M===38||M===48||M===58?H+=this._extractColor(R,H,O):M===53?O.bg|=1073741824:M===55?O.bg&=-1073741825:M===59?(O.extended=O.extended.clone(),O.extended.underlineColor=-1,O.updateExtended()):M===100?(O.fg&=-67108864,O.fg|=16777215&n.DEFAULT_ATTR_DATA.fg,O.bg&=-67108864,O.bg|=16777215&n.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",M);return!0}deviceStatus(R){switch(R.params[0]){case 5:this._coreService.triggerDataEvent(`${c.C0.ESC}[0n`);break;case 6:const P=this._activeBuffer.y+1,M=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${c.C0.ESC}[${P};${M}R`)}return!0}deviceStatusPrivate(R){if(R.params[0]===6){const P=this._activeBuffer.y+1,M=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${c.C0.ESC}[?${P};${M}R`)}return!0}softReset(R){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=n.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(R){const P=R.params[0]||1;switch(P){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const M=P%2==1;return this._optionsService.options.cursorBlink=M,!0}setScrollRegion(R){const P=R.params[0]||1;let M;return(R.length<2||(M=R.params[1])>this._bufferService.rows||M===0)&&(M=this._bufferService.rows),M>P&&(this._activeBuffer.scrollTop=P-1,this._activeBuffer.scrollBottom=M-1,this._setCursor(0,0)),!0}windowOptions(R){if(!B(R.params[0],this._optionsService.rawOptions.windowOptions))return!0;const P=R.length>1?R.params[1]:0;switch(R.params[0]){case 14:P!==2&&this._onRequestWindowsOptionsReport.fire(D.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(D.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${c.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:P!==0&&P!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),P!==0&&P!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:P!==0&&P!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),P!==0&&P!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(R){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(R){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(R){return this._windowTitle=R,this._onTitleChange.fire(R),!0}setIconName(R){return this._iconName=R,!0}setOrReportIndexedColor(R){const P=[],M=R.split(";");for(;M.length>1;){const O=M.shift(),H=M.shift();if(/^\d+$/.exec(O)){const z=parseInt(O);if(J(z))if(H==="?")P.push({type:0,index:z});else{const q=(0,C.parseColor)(H);q&&P.push({type:1,index:z,color:q})}}}return P.length&&this._onColor.fire(P),!0}setHyperlink(R){const P=R.split(";");return!(P.length<2)&&(P[1]?this._createHyperlink(P[0],P[1]):!P[0]&&this._finishHyperlink())}_createHyperlink(R,P){this._getCurrentLinkId()&&this._finishHyperlink();const M=R.split(":");let O;const H=M.findIndex(z=>z.startsWith("id="));return H!==-1&&(O=M[H].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:O,uri:P}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(R,P){const M=R.split(";");for(let O=0;O<M.length&&!(P>=this._specialColors.length);++O,++P)if(M[O]==="?")this._onColor.fire([{type:0,index:this._specialColors[P]}]);else{const H=(0,C.parseColor)(M[O]);H&&this._onColor.fire([{type:1,index:this._specialColors[P],color:H}])}return!0}setOrReportFgColor(R){return this._setOrReportSpecialColor(R,0)}setOrReportBgColor(R){return this._setOrReportSpecialColor(R,1)}setOrReportCursorColor(R){return this._setOrReportSpecialColor(R,2)}restoreIndexedColor(R){if(!R)return this._onColor.fire([{type:2}]),!0;const P=[],M=R.split(";");for(let O=0;O<M.length;++O)if(/^\d+$/.exec(M[O])){const H=parseInt(M[O]);J(H)&&P.push({type:2,index:H})}return P.length&&this._onColor.fire(P),!0}restoreFgColor(R){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(R){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(R){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,h.DEFAULT_CHARSET),!0}selectCharset(R){return R.length!==2?(this.selectDefaultCharset(),!0):(R[0]==="/"||this._charsetService.setgCharset(T[R[0]],h.CHARSETS[R[1]]||h.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const R=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,R,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=n.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=n.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(R){return this._charsetService.setgLevel(R),!0}screenAlignmentPattern(){const R=new l.CellData;R.content=4194373,R.fg=this._curAttrData.fg,R.bg=this._curAttrData.bg,this._setCursor(0,0);for(let P=0;P<this._bufferService.rows;++P){const M=this._activeBuffer.ybase+this._activeBuffer.y+P,O=this._activeBuffer.lines.get(M);O&&(O.fill(R),O.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(R,P){const M=this._bufferService.buffer,O=this._optionsService.rawOptions;return(H=>(this._coreService.triggerDataEvent(`${c.C0.ESC}${H}${c.C0.ESC}\\`),!0))(R==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:R==='"p'?'P1$r61;1"p':R==="r"?`P1$r${M.scrollTop+1};${M.scrollBottom+1}r`:R==="m"?"P1$r0m":R===" q"?`P1$r${{block:2,underline:4,bar:6}[O.cursorStyle]-(O.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(R,P){this._dirtyRowTracker.markRangeDirty(R,P)}}s.InputHandler=W;let U=class{constructor(K){this._bufferService=K,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(K){K<this.start?this.start=K:K>this.end&&(this.end=K)}markRangeDirty(K,R){K>R&&(j=K,K=R,R=j),K<this.start&&(this.start=K),R>this.end&&(this.end=R)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function J(K){return 0<=K&&K<256}U=u([p(0,w.IBufferService)],U)},844:(k,s)=>{function a(u){for(const p of u)p.dispose();u.length=0}Object.defineProperty(s,"__esModule",{value:!0}),s.getDisposeArrayDisposable=s.disposeArray=s.toDisposable=s.MutableDisposable=s.Disposable=void 0,s.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const p=this._disposables.indexOf(u);p!==-1&&this._disposables.splice(p,1)}},s.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},s.toDisposable=function(u){return{dispose:u}},s.disposeArray=a,s.getDisposeArrayDisposable=function(u){return{dispose:()=>a(u)}}},1505:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.FourKeyMap=s.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(p,c,h){this._data[p]||(this._data[p]={}),this._data[p][c]=h}get(p,c){return this._data[p]?this._data[p][c]:void 0}clear(){this._data={}}}s.TwoKeyMap=a,s.FourKeyMap=class{constructor(){this._data=new a}set(u,p,c,h,f){this._data.get(u,p)||this._data.set(u,p,new a),this._data.get(u,p).set(c,h,f)}get(u,p,c,h){return this._data.get(u,p)?.get(c,h)}clear(){this._data.clear()}}},6114:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.isChromeOS=s.isLinux=s.isWindows=s.isIphone=s.isIpad=s.isMac=s.getSafariVersion=s.isSafari=s.isLegacyEdge=s.isFirefox=s.isNode=void 0,s.isNode=typeof process<"u"&&"title"in process;const a=s.isNode?"node":navigator.userAgent,u=s.isNode?"node":navigator.platform;s.isFirefox=a.includes("Firefox"),s.isLegacyEdge=a.includes("Edge"),s.isSafari=/^((?!chrome|android).)*safari/i.test(a),s.getSafariVersion=function(){if(!s.isSafari)return 0;const p=a.match(/Version\/(\d+)/);return p===null||p.length<2?0:parseInt(p[1])},s.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(u),s.isIpad=u==="iPad",s.isIphone=u==="iPhone",s.isWindows=["Windows","Win16","Win32","WinCE"].includes(u),s.isLinux=u.indexOf("Linux")>=0,s.isChromeOS=/\bCrOS\b/.test(a)},6106:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SortedList=void 0;let a=0;s.SortedList=class{constructor(u){this._getKey=u,this._array=[]}clear(){this._array.length=0}insert(u){this._array.length!==0?(a=this._search(this._getKey(u)),this._array.splice(a,0,u)):this._array.push(u)}delete(u){if(this._array.length===0)return!1;const p=this._getKey(u);if(p===void 0||(a=this._search(p),a===-1)||this._getKey(this._array[a])!==p)return!1;do if(this._array[a]===u)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===p);return!1}*getKeyIterator(u){if(this._array.length!==0&&(a=this._search(u),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===u))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===u)}forEachByKey(u,p){if(this._array.length!==0&&(a=this._search(u),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===u))do p(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===u)}values(){return[...this._array].values()}_search(u){let p=0,c=this._array.length-1;for(;c>=p;){let h=p+c>>1;const f=this._getKey(this._array[h]);if(f>u)c=h-1;else{if(!(f<u)){for(;h>0&&this._getKey(this._array[h-1])===u;)h--;return h}p=h+1}}return p}}},7226:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DebouncedIdleTask=s.IdleTaskQueue=s.PriorityTaskQueue=void 0;const u=a(6114);class p{constructor(){this._tasks=[],this._i=0}enqueue(f){this._tasks.push(f),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(f){this._idleCallback=void 0;let S=0,_=0,n=f.timeRemaining(),o=0;for(;this._i<this._tasks.length;){if(S=Date.now(),this._tasks[this._i]()||this._i++,S=Math.max(1,Date.now()-S),_=Math.max(S,_),o=f.timeRemaining(),1.5*_>o)return n-S<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(n-S))}ms`),void this._start();n=o}this.clear()}}class c extends p{_requestCallback(f){return setTimeout(()=>f(this._createDeadline(16)))}_cancelCallback(f){clearTimeout(f)}_createDeadline(f){const S=Date.now()+f;return{timeRemaining:()=>Math.max(0,S-Date.now())}}}s.PriorityTaskQueue=c,s.IdleTaskQueue=!u.isNode&&"requestIdleCallback"in window?class extends p{_requestCallback(h){return requestIdleCallback(h)}_cancelCallback(h){cancelIdleCallback(h)}}:c,s.DebouncedIdleTask=class{constructor(){this._queue=new s.IdleTaskQueue}set(h){this._queue.clear(),this._queue.enqueue(h)}flush(){this._queue.flush()}}},9282:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.updateWindowsModeWrappedState=void 0;const u=a(643);s.updateWindowsModeWrappedState=function(p){const c=p.buffer.lines.get(p.buffer.ybase+p.buffer.y-1),h=c?.get(p.cols-1),f=p.buffer.lines.get(p.buffer.ybase+p.buffer.y);f&&h&&(f.isWrapped=h[u.CHAR_DATA_CODE_INDEX]!==u.NULL_CELL_CODE&&h[u.CHAR_DATA_CODE_INDEX]!==u.WHITESPACE_CELL_CODE)}},3734:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ExtendedAttrs=s.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new u}static toColorRGB(c){return[c>>>16&255,c>>>8&255,255&c]}static fromColorRGB(c){return(255&c[0])<<16|(255&c[1])<<8|255&c[2]}clone(){const c=new a;return c.fg=this.fg,c.bg=this.bg,c.extended=this.extended.clone(),c}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}s.AttributeData=a;class u{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(c){this._ext=c}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(c){this._ext&=-469762049,this._ext|=c<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(c){this._ext&=-67108864,this._ext|=67108863&c}get urlId(){return this._urlId}set urlId(c){this._urlId=c}get underlineVariantOffset(){const c=(3758096384&this._ext)>>29;return c<0?4294967288^c:c}set underlineVariantOffset(c){this._ext&=536870911,this._ext|=c<<29&3758096384}constructor(c=0,h=0){this._ext=0,this._urlId=0,this._ext=c,this._urlId=h}clone(){return new u(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}s.ExtendedAttrs=u},9092:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Buffer=s.MAX_BUFFER_SIZE=void 0;const u=a(6349),p=a(7226),c=a(3734),h=a(8437),f=a(4634),S=a(511),_=a(643),n=a(4863),o=a(7116);s.MAX_BUFFER_SIZE=4294967295,s.Buffer=class{constructor(r,l,m){this._hasScrollback=r,this._optionsService=l,this._bufferService=m,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=h.DEFAULT_ATTR_DATA.clone(),this.savedCharset=o.DEFAULT_CHARSET,this.markers=[],this._nullCell=S.CellData.fromCharData([0,_.NULL_CELL_CHAR,_.NULL_CELL_WIDTH,_.NULL_CELL_CODE]),this._whitespaceCell=S.CellData.fromCharData([0,_.WHITESPACE_CELL_CHAR,_.WHITESPACE_CELL_WIDTH,_.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new p.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(r){return r?(this._nullCell.fg=r.fg,this._nullCell.bg=r.bg,this._nullCell.extended=r.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new c.ExtendedAttrs),this._nullCell}getWhitespaceCell(r){return r?(this._whitespaceCell.fg=r.fg,this._whitespaceCell.bg=r.bg,this._whitespaceCell.extended=r.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new c.ExtendedAttrs),this._whitespaceCell}getBlankLine(r,l){return new h.BufferLine(this._bufferService.cols,this.getNullCell(r),l)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const r=this.ybase+this.y-this.ydisp;return r>=0&&r<this._rows}_getCorrectBufferLength(r){if(!this._hasScrollback)return r;const l=r+this._optionsService.rawOptions.scrollback;return l>s.MAX_BUFFER_SIZE?s.MAX_BUFFER_SIZE:l}fillViewportRows(r){if(this.lines.length===0){r===void 0&&(r=h.DEFAULT_ATTR_DATA);let l=this._rows;for(;l--;)this.lines.push(this.getBlankLine(r))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(r,l){const m=this.getNullCell(h.DEFAULT_ATTR_DATA);let w=0;const b=this._getCorrectBufferLength(l);if(b>this.lines.maxLength&&(this.lines.maxLength=b),this.lines.length>0){if(this._cols<r)for(let g=0;g<this.lines.length;g++)w+=+this.lines.get(g).resize(r,m);let x=0;if(this._rows<l)for(let g=this._rows;g<l;g++)this.lines.length<l+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new h.BufferLine(r,m)):this.ybase>0&&this.lines.length<=this.ybase+this.y+x+1?(this.ybase--,x++,this.ydisp>0&&this.ydisp--):this.lines.push(new h.BufferLine(r,m)));else for(let g=this._rows;g>l;g--)this.lines.length>l+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(b<this.lines.maxLength){const g=this.lines.length-b;g>0&&(this.lines.trimStart(g),this.ybase=Math.max(this.ybase-g,0),this.ydisp=Math.max(this.ydisp-g,0),this.savedY=Math.max(this.savedY-g,0)),this.lines.maxLength=b}this.x=Math.min(this.x,r-1),this.y=Math.min(this.y,l-1),x&&(this.y+=x),this.savedX=Math.min(this.savedX,r-1),this.scrollTop=0}if(this.scrollBottom=l-1,this._isReflowEnabled&&(this._reflow(r,l),this._cols>r))for(let x=0;x<this.lines.length;x++)w+=+this.lines.get(x).resize(r,m);this._cols=r,this._rows=l,this._memoryCleanupQueue.clear(),w>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let r=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,r=!1);let l=0;for(;this._memoryCleanupPosition<this.lines.length;)if(l+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),l>100)return!0;return r}get _isReflowEnabled(){const r=this._optionsService.rawOptions.windowsPty;return r&&r.buildNumber?this._hasScrollback&&r.backend==="conpty"&&r.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(r,l){this._cols!==r&&(r>this._cols?this._reflowLarger(r,l):this._reflowSmaller(r,l))}_reflowLarger(r,l){const m=(0,f.reflowLargerGetLinesToRemove)(this.lines,this._cols,r,this.ybase+this.y,this.getNullCell(h.DEFAULT_ATTR_DATA));if(m.length>0){const w=(0,f.reflowLargerCreateNewLayout)(this.lines,m);(0,f.reflowLargerApplyNewLayout)(this.lines,w.layout),this._reflowLargerAdjustViewport(r,l,w.countRemoved)}}_reflowLargerAdjustViewport(r,l,m){const w=this.getNullCell(h.DEFAULT_ATTR_DATA);let b=m;for(;b-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<l&&this.lines.push(new h.BufferLine(r,w))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-m,0)}_reflowSmaller(r,l){const m=this.getNullCell(h.DEFAULT_ATTR_DATA),w=[];let b=0;for(let x=this.lines.length-1;x>=0;x--){let g=this.lines.get(x);if(!g||!g.isWrapped&&g.getTrimmedLength()<=r)continue;const C=[g];for(;g.isWrapped&&x>0;)g=this.lines.get(--x),C.unshift(g);const T=this.ybase+this.y;if(T>=x&&T<x+C.length)continue;const A=C[C.length-1].getTrimmedLength(),B=(0,f.reflowSmallerGetNewLineLengths)(C,this._cols,r),D=B.length-C.length;let j;j=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+D):Math.max(0,this.lines.length-this.lines.maxLength+D);const W=[];for(let M=0;M<D;M++){const O=this.getBlankLine(h.DEFAULT_ATTR_DATA,!0);W.push(O)}W.length>0&&(w.push({start:x+C.length+b,newLines:W}),b+=W.length),C.push(...W);let U=B.length-1,J=B[U];J===0&&(U--,J=B[U]);let K=C.length-D-1,R=A;for(;K>=0;){const M=Math.min(R,J);if(C[U]===void 0)break;if(C[U].copyCellsFrom(C[K],R-M,J-M,M,!0),J-=M,J===0&&(U--,J=B[U]),R-=M,R===0){K--;const O=Math.max(K,0);R=(0,f.getWrappedLineTrimmedLength)(C,O,this._cols)}}for(let M=0;M<C.length;M++)B[M]<r&&C[M].setCell(B[M],m);let P=D-j;for(;P-- >0;)this.ybase===0?this.y<l-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+b)-l&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+D,this.ybase+l-1)}if(w.length>0){const x=[],g=[];for(let U=0;U<this.lines.length;U++)g.push(this.lines.get(U));const C=this.lines.length;let T=C-1,A=0,B=w[A];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+b);let D=0;for(let U=Math.min(this.lines.maxLength-1,C+b-1);U>=0;U--)if(B&&B.start>T+D){for(let J=B.newLines.length-1;J>=0;J--)this.lines.set(U--,B.newLines[J]);U++,x.push({index:T+1,amount:B.newLines.length}),D+=B.newLines.length,B=w[++A]}else this.lines.set(U,g[T--]);let j=0;for(let U=x.length-1;U>=0;U--)x[U].index+=j,this.lines.onInsertEmitter.fire(x[U]),j+=x[U].amount;const W=Math.max(0,C+b-this.lines.maxLength);W>0&&this.lines.onTrimEmitter.fire(W)}}translateBufferLineToString(r,l,m=0,w){const b=this.lines.get(r);return b?b.translateToString(l,m,w):""}getWrappedRangeForLine(r){let l=r,m=r;for(;l>0&&this.lines.get(l).isWrapped;)l--;for(;m+1<this.lines.length&&this.lines.get(m+1).isWrapped;)m++;return{first:l,last:m}}setupTabStops(r){for(r!=null?this.tabs[r]||(r=this.prevStop(r)):(this.tabs={},r=0);r<this._cols;r+=this._optionsService.rawOptions.tabStopWidth)this.tabs[r]=!0}prevStop(r){for(r==null&&(r=this.x);!this.tabs[--r]&&r>0;);return r>=this._cols?this._cols-1:r<0?0:r}nextStop(r){for(r==null&&(r=this.x);!this.tabs[++r]&&r<this._cols;);return r>=this._cols?this._cols-1:r<0?0:r}clearMarkers(r){this._isClearing=!0;for(let l=0;l<this.markers.length;l++)this.markers[l].line===r&&(this.markers[l].dispose(),this.markers.splice(l--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let r=0;r<this.markers.length;r++)this.markers[r].dispose(),this.markers.splice(r--,1);this._isClearing=!1}addMarker(r){const l=new n.Marker(r);return this.markers.push(l),l.register(this.lines.onTrim(m=>{l.line-=m,l.line<0&&l.dispose()})),l.register(this.lines.onInsert(m=>{l.line>=m.index&&(l.line+=m.amount)})),l.register(this.lines.onDelete(m=>{l.line>=m.index&&l.line<m.index+m.amount&&l.dispose(),l.line>m.index&&(l.line-=m.amount)})),l.register(l.onDispose(()=>this._removeMarker(l))),l}_removeMarker(r){this._isClearing||this.markers.splice(this.markers.indexOf(r),1)}}},8437:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLine=s.DEFAULT_ATTR_DATA=void 0;const u=a(3734),p=a(511),c=a(643),h=a(482);s.DEFAULT_ATTR_DATA=Object.freeze(new u.AttributeData);let f=0;class S{constructor(n,o,r=!1){this.isWrapped=r,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*n);const l=o||p.CellData.fromCharData([0,c.NULL_CELL_CHAR,c.NULL_CELL_WIDTH,c.NULL_CELL_CODE]);for(let m=0;m<n;++m)this.setCell(m,l);this.length=n}get(n){const o=this._data[3*n+0],r=2097151&o;return[this._data[3*n+1],2097152&o?this._combined[n]:r?(0,h.stringFromCodePoint)(r):"",o>>22,2097152&o?this._combined[n].charCodeAt(this._combined[n].length-1):r]}set(n,o){this._data[3*n+1]=o[c.CHAR_DATA_ATTR_INDEX],o[c.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[n]=o[1],this._data[3*n+0]=2097152|n|o[c.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*n+0]=o[c.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|o[c.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(n){return this._data[3*n+0]>>22}hasWidth(n){return 12582912&this._data[3*n+0]}getFg(n){return this._data[3*n+1]}getBg(n){return this._data[3*n+2]}hasContent(n){return 4194303&this._data[3*n+0]}getCodePoint(n){const o=this._data[3*n+0];return 2097152&o?this._combined[n].charCodeAt(this._combined[n].length-1):2097151&o}isCombined(n){return 2097152&this._data[3*n+0]}getString(n){const o=this._data[3*n+0];return 2097152&o?this._combined[n]:2097151&o?(0,h.stringFromCodePoint)(2097151&o):""}isProtected(n){return 536870912&this._data[3*n+2]}loadCell(n,o){return f=3*n,o.content=this._data[f+0],o.fg=this._data[f+1],o.bg=this._data[f+2],2097152&o.content&&(o.combinedData=this._combined[n]),268435456&o.bg&&(o.extended=this._extendedAttrs[n]),o}setCell(n,o){2097152&o.content&&(this._combined[n]=o.combinedData),268435456&o.bg&&(this._extendedAttrs[n]=o.extended),this._data[3*n+0]=o.content,this._data[3*n+1]=o.fg,this._data[3*n+2]=o.bg}setCellFromCodepoint(n,o,r,l){268435456&l.bg&&(this._extendedAttrs[n]=l.extended),this._data[3*n+0]=o|r<<22,this._data[3*n+1]=l.fg,this._data[3*n+2]=l.bg}addCodepointToCell(n,o,r){let l=this._data[3*n+0];2097152&l?this._combined[n]+=(0,h.stringFromCodePoint)(o):2097151&l?(this._combined[n]=(0,h.stringFromCodePoint)(2097151&l)+(0,h.stringFromCodePoint)(o),l&=-2097152,l|=2097152):l=o|4194304,r&&(l&=-12582913,l|=r<<22),this._data[3*n+0]=l}insertCells(n,o,r){if((n%=this.length)&&this.getWidth(n-1)===2&&this.setCellFromCodepoint(n-1,0,1,r),o<this.length-n){const l=new p.CellData;for(let m=this.length-n-o-1;m>=0;--m)this.setCell(n+o+m,this.loadCell(n+m,l));for(let m=0;m<o;++m)this.setCell(n+m,r)}else for(let l=n;l<this.length;++l)this.setCell(l,r);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,r)}deleteCells(n,o,r){if(n%=this.length,o<this.length-n){const l=new p.CellData;for(let m=0;m<this.length-n-o;++m)this.setCell(n+m,this.loadCell(n+o+m,l));for(let m=this.length-o;m<this.length;++m)this.setCell(m,r)}else for(let l=n;l<this.length;++l)this.setCell(l,r);n&&this.getWidth(n-1)===2&&this.setCellFromCodepoint(n-1,0,1,r),this.getWidth(n)!==0||this.hasContent(n)||this.setCellFromCodepoint(n,0,1,r)}replaceCells(n,o,r,l=!1){if(l)for(n&&this.getWidth(n-1)===2&&!this.isProtected(n-1)&&this.setCellFromCodepoint(n-1,0,1,r),o<this.length&&this.getWidth(o-1)===2&&!this.isProtected(o)&&this.setCellFromCodepoint(o,0,1,r);n<o&&n<this.length;)this.isProtected(n)||this.setCell(n,r),n++;else for(n&&this.getWidth(n-1)===2&&this.setCellFromCodepoint(n-1,0,1,r),o<this.length&&this.getWidth(o-1)===2&&this.setCellFromCodepoint(o,0,1,r);n<o&&n<this.length;)this.setCell(n++,r)}resize(n,o){if(n===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const r=3*n;if(n>this.length){if(this._data.buffer.byteLength>=4*r)this._data=new Uint32Array(this._data.buffer,0,r);else{const l=new Uint32Array(r);l.set(this._data),this._data=l}for(let l=this.length;l<n;++l)this.setCell(l,o)}else{this._data=this._data.subarray(0,r);const l=Object.keys(this._combined);for(let w=0;w<l.length;w++){const b=parseInt(l[w],10);b>=n&&delete this._combined[b]}const m=Object.keys(this._extendedAttrs);for(let w=0;w<m.length;w++){const b=parseInt(m[w],10);b>=n&&delete this._extendedAttrs[b]}}return this.length=n,4*r*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const n=new Uint32Array(this._data.length);return n.set(this._data),this._data=n,1}return 0}fill(n,o=!1){if(o)for(let r=0;r<this.length;++r)this.isProtected(r)||this.setCell(r,n);else{this._combined={},this._extendedAttrs={};for(let r=0;r<this.length;++r)this.setCell(r,n)}}copyFrom(n){this.length!==n.length?this._data=new Uint32Array(n._data):this._data.set(n._data),this.length=n.length,this._combined={};for(const o in n._combined)this._combined[o]=n._combined[o];this._extendedAttrs={};for(const o in n._extendedAttrs)this._extendedAttrs[o]=n._extendedAttrs[o];this.isWrapped=n.isWrapped}clone(){const n=new S(0);n._data=new Uint32Array(this._data),n.length=this.length;for(const o in this._combined)n._combined[o]=this._combined[o];for(const o in this._extendedAttrs)n._extendedAttrs[o]=this._extendedAttrs[o];return n.isWrapped=this.isWrapped,n}getTrimmedLength(){for(let n=this.length-1;n>=0;--n)if(4194303&this._data[3*n+0])return n+(this._data[3*n+0]>>22);return 0}getNoBgTrimmedLength(){for(let n=this.length-1;n>=0;--n)if(4194303&this._data[3*n+0]||50331648&this._data[3*n+2])return n+(this._data[3*n+0]>>22);return 0}copyCellsFrom(n,o,r,l,m){const w=n._data;if(m)for(let x=l-1;x>=0;x--){for(let g=0;g<3;g++)this._data[3*(r+x)+g]=w[3*(o+x)+g];268435456&w[3*(o+x)+2]&&(this._extendedAttrs[r+x]=n._extendedAttrs[o+x])}else for(let x=0;x<l;x++){for(let g=0;g<3;g++)this._data[3*(r+x)+g]=w[3*(o+x)+g];268435456&w[3*(o+x)+2]&&(this._extendedAttrs[r+x]=n._extendedAttrs[o+x])}const b=Object.keys(n._combined);for(let x=0;x<b.length;x++){const g=parseInt(b[x],10);g>=o&&(this._combined[g-o+r]=n._combined[g])}}translateToString(n,o,r,l){o=o??0,r=r??this.length,n&&(r=Math.min(r,this.getTrimmedLength())),l&&(l.length=0);let m="";for(;o<r;){const w=this._data[3*o+0],b=2097151&w,x=2097152&w?this._combined[o]:b?(0,h.stringFromCodePoint)(b):c.WHITESPACE_CELL_CHAR;if(m+=x,l)for(let g=0;g<x.length;++g)l.push(o);o+=w>>22||1}return l&&l.push(o),m}}s.BufferLine=S},4841:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.getRangeLength=void 0,s.getRangeLength=function(a,u){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return u*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(k,s)=>{function a(u,p,c){if(p===u.length-1)return u[p].getTrimmedLength();const h=!u[p].hasContent(c-1)&&u[p].getWidth(c-1)===1,f=u[p+1].getWidth(0)===2;return h&&f?c-1:c}Object.defineProperty(s,"__esModule",{value:!0}),s.getWrappedLineTrimmedLength=s.reflowSmallerGetNewLineLengths=s.reflowLargerApplyNewLayout=s.reflowLargerCreateNewLayout=s.reflowLargerGetLinesToRemove=void 0,s.reflowLargerGetLinesToRemove=function(u,p,c,h,f){const S=[];for(let _=0;_<u.length-1;_++){let n=_,o=u.get(++n);if(!o.isWrapped)continue;const r=[u.get(_)];for(;n<u.length&&o.isWrapped;)r.push(o),o=u.get(++n);if(h>=_&&h<n){_+=r.length-1;continue}let l=0,m=a(r,l,p),w=1,b=0;for(;w<r.length;){const g=a(r,w,p),C=g-b,T=c-m,A=Math.min(C,T);r[l].copyCellsFrom(r[w],b,m,A,!1),m+=A,m===c&&(l++,m=0),b+=A,b===g&&(w++,b=0),m===0&&l!==0&&r[l-1].getWidth(c-1)===2&&(r[l].copyCellsFrom(r[l-1],c-1,m++,1,!1),r[l-1].setCell(c-1,f))}r[l].replaceCells(m,c,f);let x=0;for(let g=r.length-1;g>0&&(g>l||r[g].getTrimmedLength()===0);g--)x++;x>0&&(S.push(_+r.length-x),S.push(x)),_+=r.length-1}return S},s.reflowLargerCreateNewLayout=function(u,p){const c=[];let h=0,f=p[h],S=0;for(let _=0;_<u.length;_++)if(f===_){const n=p[++h];u.onDeleteEmitter.fire({index:_-S,amount:n}),_+=n-1,S+=n,f=p[++h]}else c.push(_);return{layout:c,countRemoved:S}},s.reflowLargerApplyNewLayout=function(u,p){const c=[];for(let h=0;h<p.length;h++)c.push(u.get(p[h]));for(let h=0;h<c.length;h++)u.set(h,c[h]);u.length=p.length},s.reflowSmallerGetNewLineLengths=function(u,p,c){const h=[],f=u.map((o,r)=>a(u,r,p)).reduce((o,r)=>o+r);let S=0,_=0,n=0;for(;n<f;){if(f-n<c){h.push(f-n);break}S+=c;const o=a(u,_,p);S>o&&(S-=o,_++);const r=u[_].getWidth(S-1)===2;r&&S--;const l=r?c-1:c;h.push(l),n+=l}return h},s.getWrappedLineTrimmedLength=a},5295:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferSet=void 0;const u=a(8460),p=a(844),c=a(9092);class h extends p.Disposable{constructor(S,_){super(),this._optionsService=S,this._bufferService=_,this._onBufferActivate=this.register(new u.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new c.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new c.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(S){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(S),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(S,_){this._normal.resize(S,_),this._alt.resize(S,_),this.setupTabStops(S)}setupTabStops(S){this._normal.setupTabStops(S),this._alt.setupTabStops(S)}}s.BufferSet=h},511:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CellData=void 0;const u=a(482),p=a(643),c=a(3734);class h extends c.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new c.ExtendedAttrs,this.combinedData=""}static fromCharData(S){const _=new h;return _.setFromCharData(S),_}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,u.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(S){this.fg=S[p.CHAR_DATA_ATTR_INDEX],this.bg=0;let _=!1;if(S[p.CHAR_DATA_CHAR_INDEX].length>2)_=!0;else if(S[p.CHAR_DATA_CHAR_INDEX].length===2){const n=S[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=n&&n<=56319){const o=S[p.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=o&&o<=57343?this.content=1024*(n-55296)+o-56320+65536|S[p.CHAR_DATA_WIDTH_INDEX]<<22:_=!0}else _=!0}else this.content=S[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|S[p.CHAR_DATA_WIDTH_INDEX]<<22;_&&(this.combinedData=S[p.CHAR_DATA_CHAR_INDEX],this.content=2097152|S[p.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}s.CellData=h},643:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WHITESPACE_CELL_CODE=s.WHITESPACE_CELL_WIDTH=s.WHITESPACE_CELL_CHAR=s.NULL_CELL_CODE=s.NULL_CELL_WIDTH=s.NULL_CELL_CHAR=s.CHAR_DATA_CODE_INDEX=s.CHAR_DATA_WIDTH_INDEX=s.CHAR_DATA_CHAR_INDEX=s.CHAR_DATA_ATTR_INDEX=s.DEFAULT_EXT=s.DEFAULT_ATTR=s.DEFAULT_COLOR=void 0,s.DEFAULT_COLOR=0,s.DEFAULT_ATTR=256|s.DEFAULT_COLOR<<9,s.DEFAULT_EXT=0,s.CHAR_DATA_ATTR_INDEX=0,s.CHAR_DATA_CHAR_INDEX=1,s.CHAR_DATA_WIDTH_INDEX=2,s.CHAR_DATA_CODE_INDEX=3,s.NULL_CELL_CHAR="",s.NULL_CELL_WIDTH=1,s.NULL_CELL_CODE=0,s.WHITESPACE_CELL_CHAR=" ",s.WHITESPACE_CELL_WIDTH=1,s.WHITESPACE_CELL_CODE=32},4863:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Marker=void 0;const u=a(8460),p=a(844);class c{get id(){return this._id}constructor(f){this.line=f,this.isDisposed=!1,this._disposables=[],this._id=c._nextId++,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,p.disposeArray)(this._disposables),this._disposables.length=0)}register(f){return this._disposables.push(f),f}}s.Marker=c,c._nextId=1},7116:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DEFAULT_CHARSET=s.CHARSETS=void 0,s.CHARSETS={},s.DEFAULT_CHARSET=s.CHARSETS.B,s.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},s.CHARSETS.A={"#":"£"},s.CHARSETS.B=void 0,s.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},s.CHARSETS.C=s.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},s.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},s.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},s.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},s.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},s.CHARSETS.E=s.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},s.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},s.CHARSETS.H=s.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},s.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(k,s)=>{var a,u,p;Object.defineProperty(s,"__esModule",{value:!0}),s.C1_ESCAPED=s.C1=s.C0=void 0,function(c){c.NUL="\0",c.SOH="",c.STX="",c.ETX="",c.EOT="",c.ENQ="",c.ACK="",c.BEL="\x07",c.BS="\b",c.HT="	",c.LF=`
`,c.VT="\v",c.FF="\f",c.CR="\r",c.SO="",c.SI="",c.DLE="",c.DC1="",c.DC2="",c.DC3="",c.DC4="",c.NAK="",c.SYN="",c.ETB="",c.CAN="",c.EM="",c.SUB="",c.ESC="\x1B",c.FS="",c.GS="",c.RS="",c.US="",c.SP=" ",c.DEL=""}(a||(s.C0=a={})),function(c){c.PAD="",c.HOP="",c.BPH="",c.NBH="",c.IND="",c.NEL="",c.SSA="",c.ESA="",c.HTS="",c.HTJ="",c.VTS="",c.PLD="",c.PLU="",c.RI="",c.SS2="",c.SS3="",c.DCS="",c.PU1="",c.PU2="",c.STS="",c.CCH="",c.MW="",c.SPA="",c.EPA="",c.SOS="",c.SGCI="",c.SCI="",c.CSI="",c.ST="",c.OSC="",c.PM="",c.APC=""}(u||(s.C1=u={})),function(c){c.ST=`${a.ESC}\\`}(p||(s.C1_ESCAPED=p={}))},7399:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.evaluateKeyboardEvent=void 0;const u=a(2584),p={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};s.evaluateKeyboardEvent=function(c,h,f,S){const _={type:0,cancel:!1,key:void 0},n=(c.shiftKey?1:0)|(c.altKey?2:0)|(c.ctrlKey?4:0)|(c.metaKey?8:0);switch(c.keyCode){case 0:c.key==="UIKeyInputUpArrow"?_.key=h?u.C0.ESC+"OA":u.C0.ESC+"[A":c.key==="UIKeyInputLeftArrow"?_.key=h?u.C0.ESC+"OD":u.C0.ESC+"[D":c.key==="UIKeyInputRightArrow"?_.key=h?u.C0.ESC+"OC":u.C0.ESC+"[C":c.key==="UIKeyInputDownArrow"&&(_.key=h?u.C0.ESC+"OB":u.C0.ESC+"[B");break;case 8:_.key=c.ctrlKey?"\b":u.C0.DEL,c.altKey&&(_.key=u.C0.ESC+_.key);break;case 9:if(c.shiftKey){_.key=u.C0.ESC+"[Z";break}_.key=u.C0.HT,_.cancel=!0;break;case 13:_.key=c.altKey?u.C0.ESC+u.C0.CR:u.C0.CR,_.cancel=!0;break;case 27:_.key=u.C0.ESC,c.altKey&&(_.key=u.C0.ESC+u.C0.ESC),_.cancel=!0;break;case 37:if(c.metaKey)break;n?(_.key=u.C0.ESC+"[1;"+(n+1)+"D",_.key===u.C0.ESC+"[1;3D"&&(_.key=u.C0.ESC+(f?"b":"[1;5D"))):_.key=h?u.C0.ESC+"OD":u.C0.ESC+"[D";break;case 39:if(c.metaKey)break;n?(_.key=u.C0.ESC+"[1;"+(n+1)+"C",_.key===u.C0.ESC+"[1;3C"&&(_.key=u.C0.ESC+(f?"f":"[1;5C"))):_.key=h?u.C0.ESC+"OC":u.C0.ESC+"[C";break;case 38:if(c.metaKey)break;n?(_.key=u.C0.ESC+"[1;"+(n+1)+"A",f||_.key!==u.C0.ESC+"[1;3A"||(_.key=u.C0.ESC+"[1;5A")):_.key=h?u.C0.ESC+"OA":u.C0.ESC+"[A";break;case 40:if(c.metaKey)break;n?(_.key=u.C0.ESC+"[1;"+(n+1)+"B",f||_.key!==u.C0.ESC+"[1;3B"||(_.key=u.C0.ESC+"[1;5B")):_.key=h?u.C0.ESC+"OB":u.C0.ESC+"[B";break;case 45:c.shiftKey||c.ctrlKey||(_.key=u.C0.ESC+"[2~");break;case 46:_.key=n?u.C0.ESC+"[3;"+(n+1)+"~":u.C0.ESC+"[3~";break;case 36:_.key=n?u.C0.ESC+"[1;"+(n+1)+"H":h?u.C0.ESC+"OH":u.C0.ESC+"[H";break;case 35:_.key=n?u.C0.ESC+"[1;"+(n+1)+"F":h?u.C0.ESC+"OF":u.C0.ESC+"[F";break;case 33:c.shiftKey?_.type=2:c.ctrlKey?_.key=u.C0.ESC+"[5;"+(n+1)+"~":_.key=u.C0.ESC+"[5~";break;case 34:c.shiftKey?_.type=3:c.ctrlKey?_.key=u.C0.ESC+"[6;"+(n+1)+"~":_.key=u.C0.ESC+"[6~";break;case 112:_.key=n?u.C0.ESC+"[1;"+(n+1)+"P":u.C0.ESC+"OP";break;case 113:_.key=n?u.C0.ESC+"[1;"+(n+1)+"Q":u.C0.ESC+"OQ";break;case 114:_.key=n?u.C0.ESC+"[1;"+(n+1)+"R":u.C0.ESC+"OR";break;case 115:_.key=n?u.C0.ESC+"[1;"+(n+1)+"S":u.C0.ESC+"OS";break;case 116:_.key=n?u.C0.ESC+"[15;"+(n+1)+"~":u.C0.ESC+"[15~";break;case 117:_.key=n?u.C0.ESC+"[17;"+(n+1)+"~":u.C0.ESC+"[17~";break;case 118:_.key=n?u.C0.ESC+"[18;"+(n+1)+"~":u.C0.ESC+"[18~";break;case 119:_.key=n?u.C0.ESC+"[19;"+(n+1)+"~":u.C0.ESC+"[19~";break;case 120:_.key=n?u.C0.ESC+"[20;"+(n+1)+"~":u.C0.ESC+"[20~";break;case 121:_.key=n?u.C0.ESC+"[21;"+(n+1)+"~":u.C0.ESC+"[21~";break;case 122:_.key=n?u.C0.ESC+"[23;"+(n+1)+"~":u.C0.ESC+"[23~";break;case 123:_.key=n?u.C0.ESC+"[24;"+(n+1)+"~":u.C0.ESC+"[24~";break;default:if(!c.ctrlKey||c.shiftKey||c.altKey||c.metaKey)if(f&&!S||!c.altKey||c.metaKey)!f||c.altKey||c.ctrlKey||c.shiftKey||!c.metaKey?c.key&&!c.ctrlKey&&!c.altKey&&!c.metaKey&&c.keyCode>=48&&c.key.length===1?_.key=c.key:c.key&&c.ctrlKey&&(c.key==="_"&&(_.key=u.C0.US),c.key==="@"&&(_.key=u.C0.NUL)):c.keyCode===65&&(_.type=1);else{const o=p[c.keyCode],r=o?.[c.shiftKey?1:0];if(r)_.key=u.C0.ESC+r;else if(c.keyCode>=65&&c.keyCode<=90){const l=c.ctrlKey?c.keyCode-64:c.keyCode+32;let m=String.fromCharCode(l);c.shiftKey&&(m=m.toUpperCase()),_.key=u.C0.ESC+m}else if(c.keyCode===32)_.key=u.C0.ESC+(c.ctrlKey?u.C0.NUL:" ");else if(c.key==="Dead"&&c.code.startsWith("Key")){let l=c.code.slice(3,4);c.shiftKey||(l=l.toLowerCase()),_.key=u.C0.ESC+l,_.cancel=!0}}else c.keyCode>=65&&c.keyCode<=90?_.key=String.fromCharCode(c.keyCode-64):c.keyCode===32?_.key=u.C0.NUL:c.keyCode>=51&&c.keyCode<=55?_.key=String.fromCharCode(c.keyCode-51+27):c.keyCode===56?_.key=u.C0.DEL:c.keyCode===219?_.key=u.C0.ESC:c.keyCode===220?_.key=u.C0.FS:c.keyCode===221&&(_.key=u.C0.GS)}return _}},482:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Utf8ToUtf32=s.StringToUtf32=s.utf32ToString=s.stringFromCodePoint=void 0,s.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},s.utf32ToString=function(a,u=0,p=a.length){let c="";for(let h=u;h<p;++h){let f=a[h];f>65535?(f-=65536,c+=String.fromCharCode(55296+(f>>10))+String.fromCharCode(f%1024+56320)):c+=String.fromCharCode(f)}return c},s.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,u){const p=a.length;if(!p)return 0;let c=0,h=0;if(this._interim){const f=a.charCodeAt(h++);56320<=f&&f<=57343?u[c++]=1024*(this._interim-55296)+f-56320+65536:(u[c++]=this._interim,u[c++]=f),this._interim=0}for(let f=h;f<p;++f){const S=a.charCodeAt(f);if(55296<=S&&S<=56319){if(++f>=p)return this._interim=S,c;const _=a.charCodeAt(f);56320<=_&&_<=57343?u[c++]=1024*(S-55296)+_-56320+65536:(u[c++]=S,u[c++]=_)}else S!==65279&&(u[c++]=S)}return c}},s.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,u){const p=a.length;if(!p)return 0;let c,h,f,S,_=0,n=0,o=0;if(this.interim[0]){let m=!1,w=this.interim[0];w&=(224&w)==192?31:(240&w)==224?15:7;let b,x=0;for(;(b=63&this.interim[++x])&&x<4;)w<<=6,w|=b;const g=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=g-x;for(;o<C;){if(o>=p)return 0;if(b=a[o++],(192&b)!=128){o--,m=!0;break}this.interim[x++]=b,w<<=6,w|=63&b}m||(g===2?w<128?o--:u[_++]=w:g===3?w<2048||w>=55296&&w<=57343||w===65279||(u[_++]=w):w<65536||w>1114111||(u[_++]=w)),this.interim.fill(0)}const r=p-4;let l=o;for(;l<p;){for(;!(!(l<r)||128&(c=a[l])||128&(h=a[l+1])||128&(f=a[l+2])||128&(S=a[l+3]));)u[_++]=c,u[_++]=h,u[_++]=f,u[_++]=S,l+=4;if(c=a[l++],c<128)u[_++]=c;else if((224&c)==192){if(l>=p)return this.interim[0]=c,_;if(h=a[l++],(192&h)!=128){l--;continue}if(n=(31&c)<<6|63&h,n<128){l--;continue}u[_++]=n}else if((240&c)==224){if(l>=p)return this.interim[0]=c,_;if(h=a[l++],(192&h)!=128){l--;continue}if(l>=p)return this.interim[0]=c,this.interim[1]=h,_;if(f=a[l++],(192&f)!=128){l--;continue}if(n=(15&c)<<12|(63&h)<<6|63&f,n<2048||n>=55296&&n<=57343||n===65279)continue;u[_++]=n}else if((248&c)==240){if(l>=p)return this.interim[0]=c,_;if(h=a[l++],(192&h)!=128){l--;continue}if(l>=p)return this.interim[0]=c,this.interim[1]=h,_;if(f=a[l++],(192&f)!=128){l--;continue}if(l>=p)return this.interim[0]=c,this.interim[1]=h,this.interim[2]=f,_;if(S=a[l++],(192&S)!=128){l--;continue}if(n=(7&c)<<18|(63&h)<<12|(63&f)<<6|63&S,n<65536||n>1114111)continue;u[_++]=n}}return _}}},225:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeV6=void 0;const u=a(1480),p=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],c=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let h;s.UnicodeV6=class{constructor(){if(this.version="6",!h){h=new Uint8Array(65536),h.fill(1),h[0]=0,h.fill(0,1,32),h.fill(0,127,160),h.fill(2,4352,4448),h[9001]=2,h[9002]=2,h.fill(2,11904,42192),h[12351]=1,h.fill(2,44032,55204),h.fill(2,63744,64256),h.fill(2,65040,65050),h.fill(2,65072,65136),h.fill(2,65280,65377),h.fill(2,65504,65511);for(let f=0;f<p.length;++f)h.fill(0,p[f][0],p[f][1]+1)}}wcwidth(f){return f<32?0:f<127?1:f<65536?h[f]:function(S,_){let n,o=0,r=_.length-1;if(S<_[0][0]||S>_[r][1])return!1;for(;r>=o;)if(n=o+r>>1,S>_[n][1])o=n+1;else{if(!(S<_[n][0]))return!0;r=n-1}return!1}(f,c)?0:f>=131072&&f<=196605||f>=196608&&f<=262141?2:1}charProperties(f,S){let _=this.wcwidth(f),n=_===0&&S!==0;if(n){const o=u.UnicodeService.extractWidth(S);o===0?n=!1:o>_&&(_=o)}return u.UnicodeService.createPropertyValue(0,_,n)}}},5981:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WriteBuffer=void 0;const u=a(8460),p=a(844);class c extends p.Disposable{constructor(f){super(),this._action=f,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new u.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(f,S){if(S!==void 0&&this._syncCalls>S)return void(this._syncCalls=0);if(this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let _;for(this._isSyncWriting=!0;_=this._writeBuffer.shift();){this._action(_);const n=this._callbacks.shift();n&&n()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(f,S){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(S),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(S)}_innerWrite(f=0,S=!0){const _=f||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const n=this._writeBuffer[this._bufferOffset],o=this._action(n,S);if(o){const l=m=>Date.now()-_>=12?setTimeout(()=>this._innerWrite(0,m)):this._innerWrite(_,m);return void o.catch(m=>(queueMicrotask(()=>{throw m}),Promise.resolve(!1))).then(l)}const r=this._callbacks[this._bufferOffset];if(r&&r(),this._bufferOffset++,this._pendingData-=n.length,Date.now()-_>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}s.WriteBuffer=c},5941:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.toRgbString=s.parseColor=void 0;const a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,u=/^[\da-f]+$/;function p(c,h){const f=c.toString(16),S=f.length<2?"0"+f:f;switch(h){case 4:return f[0];case 8:return S;case 12:return(S+S).slice(0,3);default:return S+S}}s.parseColor=function(c){if(!c)return;let h=c.toLowerCase();if(h.indexOf("rgb:")===0){h=h.slice(4);const f=a.exec(h);if(f){const S=f[1]?15:f[4]?255:f[7]?4095:65535;return[Math.round(parseInt(f[1]||f[4]||f[7]||f[10],16)/S*255),Math.round(parseInt(f[2]||f[5]||f[8]||f[11],16)/S*255),Math.round(parseInt(f[3]||f[6]||f[9]||f[12],16)/S*255)]}}else if(h.indexOf("#")===0&&(h=h.slice(1),u.exec(h)&&[3,6,9,12].includes(h.length))){const f=h.length/3,S=[0,0,0];for(let _=0;_<3;++_){const n=parseInt(h.slice(f*_,f*_+f),16);S[_]=f===1?n<<4:f===2?n:f===3?n>>4:n>>8}return S}},s.toRgbString=function(c,h=16){const[f,S,_]=c;return`rgb:${p(f,h)}/${p(S,h)}/${p(_,h)}`}},5770:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PAYLOAD_LIMIT=void 0,s.PAYLOAD_LIMIT=1e7},6351:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DcsHandler=s.DcsParser=void 0;const u=a(482),p=a(8742),c=a(5770),h=[];s.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=h,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=h}registerHandler(S,_){this._handlers[S]===void 0&&(this._handlers[S]=[]);const n=this._handlers[S];return n.push(_),{dispose:()=>{const o=n.indexOf(_);o!==-1&&n.splice(o,1)}}}clearHandler(S){this._handlers[S]&&delete this._handlers[S]}setHandlerFallback(S){this._handlerFb=S}reset(){if(this._active.length)for(let S=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;S>=0;--S)this._active[S].unhook(!1);this._stack.paused=!1,this._active=h,this._ident=0}hook(S,_){if(this.reset(),this._ident=S,this._active=this._handlers[S]||h,this._active.length)for(let n=this._active.length-1;n>=0;n--)this._active[n].hook(_);else this._handlerFb(this._ident,"HOOK",_)}put(S,_,n){if(this._active.length)for(let o=this._active.length-1;o>=0;o--)this._active[o].put(S,_,n);else this._handlerFb(this._ident,"PUT",(0,u.utf32ToString)(S,_,n))}unhook(S,_=!0){if(this._active.length){let n=!1,o=this._active.length-1,r=!1;if(this._stack.paused&&(o=this._stack.loopPosition-1,n=_,r=this._stack.fallThrough,this._stack.paused=!1),!r&&n===!1){for(;o>=0&&(n=this._active[o].unhook(S),n!==!0);o--)if(n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!1,n;o--}for(;o>=0;o--)if(n=this._active[o].unhook(!1),n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!0,n}else this._handlerFb(this._ident,"UNHOOK",S);this._active=h,this._ident=0}};const f=new p.Params;f.addParam(0),s.DcsHandler=class{constructor(S){this._handler=S,this._data="",this._params=f,this._hitLimit=!1}hook(S){this._params=S.length>1||S.params[0]?S.clone():f,this._data="",this._hitLimit=!1}put(S,_,n){this._hitLimit||(this._data+=(0,u.utf32ToString)(S,_,n),this._data.length>c.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(S){let _=!1;if(this._hitLimit)_=!1;else if(S&&(_=this._handler(this._data,this._params),_ instanceof Promise))return _.then(n=>(this._params=f,this._data="",this._hitLimit=!1,n));return this._params=f,this._data="",this._hitLimit=!1,_}}},2015:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.EscapeSequenceParser=s.VT500_TRANSITION_TABLE=s.TransitionTable=void 0;const u=a(844),p=a(8742),c=a(6242),h=a(6351);class f{constructor(o){this.table=new Uint8Array(o)}setDefault(o,r){this.table.fill(o<<4|r)}add(o,r,l,m){this.table[r<<8|o]=l<<4|m}addMany(o,r,l,m){for(let w=0;w<o.length;w++)this.table[r<<8|o[w]]=l<<4|m}}s.TransitionTable=f;const S=160;s.VT500_TRANSITION_TABLE=function(){const n=new f(4095),o=Array.apply(null,Array(256)).map((x,g)=>g),r=(x,g)=>o.slice(x,g),l=r(32,127),m=r(0,24);m.push(25),m.push.apply(m,r(28,32));const w=r(0,14);let b;for(b in n.setDefault(1,0),n.addMany(l,0,2,0),w)n.addMany([24,26,153,154],b,3,0),n.addMany(r(128,144),b,3,0),n.addMany(r(144,152),b,3,0),n.add(156,b,0,0),n.add(27,b,11,1),n.add(157,b,4,8),n.addMany([152,158,159],b,0,7),n.add(155,b,11,3),n.add(144,b,11,9);return n.addMany(m,0,3,0),n.addMany(m,1,3,1),n.add(127,1,0,1),n.addMany(m,8,0,8),n.addMany(m,3,3,3),n.add(127,3,0,3),n.addMany(m,4,3,4),n.add(127,4,0,4),n.addMany(m,6,3,6),n.addMany(m,5,3,5),n.add(127,5,0,5),n.addMany(m,2,3,2),n.add(127,2,0,2),n.add(93,1,4,8),n.addMany(l,8,5,8),n.add(127,8,5,8),n.addMany([156,27,24,26,7],8,6,0),n.addMany(r(28,32),8,0,8),n.addMany([88,94,95],1,0,7),n.addMany(l,7,0,7),n.addMany(m,7,0,7),n.add(156,7,0,0),n.add(127,7,0,7),n.add(91,1,11,3),n.addMany(r(64,127),3,7,0),n.addMany(r(48,60),3,8,4),n.addMany([60,61,62,63],3,9,4),n.addMany(r(48,60),4,8,4),n.addMany(r(64,127),4,7,0),n.addMany([60,61,62,63],4,0,6),n.addMany(r(32,64),6,0,6),n.add(127,6,0,6),n.addMany(r(64,127),6,0,0),n.addMany(r(32,48),3,9,5),n.addMany(r(32,48),5,9,5),n.addMany(r(48,64),5,0,6),n.addMany(r(64,127),5,7,0),n.addMany(r(32,48),4,9,5),n.addMany(r(32,48),1,9,2),n.addMany(r(32,48),2,9,2),n.addMany(r(48,127),2,10,0),n.addMany(r(48,80),1,10,0),n.addMany(r(81,88),1,10,0),n.addMany([89,90,92],1,10,0),n.addMany(r(96,127),1,10,0),n.add(80,1,11,9),n.addMany(m,9,0,9),n.add(127,9,0,9),n.addMany(r(28,32),9,0,9),n.addMany(r(32,48),9,9,12),n.addMany(r(48,60),9,8,10),n.addMany([60,61,62,63],9,9,10),n.addMany(m,11,0,11),n.addMany(r(32,128),11,0,11),n.addMany(r(28,32),11,0,11),n.addMany(m,10,0,10),n.add(127,10,0,10),n.addMany(r(28,32),10,0,10),n.addMany(r(48,60),10,8,10),n.addMany([60,61,62,63],10,0,11),n.addMany(r(32,48),10,9,12),n.addMany(m,12,0,12),n.add(127,12,0,12),n.addMany(r(28,32),12,0,12),n.addMany(r(32,48),12,9,12),n.addMany(r(48,64),12,0,11),n.addMany(r(64,127),12,12,13),n.addMany(r(64,127),10,12,13),n.addMany(r(64,127),9,12,13),n.addMany(m,13,13,13),n.addMany(l,13,13,13),n.add(127,13,0,13),n.addMany([27,156,24,26],13,14,0),n.add(S,0,2,0),n.add(S,8,5,8),n.add(S,6,0,6),n.add(S,11,0,11),n.add(S,13,13,13),n}();class _ extends u.Disposable{constructor(o=s.VT500_TRANSITION_TABLE){super(),this._transitions=o,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(r,l,m)=>{},this._executeHandlerFb=r=>{},this._csiHandlerFb=(r,l)=>{},this._escHandlerFb=r=>{},this._errorHandlerFb=r=>r,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,u.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new c.OscParser),this._dcsParser=this.register(new h.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(o,r=[64,126]){let l=0;if(o.prefix){if(o.prefix.length>1)throw new Error("only one byte as prefix supported");if(l=o.prefix.charCodeAt(0),l&&60>l||l>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(o.intermediates){if(o.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let w=0;w<o.intermediates.length;++w){const b=o.intermediates.charCodeAt(w);if(32>b||b>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");l<<=8,l|=b}}if(o.final.length!==1)throw new Error("final must be a single byte");const m=o.final.charCodeAt(0);if(r[0]>m||m>r[1])throw new Error(`final must be in range ${r[0]} .. ${r[1]}`);return l<<=8,l|=m,l}identToString(o){const r=[];for(;o;)r.push(String.fromCharCode(255&o)),o>>=8;return r.reverse().join("")}setPrintHandler(o){this._printHandler=o}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(o,r){const l=this._identifier(o,[48,126]);this._escHandlers[l]===void 0&&(this._escHandlers[l]=[]);const m=this._escHandlers[l];return m.push(r),{dispose:()=>{const w=m.indexOf(r);w!==-1&&m.splice(w,1)}}}clearEscHandler(o){this._escHandlers[this._identifier(o,[48,126])]&&delete this._escHandlers[this._identifier(o,[48,126])]}setEscHandlerFallback(o){this._escHandlerFb=o}setExecuteHandler(o,r){this._executeHandlers[o.charCodeAt(0)]=r}clearExecuteHandler(o){this._executeHandlers[o.charCodeAt(0)]&&delete this._executeHandlers[o.charCodeAt(0)]}setExecuteHandlerFallback(o){this._executeHandlerFb=o}registerCsiHandler(o,r){const l=this._identifier(o);this._csiHandlers[l]===void 0&&(this._csiHandlers[l]=[]);const m=this._csiHandlers[l];return m.push(r),{dispose:()=>{const w=m.indexOf(r);w!==-1&&m.splice(w,1)}}}clearCsiHandler(o){this._csiHandlers[this._identifier(o)]&&delete this._csiHandlers[this._identifier(o)]}setCsiHandlerFallback(o){this._csiHandlerFb=o}registerDcsHandler(o,r){return this._dcsParser.registerHandler(this._identifier(o),r)}clearDcsHandler(o){this._dcsParser.clearHandler(this._identifier(o))}setDcsHandlerFallback(o){this._dcsParser.setHandlerFallback(o)}registerOscHandler(o,r){return this._oscParser.registerHandler(o,r)}clearOscHandler(o){this._oscParser.clearHandler(o)}setOscHandlerFallback(o){this._oscParser.setHandlerFallback(o)}setErrorHandler(o){this._errorHandler=o}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(o,r,l,m,w){this._parseStack.state=o,this._parseStack.handlers=r,this._parseStack.handlerPos=l,this._parseStack.transition=m,this._parseStack.chunkPos=w}parse(o,r,l){let m,w=0,b=0,x=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,x=this._parseStack.chunkPos+1;else{if(l===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const g=this._parseStack.handlers;let C=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(l===!1&&C>-1){for(;C>=0&&(m=g[C](this._params),m!==!0);C--)if(m instanceof Promise)return this._parseStack.handlerPos=C,m}this._parseStack.handlers=[];break;case 4:if(l===!1&&C>-1){for(;C>=0&&(m=g[C](),m!==!0);C--)if(m instanceof Promise)return this._parseStack.handlerPos=C,m}this._parseStack.handlers=[];break;case 6:if(w=o[this._parseStack.chunkPos],m=this._dcsParser.unhook(w!==24&&w!==26,l),m)return m;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(w=o[this._parseStack.chunkPos],m=this._oscParser.end(w!==24&&w!==26,l),m)return m;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,x=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let g=x;g<r;++g){switch(w=o[g],b=this._transitions.table[this.currentState<<8|(w<160?w:S)],b>>4){case 2:for(let D=g+1;;++D){if(D>=r||(w=o[D])<32||w>126&&w<S){this._printHandler(o,g,D),g=D-1;break}if(++D>=r||(w=o[D])<32||w>126&&w<S){this._printHandler(o,g,D),g=D-1;break}if(++D>=r||(w=o[D])<32||w>126&&w<S){this._printHandler(o,g,D),g=D-1;break}if(++D>=r||(w=o[D])<32||w>126&&w<S){this._printHandler(o,g,D),g=D-1;break}}break;case 3:this._executeHandlers[w]?this._executeHandlers[w]():this._executeHandlerFb(w),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:g,code:w,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const C=this._csiHandlers[this._collect<<8|w];let T=C?C.length-1:-1;for(;T>=0&&(m=C[T](this._params),m!==!0);T--)if(m instanceof Promise)return this._preserveStack(3,C,T,b,g),m;T<0&&this._csiHandlerFb(this._collect<<8|w,this._params),this.precedingJoinState=0;break;case 8:do switch(w){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(w-48)}while(++g<r&&(w=o[g])>47&&w<60);g--;break;case 9:this._collect<<=8,this._collect|=w;break;case 10:const A=this._escHandlers[this._collect<<8|w];let B=A?A.length-1:-1;for(;B>=0&&(m=A[B](),m!==!0);B--)if(m instanceof Promise)return this._preserveStack(4,A,B,b,g),m;B<0&&this._escHandlerFb(this._collect<<8|w),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|w,this._params);break;case 13:for(let D=g+1;;++D)if(D>=r||(w=o[D])===24||w===26||w===27||w>127&&w<S){this._dcsParser.put(o,g,D),g=D-1;break}break;case 14:if(m=this._dcsParser.unhook(w!==24&&w!==26),m)return this._preserveStack(6,[],0,b,g),m;w===27&&(b|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let D=g+1;;D++)if(D>=r||(w=o[D])<32||w>127&&w<S){this._oscParser.put(o,g,D),g=D-1;break}break;case 6:if(m=this._oscParser.end(w!==24&&w!==26),m)return this._preserveStack(5,[],0,b,g),m;w===27&&(b|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&b}}}s.EscapeSequenceParser=_},6242:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OscHandler=s.OscParser=void 0;const u=a(5770),p=a(482),c=[];s.OscParser=class{constructor(){this._state=0,this._active=c,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(h,f){this._handlers[h]===void 0&&(this._handlers[h]=[]);const S=this._handlers[h];return S.push(f),{dispose:()=>{const _=S.indexOf(f);_!==-1&&S.splice(_,1)}}}clearHandler(h){this._handlers[h]&&delete this._handlers[h]}setHandlerFallback(h){this._handlerFb=h}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=c}reset(){if(this._state===2)for(let h=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;h>=0;--h)this._active[h].end(!1);this._stack.paused=!1,this._active=c,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||c,this._active.length)for(let h=this._active.length-1;h>=0;h--)this._active[h].start();else this._handlerFb(this._id,"START")}_put(h,f,S){if(this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].put(h,f,S);else this._handlerFb(this._id,"PUT",(0,p.utf32ToString)(h,f,S))}start(){this.reset(),this._state=1}put(h,f,S){if(this._state!==3){if(this._state===1)for(;f<S;){const _=h[f++];if(_===59){this._state=2,this._start();break}if(_<48||57<_)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+_-48}this._state===2&&S-f>0&&this._put(h,f,S)}}end(h,f=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let S=!1,_=this._active.length-1,n=!1;if(this._stack.paused&&(_=this._stack.loopPosition-1,S=f,n=this._stack.fallThrough,this._stack.paused=!1),!n&&S===!1){for(;_>=0&&(S=this._active[_].end(h),S!==!0);_--)if(S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!1,S;_--}for(;_>=0;_--)if(S=this._active[_].end(!1),S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!0,S}else this._handlerFb(this._id,"END",h);this._active=c,this._id=-1,this._state=0}}},s.OscHandler=class{constructor(h){this._handler=h,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(h,f,S){this._hitLimit||(this._data+=(0,p.utf32ToString)(h,f,S),this._data.length>u.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(h){let f=!1;if(this._hitLimit)f=!1;else if(h&&(f=this._handler(this._data),f instanceof Promise))return f.then(S=>(this._data="",this._hitLimit=!1,S));return this._data="",this._hitLimit=!1,f}}},8742:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Params=void 0;const a=2147483647;class u{static fromArray(c){const h=new u;if(!c.length)return h;for(let f=Array.isArray(c[0])?1:0;f<c.length;++f){const S=c[f];if(Array.isArray(S))for(let _=0;_<S.length;++_)h.addSubParam(S[_]);else h.addParam(S)}return h}constructor(c=32,h=32){if(this.maxLength=c,this.maxSubParamsLength=h,h>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(c),this.length=0,this._subParams=new Int32Array(h),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(c),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const c=new u(this.maxLength,this.maxSubParamsLength);return c.params.set(this.params),c.length=this.length,c._subParams.set(this._subParams),c._subParamsLength=this._subParamsLength,c._subParamsIdx.set(this._subParamsIdx),c._rejectDigits=this._rejectDigits,c._rejectSubDigits=this._rejectSubDigits,c._digitIsSub=this._digitIsSub,c}toArray(){const c=[];for(let h=0;h<this.length;++h){c.push(this.params[h]);const f=this._subParamsIdx[h]>>8,S=255&this._subParamsIdx[h];S-f>0&&c.push(Array.prototype.slice.call(this._subParams,f,S))}return c}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(c){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(c<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=c>a?a:c}}addSubParam(c){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(c<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=c>a?a:c,this._subParamsIdx[this.length-1]++}}hasSubParams(c){return(255&this._subParamsIdx[c])-(this._subParamsIdx[c]>>8)>0}getSubParams(c){const h=this._subParamsIdx[c]>>8,f=255&this._subParamsIdx[c];return f-h>0?this._subParams.subarray(h,f):null}getSubParamsAll(){const c={};for(let h=0;h<this.length;++h){const f=this._subParamsIdx[h]>>8,S=255&this._subParamsIdx[h];S-f>0&&(c[h]=this._subParams.slice(f,S))}return c}addDigit(c){let h;if(this._rejectDigits||!(h=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const f=this._digitIsSub?this._subParams:this.params,S=f[h-1];f[h-1]=~S?Math.min(10*S+c,a):c}}s.Params=u},5741:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AddonManager=void 0,s.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,u){const p={instance:u,dispose:u.dispose,isDisposed:!1};this._addons.push(p),u.dispose=()=>this._wrappedAddonDispose(p),u.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let u=-1;for(let p=0;p<this._addons.length;p++)if(this._addons[p]===a){u=p;break}if(u===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(u,1)}}},8771:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferApiView=void 0;const u=a(3785),p=a(511);s.BufferApiView=class{constructor(c,h){this._buffer=c,this.type=h}init(c){return this._buffer=c,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(c){const h=this._buffer.lines.get(c);if(h)return new u.BufferLineApiView(h)}getNullCell(){return new p.CellData}}},3785:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLineApiView=void 0;const u=a(511);s.BufferLineApiView=class{constructor(p){this._line=p}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(p,c){if(!(p<0||p>=this._line.length))return c?(this._line.loadCell(p,c),c):this._line.loadCell(p,new u.CellData)}translateToString(p,c,h){return this._line.translateToString(p,c,h)}}},8285:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferNamespaceApi=void 0;const u=a(8771),p=a(8460),c=a(844);class h extends c.Disposable{constructor(S){super(),this._core=S,this._onBufferChange=this.register(new p.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new u.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new u.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}s.BufferNamespaceApi=h},7975:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ParserApi=void 0,s.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,u){return this._core.registerCsiHandler(a,p=>u(p.toArray()))}addCsiHandler(a,u){return this.registerCsiHandler(a,u)}registerDcsHandler(a,u){return this._core.registerDcsHandler(a,(p,c)=>u(p,c.toArray()))}addDcsHandler(a,u){return this.registerDcsHandler(a,u)}registerEscHandler(a,u){return this._core.registerEscHandler(a,u)}addEscHandler(a,u){return this.registerEscHandler(a,u)}registerOscHandler(a,u){return this._core.registerOscHandler(a,u)}addOscHandler(a,u){return this.registerOscHandler(a,u)}}},7090:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeApi=void 0,s.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(k,s,a){var u=this&&this.__decorate||function(n,o,r,l){var m,w=arguments.length,b=w<3?o:l===null?l=Object.getOwnPropertyDescriptor(o,r):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(n,o,r,l);else for(var x=n.length-1;x>=0;x--)(m=n[x])&&(b=(w<3?m(b):w>3?m(o,r,b):m(o,r))||b);return w>3&&b&&Object.defineProperty(o,r,b),b},p=this&&this.__param||function(n,o){return function(r,l){o(r,l,n)}};Object.defineProperty(s,"__esModule",{value:!0}),s.BufferService=s.MINIMUM_ROWS=s.MINIMUM_COLS=void 0;const c=a(8460),h=a(844),f=a(5295),S=a(2585);s.MINIMUM_COLS=2,s.MINIMUM_ROWS=1;let _=s.BufferService=class extends h.Disposable{get buffer(){return this.buffers.active}constructor(n){super(),this.isUserScrolling=!1,this._onResize=this.register(new c.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new c.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(n.rawOptions.cols||0,s.MINIMUM_COLS),this.rows=Math.max(n.rawOptions.rows||0,s.MINIMUM_ROWS),this.buffers=this.register(new f.BufferSet(n,this))}resize(n,o){this.cols=n,this.rows=o,this.buffers.resize(n,o),this._onResize.fire({cols:n,rows:o})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(n,o=!1){const r=this.buffer;let l;l=this._cachedBlankLine,l&&l.length===this.cols&&l.getFg(0)===n.fg&&l.getBg(0)===n.bg||(l=r.getBlankLine(n,o),this._cachedBlankLine=l),l.isWrapped=o;const m=r.ybase+r.scrollTop,w=r.ybase+r.scrollBottom;if(r.scrollTop===0){const b=r.lines.isFull;w===r.lines.length-1?b?r.lines.recycle().copyFrom(l):r.lines.push(l.clone()):r.lines.splice(w+1,0,l.clone()),b?this.isUserScrolling&&(r.ydisp=Math.max(r.ydisp-1,0)):(r.ybase++,this.isUserScrolling||r.ydisp++)}else{const b=w-m+1;r.lines.shiftElements(m+1,b-1,-1),r.lines.set(w,l.clone())}this.isUserScrolling||(r.ydisp=r.ybase),this._onScroll.fire(r.ydisp)}scrollLines(n,o,r){const l=this.buffer;if(n<0){if(l.ydisp===0)return;this.isUserScrolling=!0}else n+l.ydisp>=l.ybase&&(this.isUserScrolling=!1);const m=l.ydisp;l.ydisp=Math.max(Math.min(l.ydisp+n,l.ybase),0),m!==l.ydisp&&(o||this._onScroll.fire(l.ydisp))}};s.BufferService=_=u([p(0,S.IOptionsService)],_)},7994:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CharsetService=void 0,s.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,u){this._charsets[a]=u,this.glevel===a&&(this.charset=u)}}},1753:function(k,s,a){var u=this&&this.__decorate||function(l,m,w,b){var x,g=arguments.length,C=g<3?m:b===null?b=Object.getOwnPropertyDescriptor(m,w):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(l,m,w,b);else for(var T=l.length-1;T>=0;T--)(x=l[T])&&(C=(g<3?x(C):g>3?x(m,w,C):x(m,w))||C);return g>3&&C&&Object.defineProperty(m,w,C),C},p=this&&this.__param||function(l,m){return function(w,b){m(w,b,l)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreMouseService=void 0;const c=a(2585),h=a(8460),f=a(844),S={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:l=>l.button!==4&&l.action===1&&(l.ctrl=!1,l.alt=!1,l.shift=!1,!0)},VT200:{events:19,restrict:l=>l.action!==32},DRAG:{events:23,restrict:l=>l.action!==32||l.button!==3},ANY:{events:31,restrict:l=>!0}};function _(l,m){let w=(l.ctrl?16:0)|(l.shift?4:0)|(l.alt?8:0);return l.button===4?(w|=64,w|=l.action):(w|=3&l.button,4&l.button&&(w|=64),8&l.button&&(w|=128),l.action===32?w|=32:l.action!==0||m||(w|=3)),w}const n=String.fromCharCode,o={DEFAULT:l=>{const m=[_(l,!1)+32,l.col+32,l.row+32];return m[0]>255||m[1]>255||m[2]>255?"":`\x1B[M${n(m[0])}${n(m[1])}${n(m[2])}`},SGR:l=>{const m=l.action===0&&l.button!==4?"m":"M";return`\x1B[<${_(l,!0)};${l.col};${l.row}${m}`},SGR_PIXELS:l=>{const m=l.action===0&&l.button!==4?"m":"M";return`\x1B[<${_(l,!0)};${l.x};${l.y}${m}`}};let r=s.CoreMouseService=class extends f.Disposable{constructor(l,m){super(),this._bufferService=l,this._coreService=m,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new h.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const w of Object.keys(S))this.addProtocol(w,S[w]);for(const w of Object.keys(o))this.addEncoding(w,o[w]);this.reset()}addProtocol(l,m){this._protocols[l]=m}addEncoding(l,m){this._encodings[l]=m}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(l){if(!this._protocols[l])throw new Error(`unknown protocol "${l}"`);this._activeProtocol=l,this._onProtocolChange.fire(this._protocols[l].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(l){if(!this._encodings[l])throw new Error(`unknown encoding "${l}"`);this._activeEncoding=l}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(l){if(l.col<0||l.col>=this._bufferService.cols||l.row<0||l.row>=this._bufferService.rows||l.button===4&&l.action===32||l.button===3&&l.action!==32||l.button!==4&&(l.action===2||l.action===3)||(l.col++,l.row++,l.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,l,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(l))return!1;const m=this._encodings[this._activeEncoding](l);return m&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(m):this._coreService.triggerDataEvent(m,!0)),this._lastEvent=l,!0}explainEvents(l){return{down:!!(1&l),up:!!(2&l),drag:!!(4&l),move:!!(8&l),wheel:!!(16&l)}}_equalEvents(l,m,w){if(w){if(l.x!==m.x||l.y!==m.y)return!1}else if(l.col!==m.col||l.row!==m.row)return!1;return l.button===m.button&&l.action===m.action&&l.ctrl===m.ctrl&&l.alt===m.alt&&l.shift===m.shift}};s.CoreMouseService=r=u([p(0,c.IBufferService),p(1,c.ICoreService)],r)},6975:function(k,s,a){var u=this&&this.__decorate||function(r,l,m,w){var b,x=arguments.length,g=x<3?l:w===null?w=Object.getOwnPropertyDescriptor(l,m):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(r,l,m,w);else for(var C=r.length-1;C>=0;C--)(b=r[C])&&(g=(x<3?b(g):x>3?b(l,m,g):b(l,m))||g);return x>3&&g&&Object.defineProperty(l,m,g),g},p=this&&this.__param||function(r,l){return function(m,w){l(m,w,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreService=void 0;const c=a(1439),h=a(8460),f=a(844),S=a(2585),_=Object.freeze({insertMode:!1}),n=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let o=s.CoreService=class extends f.Disposable{constructor(r,l,m){super(),this._bufferService=r,this._logService=l,this._optionsService=m,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new h.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new h.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new h.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new h.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,c.clone)(_),this.decPrivateModes=(0,c.clone)(n)}reset(){this.modes=(0,c.clone)(_),this.decPrivateModes=(0,c.clone)(n)}triggerDataEvent(r,l=!1){if(this._optionsService.rawOptions.disableStdin)return;const m=this._bufferService.buffer;l&&this._optionsService.rawOptions.scrollOnUserInput&&m.ybase!==m.ydisp&&this._onRequestScrollToBottom.fire(),l&&this._onUserInput.fire(),this._logService.debug(`sending data "${r}"`,()=>r.split("").map(w=>w.charCodeAt(0))),this._onData.fire(r)}triggerBinaryEvent(r){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${r}"`,()=>r.split("").map(l=>l.charCodeAt(0))),this._onBinary.fire(r))}};s.CoreService=o=u([p(0,S.IBufferService),p(1,S.ILogService),p(2,S.IOptionsService)],o)},9074:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DecorationService=void 0;const u=a(8055),p=a(8460),c=a(844),h=a(6106);let f=0,S=0;class _ extends c.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new h.SortedList(r=>r?.marker.line),this._onDecorationRegistered=this.register(new p.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new p.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,c.toDisposable)(()=>this.reset()))}registerDecoration(r){if(r.marker.isDisposed)return;const l=new n(r);if(l){const m=l.marker.onDispose(()=>l.dispose());l.onDispose(()=>{l&&(this._decorations.delete(l)&&this._onDecorationRemoved.fire(l),m.dispose())}),this._decorations.insert(l),this._onDecorationRegistered.fire(l)}return l}reset(){for(const r of this._decorations.values())r.dispose();this._decorations.clear()}*getDecorationsAtCell(r,l,m){let w=0,b=0;for(const x of this._decorations.getKeyIterator(l))w=x.options.x??0,b=w+(x.options.width??1),r>=w&&r<b&&(!m||(x.options.layer??"bottom")===m)&&(yield x)}forEachDecorationAtCell(r,l,m,w){this._decorations.forEachByKey(l,b=>{f=b.options.x??0,S=f+(b.options.width??1),r>=f&&r<S&&(!m||(b.options.layer??"bottom")===m)&&w(b)})}}s.DecorationService=_;class n extends c.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=u.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=u.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(r){super(),this.options=r,this.onRenderEmitter=this.register(new p.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new p.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=r.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.InstantiationService=s.ServiceCollection=void 0;const u=a(2585),p=a(8343);class c{constructor(...f){this._entries=new Map;for(const[S,_]of f)this.set(S,_)}set(f,S){const _=this._entries.get(f);return this._entries.set(f,S),_}forEach(f){for(const[S,_]of this._entries.entries())f(S,_)}has(f){return this._entries.has(f)}get(f){return this._entries.get(f)}}s.ServiceCollection=c,s.InstantiationService=class{constructor(){this._services=new c,this._services.set(u.IInstantiationService,this)}setService(h,f){this._services.set(h,f)}getService(h){return this._services.get(h)}createInstance(h,...f){const S=(0,p.getServiceDependencies)(h).sort((o,r)=>o.index-r.index),_=[];for(const o of S){const r=this._services.get(o.id);if(!r)throw new Error(`[createInstance] ${h.name} depends on UNKNOWN service ${o.id}.`);_.push(r)}const n=S.length>0?S[0].index:f.length;if(f.length!==n)throw new Error(`[createInstance] First service dependency of ${h.name} at position ${n+1} conflicts with ${f.length} static arguments`);return new h(...f,..._)}}},7866:function(k,s,a){var u=this&&this.__decorate||function(n,o,r,l){var m,w=arguments.length,b=w<3?o:l===null?l=Object.getOwnPropertyDescriptor(o,r):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(n,o,r,l);else for(var x=n.length-1;x>=0;x--)(m=n[x])&&(b=(w<3?m(b):w>3?m(o,r,b):m(o,r))||b);return w>3&&b&&Object.defineProperty(o,r,b),b},p=this&&this.__param||function(n,o){return function(r,l){o(r,l,n)}};Object.defineProperty(s,"__esModule",{value:!0}),s.traceCall=s.setTraceLogger=s.LogService=void 0;const c=a(844),h=a(2585),f={trace:h.LogLevelEnum.TRACE,debug:h.LogLevelEnum.DEBUG,info:h.LogLevelEnum.INFO,warn:h.LogLevelEnum.WARN,error:h.LogLevelEnum.ERROR,off:h.LogLevelEnum.OFF};let S,_=s.LogService=class extends c.Disposable{get logLevel(){return this._logLevel}constructor(n){super(),this._optionsService=n,this._logLevel=h.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),S=this}_updateLogLevel(){this._logLevel=f[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(n){for(let o=0;o<n.length;o++)typeof n[o]=="function"&&(n[o]=n[o]())}_log(n,o,r){this._evalLazyOptionalParams(r),n.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+o,...r)}trace(n,...o){this._logLevel<=h.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,n,o)}debug(n,...o){this._logLevel<=h.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,n,o)}info(n,...o){this._logLevel<=h.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,n,o)}warn(n,...o){this._logLevel<=h.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,n,o)}error(n,...o){this._logLevel<=h.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,n,o)}};s.LogService=_=u([p(0,h.IOptionsService)],_),s.setTraceLogger=function(n){S=n},s.traceCall=function(n,o,r){if(typeof r.value!="function")throw new Error("not supported");const l=r.value;r.value=function(...m){if(S.logLevel!==h.LogLevelEnum.TRACE)return l.apply(this,m);S.trace(`GlyphRenderer#${l.name}(${m.map(b=>JSON.stringify(b)).join(", ")})`);const w=l.apply(this,m);return S.trace(`GlyphRenderer#${l.name} return`,w),w}}},7302:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OptionsService=s.DEFAULT_OPTIONS=void 0;const u=a(8460),p=a(844),c=a(6114);s.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:c.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const h=["normal","bold","100","200","300","400","500","600","700","800","900"];class f extends p.Disposable{constructor(_){super(),this._onOptionChange=this.register(new u.EventEmitter),this.onOptionChange=this._onOptionChange.event;const n={...s.DEFAULT_OPTIONS};for(const o in _)if(o in n)try{const r=_[o];n[o]=this._sanitizeAndValidateOption(o,r)}catch(r){console.error(r)}this.rawOptions=n,this.options={...n},this._setupOptions(),this.register((0,p.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(_,n){return this.onOptionChange(o=>{o===_&&n(this.rawOptions[_])})}onMultipleOptionChange(_,n){return this.onOptionChange(o=>{_.indexOf(o)!==-1&&n()})}_setupOptions(){const _=o=>{if(!(o in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${o}"`);return this.rawOptions[o]},n=(o,r)=>{if(!(o in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${o}"`);r=this._sanitizeAndValidateOption(o,r),this.rawOptions[o]!==r&&(this.rawOptions[o]=r,this._onOptionChange.fire(o))};for(const o in this.rawOptions){const r={get:_.bind(this,o),set:n.bind(this,o)};Object.defineProperty(this.options,o,r)}}_sanitizeAndValidateOption(_,n){switch(_){case"cursorStyle":if(n||(n=s.DEFAULT_OPTIONS[_]),!function(o){return o==="block"||o==="underline"||o==="bar"}(n))throw new Error(`"${n}" is not a valid value for ${_}`);break;case"wordSeparator":n||(n=s.DEFAULT_OPTIONS[_]);break;case"fontWeight":case"fontWeightBold":if(typeof n=="number"&&1<=n&&n<=1e3)break;n=h.includes(n)?n:s.DEFAULT_OPTIONS[_];break;case"cursorWidth":n=Math.floor(n);case"lineHeight":case"tabStopWidth":if(n<1)throw new Error(`${_} cannot be less than 1, value: ${n}`);break;case"minimumContrastRatio":n=Math.max(1,Math.min(21,Math.round(10*n)/10));break;case"scrollback":if((n=Math.min(n,4294967295))<0)throw new Error(`${_} cannot be less than 0, value: ${n}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(n<=0)throw new Error(`${_} cannot be less than or equal to 0, value: ${n}`);break;case"rows":case"cols":if(!n&&n!==0)throw new Error(`${_} must be numeric, value: ${n}`);break;case"windowsPty":n=n??{}}return n}}s.OptionsService=f},2660:function(k,s,a){var u=this&&this.__decorate||function(f,S,_,n){var o,r=arguments.length,l=r<3?S:n===null?n=Object.getOwnPropertyDescriptor(S,_):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(f,S,_,n);else for(var m=f.length-1;m>=0;m--)(o=f[m])&&(l=(r<3?o(l):r>3?o(S,_,l):o(S,_))||l);return r>3&&l&&Object.defineProperty(S,_,l),l},p=this&&this.__param||function(f,S){return function(_,n){S(_,n,f)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OscLinkService=void 0;const c=a(2585);let h=s.OscLinkService=class{constructor(f){this._bufferService=f,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(f){const S=this._bufferService.buffer;if(f.id===void 0){const m=S.addMarker(S.ybase+S.y),w={data:f,id:this._nextId++,lines:[m]};return m.onDispose(()=>this._removeMarkerFromLink(w,m)),this._dataByLinkId.set(w.id,w),w.id}const _=f,n=this._getEntryIdKey(_),o=this._entriesWithId.get(n);if(o)return this.addLineToLink(o.id,S.ybase+S.y),o.id;const r=S.addMarker(S.ybase+S.y),l={id:this._nextId++,key:this._getEntryIdKey(_),data:_,lines:[r]};return r.onDispose(()=>this._removeMarkerFromLink(l,r)),this._entriesWithId.set(l.key,l),this._dataByLinkId.set(l.id,l),l.id}addLineToLink(f,S){const _=this._dataByLinkId.get(f);if(_&&_.lines.every(n=>n.line!==S)){const n=this._bufferService.buffer.addMarker(S);_.lines.push(n),n.onDispose(()=>this._removeMarkerFromLink(_,n))}}getLinkData(f){return this._dataByLinkId.get(f)?.data}_getEntryIdKey(f){return`${f.id};;${f.uri}`}_removeMarkerFromLink(f,S){const _=f.lines.indexOf(S);_!==-1&&(f.lines.splice(_,1),f.lines.length===0&&(f.data.id!==void 0&&this._entriesWithId.delete(f.key),this._dataByLinkId.delete(f.id)))}};s.OscLinkService=h=u([p(0,c.IBufferService)],h)},8343:(k,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createDecorator=s.getServiceDependencies=s.serviceRegistry=void 0;const a="di$target",u="di$dependencies";s.serviceRegistry=new Map,s.getServiceDependencies=function(p){return p[u]||[]},s.createDecorator=function(p){if(s.serviceRegistry.has(p))return s.serviceRegistry.get(p);const c=function(h,f,S){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(_,n,o){n[a]===n?n[u].push({id:_,index:o}):(n[u]=[{id:_,index:o}],n[a]=n)})(c,h,S)};return c.toString=()=>p,s.serviceRegistry.set(p,c),c}},2585:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.IDecorationService=s.IUnicodeService=s.IOscLinkService=s.IOptionsService=s.ILogService=s.LogLevelEnum=s.IInstantiationService=s.ICharsetService=s.ICoreService=s.ICoreMouseService=s.IBufferService=void 0;const u=a(8343);var p;s.IBufferService=(0,u.createDecorator)("BufferService"),s.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),s.ICoreService=(0,u.createDecorator)("CoreService"),s.ICharsetService=(0,u.createDecorator)("CharsetService"),s.IInstantiationService=(0,u.createDecorator)("InstantiationService"),function(c){c[c.TRACE=0]="TRACE",c[c.DEBUG=1]="DEBUG",c[c.INFO=2]="INFO",c[c.WARN=3]="WARN",c[c.ERROR=4]="ERROR",c[c.OFF=5]="OFF"}(p||(s.LogLevelEnum=p={})),s.ILogService=(0,u.createDecorator)("LogService"),s.IOptionsService=(0,u.createDecorator)("OptionsService"),s.IOscLinkService=(0,u.createDecorator)("OscLinkService"),s.IUnicodeService=(0,u.createDecorator)("UnicodeService"),s.IDecorationService=(0,u.createDecorator)("DecorationService")},1480:(k,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeService=void 0;const u=a(8460),p=a(225);class c{static extractShouldJoin(f){return(1&f)!=0}static extractWidth(f){return f>>1&3}static extractCharKind(f){return f>>3}static createPropertyValue(f,S,_=!1){return(16777215&f)<<3|(3&S)<<1|(_?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new u.EventEmitter,this.onChange=this._onChange.event;const f=new p.UnicodeV6;this.register(f),this._active=f.version,this._activeProvider=f}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(f){if(!this._providers[f])throw new Error(`unknown Unicode version "${f}"`);this._active=f,this._activeProvider=this._providers[f],this._onChange.fire(f)}register(f){this._providers[f.version]=f}wcwidth(f){return this._activeProvider.wcwidth(f)}getStringCellWidth(f){let S=0,_=0;const n=f.length;for(let o=0;o<n;++o){let r=f.charCodeAt(o);if(55296<=r&&r<=56319){if(++o>=n)return S+this.wcwidth(r);const w=f.charCodeAt(o);56320<=w&&w<=57343?r=1024*(r-55296)+w-56320+65536:S+=this.wcwidth(w)}const l=this.charProperties(r,_);let m=c.extractWidth(l);c.extractShouldJoin(l)&&(m-=c.extractWidth(_)),S+=m,_=l}return S}charProperties(f,S){return this._activeProvider.charProperties(f,S)}}s.UnicodeService=c}},d={};function y(k){var s=d[k];if(s!==void 0)return s.exports;var a=d[k]={exports:{}};return t[k].call(a.exports,a,a.exports,y),a.exports}var E={};return(()=>{var k=E;Object.defineProperty(k,"__esModule",{value:!0}),k.Terminal=void 0;const s=y(9042),a=y(3236),u=y(844),p=y(5741),c=y(8285),h=y(7975),f=y(7090),S=["cols","rows"];class _ extends u.Disposable{constructor(o){super(),this._core=this.register(new a.Terminal(o)),this._addonManager=this.register(new p.AddonManager),this._publicOptions={...this._core.options};const r=m=>this._core.options[m],l=(m,w)=>{this._checkReadonlyOptions(m),this._core.options[m]=w};for(const m in this._core.options){const w={get:r.bind(this,m),set:l.bind(this,m)};Object.defineProperty(this._publicOptions,m,w)}}_checkReadonlyOptions(o){if(S.includes(o))throw new Error(`Option "${o}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new h.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new f.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new c.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const o=this._core.coreService.decPrivateModes;let r="none";switch(this._core.coreMouseService.activeProtocol){case"X10":r="x10";break;case"VT200":r="vt200";break;case"DRAG":r="drag";break;case"ANY":r="any"}return{applicationCursorKeysMode:o.applicationCursorKeys,applicationKeypadMode:o.applicationKeypad,bracketedPasteMode:o.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:r,originMode:o.origin,reverseWraparoundMode:o.reverseWraparound,sendFocusMode:o.sendFocus,wraparoundMode:o.wraparound}}get options(){return this._publicOptions}set options(o){for(const r in o)this._publicOptions[r]=o[r]}blur(){this._core.blur()}focus(){this._core.focus()}input(o,r=!0){this._core.input(o,r)}resize(o,r){this._verifyIntegers(o,r),this._core.resize(o,r)}open(o){this._core.open(o)}attachCustomKeyEventHandler(o){this._core.attachCustomKeyEventHandler(o)}attachCustomWheelEventHandler(o){this._core.attachCustomWheelEventHandler(o)}registerLinkProvider(o){return this._core.registerLinkProvider(o)}registerCharacterJoiner(o){return this._checkProposedApi(),this._core.registerCharacterJoiner(o)}deregisterCharacterJoiner(o){this._checkProposedApi(),this._core.deregisterCharacterJoiner(o)}registerMarker(o=0){return this._verifyIntegers(o),this._core.registerMarker(o)}registerDecoration(o){return this._checkProposedApi(),this._verifyPositiveIntegers(o.x??0,o.width??0,o.height??0),this._core.registerDecoration(o)}hasSelection(){return this._core.hasSelection()}select(o,r,l){this._verifyIntegers(o,r,l),this._core.select(o,r,l)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(o,r){this._verifyIntegers(o,r),this._core.selectLines(o,r)}dispose(){super.dispose()}scrollLines(o){this._verifyIntegers(o),this._core.scrollLines(o)}scrollPages(o){this._verifyIntegers(o),this._core.scrollPages(o)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(o){this._verifyIntegers(o),this._core.scrollToLine(o)}clear(){this._core.clear()}write(o,r){this._core.write(o,r)}writeln(o,r){this._core.write(o),this._core.write(`\r
`,r)}paste(o){this._core.paste(o)}refresh(o,r){this._verifyIntegers(o,r),this._core.refresh(o,r)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(o){this._addonManager.loadAddon(this,o)}static get strings(){return s}_verifyIntegers(...o){for(const r of o)if(r===1/0||isNaN(r)||r%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...o){for(const r of o)if(r&&(r===1/0||isNaN(r)||r%1!=0||r<0))throw new Error("This API only accepts positive integers")}}k.Terminal=_})(),E})())}(Gt)),Gt.exports}var ul=dl(),Xt={exports:{}},ir;function fl(){return ir||(ir=1,function(i,e){(function(t,d){i.exports=d()})(self,()=>(()=>{var t={};return(()=>{var d=t;Object.defineProperty(d,"__esModule",{value:!0}),d.FitAddon=void 0,d.FitAddon=class{activate(y){this._terminal=y}dispose(){}fit(){const y=this.proposeDimensions();if(!y||!this._terminal||isNaN(y.cols)||isNaN(y.rows))return;const E=this._terminal._core;this._terminal.rows===y.rows&&this._terminal.cols===y.cols||(E._renderService.clear(),this._terminal.resize(y.cols,y.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const y=this._terminal._core,E=y._renderService.dimensions;if(E.css.cell.width===0||E.css.cell.height===0)return;const k=this._terminal.options.scrollback===0?0:y.viewport.scrollBarWidth,s=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(s.getPropertyValue("height")),u=Math.max(0,parseInt(s.getPropertyValue("width"))),p=window.getComputedStyle(this._terminal.element),c=a-(parseInt(p.getPropertyValue("padding-top"))+parseInt(p.getPropertyValue("padding-bottom"))),h=u-(parseInt(p.getPropertyValue("padding-right"))+parseInt(p.getPropertyValue("padding-left")))-k;return{cols:Math.max(2,Math.floor(h/E.css.cell.width)),rows:Math.max(1,Math.floor(c/E.css.cell.height))}}}})(),t})())}(Xt)),Xt.exports}var _l=fl(),Jt={exports:{}},nr;function pl(){return nr||(nr=1,function(i,e){(function(t,d){i.exports=d()})(self,()=>(()=>{var t={6:(k,s)=>{function a(p){try{const c=new URL(p),h=c.password&&c.username?`${c.protocol}//${c.username}:${c.password}@${c.host}`:c.username?`${c.protocol}//${c.username}@${c.host}`:`${c.protocol}//${c.host}`;return p.toLocaleLowerCase().startsWith(h.toLocaleLowerCase())}catch{return!1}}Object.defineProperty(s,"__esModule",{value:!0}),s.LinkComputer=s.WebLinkProvider=void 0,s.WebLinkProvider=class{constructor(p,c,h,f={}){this._terminal=p,this._regex=c,this._handler=h,this._options=f}provideLinks(p,c){const h=u.computeLink(p,this._regex,this._terminal,this._handler);c(this._addCallbacks(h))}_addCallbacks(p){return p.map(c=>(c.leave=this._options.leave,c.hover=(h,f)=>{if(this._options.hover){const{range:S}=c;this._options.hover(h,f,S)}},c))}};class u{static computeLink(c,h,f,S){const _=new RegExp(h.source,(h.flags||"")+"g"),[n,o]=u._getWindowedLineStrings(c-1,f),r=n.join("");let l;const m=[];for(;l=_.exec(r);){const w=l[0];if(!a(w))continue;const[b,x]=u._mapStrIdx(f,o,0,l.index),[g,C]=u._mapStrIdx(f,b,x,w.length);if(b===-1||x===-1||g===-1||C===-1)continue;const T={start:{x:x+1,y:b+1},end:{x:C,y:g+1}};m.push({range:T,text:w,activate:S})}return m}static _getWindowedLineStrings(c,h){let f,S=c,_=c,n=0,o="";const r=[];if(f=h.buffer.active.getLine(c)){const l=f.translateToString(!0);if(f.isWrapped&&l[0]!==" "){for(n=0;(f=h.buffer.active.getLine(--S))&&n<2048&&(o=f.translateToString(!0),n+=o.length,r.push(o),f.isWrapped&&o.indexOf(" ")===-1););r.reverse()}for(r.push(l),n=0;(f=h.buffer.active.getLine(++_))&&f.isWrapped&&n<2048&&(o=f.translateToString(!0),n+=o.length,r.push(o),o.indexOf(" ")===-1););}return[r,S]}static _mapStrIdx(c,h,f,S){const _=c.buffer.active,n=_.getNullCell();let o=f;for(;S;){const r=_.getLine(h);if(!r)return[-1,-1];for(let l=o;l<r.length;++l){r.getCell(l,n);const m=n.getChars();if(n.getWidth()&&(S-=m.length||1,l===r.length-1&&m==="")){const w=_.getLine(h+1);w&&w.isWrapped&&(w.getCell(0,n),n.getWidth()===2&&(S+=1))}if(S<0)return[h,l]}h++,o=0}return[h,o]}}s.LinkComputer=u}},d={};function y(k){var s=d[k];if(s!==void 0)return s.exports;var a=d[k]={exports:{}};return t[k](a,a.exports,y),a.exports}var E={};return(()=>{var k=E;Object.defineProperty(k,"__esModule",{value:!0}),k.WebLinksAddon=void 0;const s=y(6),a=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function u(p,c){const h=window.open();if(h){try{h.opener=null}catch{}h.location.href=c}else console.warn("Opening link blocked as opener could not be cleared")}k.WebLinksAddon=class{constructor(p=u,c={}){this._handler=p,this._options=c}activate(p){this._terminal=p;const c=this._options,h=c.urlRegex||a;this._linkProvider=this._terminal.registerLinkProvider(new s.WebLinkProvider(this._terminal,h,this._handler,c))}dispose(){this._linkProvider?.dispose()}}})(),E})())}(Jt)),Jt.exports}var ml=pl();function gl({projectId:i="default"}){const[e,t]=N.useState(null),[d,y]=N.useState(null),[E,k]=N.useState(!1),s=N.useRef(null),a=N.useRef(null),u=N.useRef(null),p=N.useRef(null);me("terminal_session",h=>{h.sessionId===e&&(y(h),k(!1),h.status==="error"&&a.current&&a.current.write(`\r
\x1B[31mError: ${h.error||"Failed to start terminal"}\x1B[0m\r
`))}),me("terminal_data",h=>{h.sessionId===e&&a.current&&a.current.write(h.data)});const c=N.useCallback(()=>{u.current&&a.current&&setTimeout(()=>{if(u.current&&a.current)try{u.current.fit();const{cols:h,rows:f}=a.current;p.current&&clearTimeout(p.current),p.current=window.setTimeout(()=>{e&&de.resizeTerminal(e,h,f)},200)}catch(h){console.warn("Terminal resize error:",h)}},100)},[e]);return N.useEffect(()=>{if(!s.current||a.current)return;const h=new ul.Terminal({cursorBlink:!0,fontSize:13,fontFamily:"'JetBrains Mono', 'Consolas', 'Monaco', monospace",fontWeight:500,lineHeight:1.4,allowTransparency:!1,convertEol:!0,rows:24,cols:80,theme:{background:"#000000",foreground:"#ffffff",cursor:"hsl(var(--primary))",selectionBackground:"hsl(var(--primary) / 0.3)",black:"#000000",red:"#ff5555",green:"#50fa7b",yellow:"#f1fa8c",blue:"#6272a4",magenta:"#ff79c6",cyan:"#8be9fd",white:"#f8f8f2",brightBlack:"#6272a4",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#8be9fd",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#ffffff"},allowProposedApi:!0}),f=new _l.FitAddon,S=new ml.WebLinksAddon;return h.loadAddon(f),h.loadAddon(S),h.open(s.current),a.current=h,u.current=f,c(),h.write(`Welcome to Colony AI Terminal\r
`),h.write(`Connecting to server...\r
\r
`),h.onData(_=>{e&&d?.status==="running"&&de.sendTerminalData(e,_)}),h.onResize(({cols:_,rows:n})=>{e&&de.resizeTerminal(e,_,n)}),k(!0),de.createTerminalSession(i),()=>{e&&de.closeTerminal(e),h.dispose(),a.current=null,u.current=null}},[i]),me("terminal_session",h=>{h.projectId===i&&!e&&t(h.sessionId)}),N.useEffect(()=>{const h=new ResizeObserver(()=>{c()});return s.current&&h.observe(s.current),window.addEventListener("resize",c),()=>{h.disconnect(),window.removeEventListener("resize",c),p.current&&clearTimeout(p.current)}},[c]),v.jsx("div",{className:"h-full border border-border rounded-lg bg-card",children:v.jsxs("div",{className:"h-full flex flex-col",children:[v.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Gn,{className:"h-4 w-4 text-primary"}),v.jsx("span",{className:"text-sm font-medium",children:"Terminal"}),E&&v.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[v.jsx(At,{className:"h-3 w-3 animate-spin"}),v.jsx("span",{className:"text-xs",children:"Initializing..."})]})]}),d&&v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("div",{className:`w-2 h-2 rounded-full ${d.status==="running"?"bg-green-500":d.status==="error"?"bg-red-500":"bg-yellow-500"}`}),v.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:d.status})]})]}),v.jsx("div",{ref:s,className:"flex-1",style:{backgroundColor:"#000000",padding:"8px"}})]})})}function vl({currentPhase:i}){const e=()=>{switch(i){case"spec":return v.jsx(Ds,{className:"h-4 w-4"});case"test":return v.jsx(Ts,{className:"h-4 w-4"});case"impl":return v.jsx(Ps,{className:"h-4 w-4"})}},t=()=>{switch(i){case"spec":return"text-blue-500 bg-blue-500/10 border-blue-500/20";case"test":return"text-amber-500 bg-amber-500/10 border-amber-500/20";case"impl":return"text-violet-500 bg-violet-500/10 border-violet-500/20"}},d=()=>{switch(i){case"spec":return"Specification Phase";case"test":return"Testing Phase";case"impl":return"Implementation Phase"}},y=()=>{switch(i){case"spec":return"Defining project structure and requirements";case"test":return"Writing test cases and validation logic";case"impl":return"Implementing the actual code and features"}},E=[{key:"spec",label:"Specification",icon:v.jsx(Ds,{className:"h-3 w-3"})},{key:"test",label:"Testing",icon:v.jsx(Ts,{className:"h-3 w-3"})},{key:"impl",label:"Implementation",icon:v.jsx(Ps,{className:"h-3 w-3"})}];return v.jsx("div",{className:"mb-3",children:v.jsxs("div",{className:`rounded-lg border p-3 transition-all duration-300 ${t()}`,children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[e(),v.jsx("span",{className:"font-medium text-sm",children:d()})]}),v.jsx("span",{className:"text-xs opacity-75",children:y()})]}),v.jsx(qn,{className:"h-3 w-3 opacity-50"})]}),v.jsx("div",{className:"flex items-center gap-1 mt-2",children:E.map((k,s)=>v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:`h-1.5 w-1.5 rounded-full transition-all duration-300 ${k.key===i?"bg-current w-8":E.indexOf(E.find(a=>a.key===i))>s?"bg-current opacity-50":"bg-current opacity-20"}`}),s<E.length-1&&v.jsx("div",{className:`h-0.5 w-4 mx-1 bg-current transition-opacity duration-300 ${E.indexOf(E.find(a=>a.key===i))>s?"opacity-50":"opacity-20"}`})]},k.key))})]})})}function Sl({messages:i,onSendMessage:e,onNewChat:t,currentPhase:d="spec",isConnected:y=!1,onMessagesUpdate:E,isLoading:k=!1,onLoadingChange:s,importedProject:a=[]}){const[u,p]=N.useState(!1),[c,h]=N.useState(!1),[f]=N.useState(42),[S]=N.useState(30),[_,n]=N.useState(null),o=()=>{p(!u)},r=()=>{h(!c)},l=(m,w,b)=>{w&&n({path:m,content:w,language:b})};return v.jsx("div",{className:"h-full flex flex-col",children:v.jsxs(zs,{direction:"horizontal",className:"h-full",children:[v.jsx(ht,{defaultSize:f,minSize:u?5:25,maxSize:u?5:60,collapsible:!0,onCollapse:()=>p(!0),onExpand:()=>p(!1),children:v.jsxs("div",{className:"h-full flex flex-col bg-card",children:[v.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:u?v.jsx("div",{className:"h-full flex items-center justify-center",children:v.jsx(ie,{variant:"ghost",size:"sm",onClick:o,className:"rotate-0 hover:rotate-12 transition-transform",children:v.jsx(Bn,{className:"h-4 w-4"})})}):v.jsx(sl,{messages:i,onNewChat:t,isConnected:y,onMessagesUpdate:E,isLoading:k,onLoadingChange:s})}),!u&&v.jsxs("div",{className:"flex-shrink-0 px-4 py-4 border-t border-border bg-card",children:[v.jsx(vl,{currentPhase:d}),v.jsx(rl,{onSendMessage:e,isLoading:k,disabled:!y})]})]})}),v.jsx(Ws,{withHandle:!0}),v.jsx(ht,{defaultSize:100-f,children:v.jsx("div",{className:"h-full flex flex-col",children:v.jsxs("div",{className:"flex-1 min-h-0",children:[v.jsxs(zs,{direction:"vertical",children:[v.jsx(ht,{defaultSize:c?100:100-S,minSize:c?100:40,children:v.jsxs("div",{className:"h-full flex",children:[v.jsx("div",{className:"w-64 h-full border border-border rounded-l-lg bg-card",children:v.jsx(nl,{onFileSelect:l,importedProject:a})}),v.jsx("div",{className:"flex-1 h-full border-t border-r border-b border-border rounded-r-lg bg-black",children:v.jsx(hl,{currentPhase:d,selectedFile:_})})]})}),!c&&v.jsxs(v.Fragment,{children:[v.jsx(Ws,{withHandle:!0}),v.jsx(ht,{defaultSize:S,minSize:15,maxSize:60,collapsible:!0,onCollapse:()=>h(!0),children:v.jsx("div",{className:"h-full",children:v.jsx(gl,{})})})]})]}),c&&v.jsx("div",{className:"absolute bottom-3 left-1/2 transform -translate-x-1/2",children:v.jsxs(ie,{variant:"outline",size:"sm",onClick:r,className:"bg-background/80 backdrop-blur-sm border-border/50 hover:bg-background/90",children:[v.jsx(Tn,{className:"h-4 w-4 mr-2"}),"Terminal"]})})]})})})]})})}function yi({className:i,type:e,...t}){return v.jsx("input",{type:e,"data-slot":"input",className:ne("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",i),...t})}var Yt={exports:{}},Zt={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var or;function bl(){if(or)return Zt;or=1;var i=Wi();function e(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var t=typeof Object.is=="function"?Object.is:e,d=i.useState,y=i.useEffect,E=i.useLayoutEffect,k=i.useDebugValue;function s(c,h){var f=h(),S=d({inst:{value:f,getSnapshot:h}}),_=S[0].inst,n=S[1];return E(function(){_.value=f,_.getSnapshot=h,a(_)&&n({inst:_})},[c,f,h]),y(function(){return a(_)&&n({inst:_}),c(function(){a(_)&&n({inst:_})})},[c]),k(f),f}function a(c){var h=c.getSnapshot;c=c.value;try{var f=h();return!t(c,f)}catch{return!0}}function u(c,h){return h()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:s;return Zt.useSyncExternalStore=i.useSyncExternalStore!==void 0?i.useSyncExternalStore:p,Zt}var ar;function yl(){return ar||(ar=1,Yt.exports=bl()),Yt.exports}var wl=yl();function xl(){return wl.useSyncExternalStore(Cl,()=>!0,()=>!1)}function Cl(){return()=>{}}var Es="Avatar",[El,fc]=hs(Es),[kl,wi]=El(Es),xi=N.forwardRef((i,e)=>{const{__scopeAvatar:t,...d}=i,[y,E]=N.useState("idle");return v.jsx(kl,{scope:t,imageLoadingStatus:y,onImageLoadingStatusChange:E,children:v.jsx(xe.span,{...d,ref:e})})});xi.displayName=Es;var Ci="AvatarImage",Rl=N.forwardRef((i,e)=>{const{__scopeAvatar:t,src:d,onLoadingStatusChange:y=()=>{},...E}=i,k=wi(Ci,t),s=Ll(d,E),a=Ae(u=>{y(u),k.onImageLoadingStatusChange(u)});return yt(()=>{s!=="idle"&&a(s)},[s,a]),s==="loaded"?v.jsx(xe.img,{...E,ref:e,src:d}):null});Rl.displayName=Ci;var Ei="AvatarFallback",ki=N.forwardRef((i,e)=>{const{__scopeAvatar:t,delayMs:d,...y}=i,E=wi(Ei,t),[k,s]=N.useState(d===void 0);return N.useEffect(()=>{if(d!==void 0){const a=window.setTimeout(()=>s(!0),d);return()=>window.clearTimeout(a)}},[d]),k&&E.imageLoadingStatus!=="loaded"?v.jsx(xe.span,{...y,ref:e}):null});ki.displayName=Ei;function lr(i,e){return i?e?(i.src!==e&&(i.src=e),i.complete&&i.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ll(i,{referrerPolicy:e,crossOrigin:t}){const d=xl(),y=N.useRef(null),E=d?(y.current||(y.current=new window.Image),y.current):null,[k,s]=N.useState(()=>lr(E,i));return yt(()=>{s(lr(E,i))},[E,i]),yt(()=>{const a=c=>()=>{s(c)};if(!E)return;const u=a("loaded"),p=a("error");return E.addEventListener("load",u),E.addEventListener("error",p),e&&(E.referrerPolicy=e),typeof t=="string"&&(E.crossOrigin=t),()=>{E.removeEventListener("load",u),E.removeEventListener("error",p)}},[E,t,e]),k}var Al=xi,Dl=ki;function Tl({className:i,...e}){return v.jsx(Al,{"data-slot":"avatar",className:ne("relative flex size-10 shrink-0 overflow-hidden rounded-full",i),...e})}function Pl({className:i,...e}){return v.jsx(Dl,{"data-slot":"avatar-fallback",className:ne("bg-muted flex size-full items-center justify-center rounded-full",i),...e})}function Bl({isOpen:i,onClose:e}){const[t,d]=N.useState(""),[y]=N.useState([{id:"1",title:"React Component Development",lastMessage:"Create a React component for a todo list",timestamp:"2 hours ago",messageCount:12,isStarred:!0},{id:"2",title:"Python Data Validation",lastMessage:"Generate a Python function for data validation",timestamp:"1 day ago",messageCount:8},{id:"3",title:"JavaScript Debugging",lastMessage:"Help me debug this JavaScript error",timestamp:"2 days ago",messageCount:15,isStarred:!0},{id:"4",title:"CSS Animation",lastMessage:"Create a CSS animation for loading spinner",timestamp:"1 week ago",messageCount:6},{id:"5",title:"API Integration",lastMessage:"Help with REST API integration",timestamp:"1 week ago",messageCount:10}]),[E]=N.useState([{id:"6",title:"Database Schema Design",lastMessage:"Design a database schema for user management",timestamp:"3 hours ago",messageCount:7},{id:"7",title:"TypeScript Types",lastMessage:"Create TypeScript interfaces for API responses",timestamp:"5 hours ago",messageCount:4},{id:"8",title:"Authentication System",lastMessage:"Implement JWT authentication in Node.js",timestamp:"6 hours ago",messageCount:18}]),k=y.filter(s=>s.isStarred);return i?v.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[v.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),v.jsxs("div",{className:"relative w-80 h-full bg-card/95 backdrop-blur-sm border-r border-border/50 shadow-2xl",children:[v.jsxs("div",{className:"p-4 border-b border-border/50 bg-gradient-to-r from-card to-card/80",children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Tl,{className:"h-8 w-8",children:v.jsx(Pl,{className:"bg-primary/20 text-primary border border-primary/30",children:"CA"})}),v.jsxs("div",{children:[v.jsx("h3",{className:"font-medium text-sm",children:"Chat History"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Colony AI"})]})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(ie,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:v.jsx($n,{className:"h-4 w-4"})}),v.jsx(ie,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e,children:v.jsx(ot,{className:"h-4 w-4"})})]})]}),v.jsxs("div",{className:"relative",children:[v.jsx(Hn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),v.jsx(yi,{placeholder:"Search conversations...",value:t,onChange:s=>d(s.target.value),className:"pl-10 bg-input-background/50 border-border/50 focus:border-primary/50 focus:bg-input-background/80"})]})]}),v.jsx("div",{className:"p-4 border-b border-border/50",children:v.jsxs("div",{className:"space-y-2",children:[v.jsxs(ie,{variant:"secondary",className:"w-full justify-start gap-2 bg-primary/10 hover:bg-primary/20 border-primary/20",children:[v.jsx(Ln,{className:"h-4 w-4"}),"Conversations",v.jsx(mt,{variant:"secondary",className:"ml-auto bg-primary/20 text-primary",children:y.length})]}),v.jsxs(ie,{variant:"ghost",className:"w-full justify-start gap-2 hover:bg-secondary/50",children:[v.jsx(Ht,{className:"h-4 w-4"}),"Starred",v.jsx(mt,{variant:"secondary",className:"ml-auto",children:k.length})]}),v.jsxs(ie,{variant:"ghost",className:"w-full justify-start gap-2 hover:bg-secondary/50",children:[v.jsx(yr,{className:"h-4 w-4"}),"Recent",v.jsx(mt,{variant:"secondary",className:"ml-auto",children:E.length})]})]})}),v.jsxs("div",{className:"flex-1 overflow-y-auto",children:[k.length>0&&v.jsxs("div",{className:"p-4 border-b border-border/50",children:[v.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider mb-3",children:"Starred"}),v.jsx("div",{className:"space-y-2",children:k.map(s=>v.jsxs("div",{className:"p-3 rounded-lg bg-gradient-to-r from-secondary/30 to-secondary/10 hover:from-secondary/50 hover:to-secondary/20 cursor-pointer transition-all duration-200 border border-border/30 hover:border-primary/30",children:[v.jsx("div",{className:"flex items-start justify-between mb-2",children:v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Ht,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"}),v.jsx("p",{className:"font-medium text-sm line-clamp-1",children:s.title})]})}),v.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:s.lastMessage}),v.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[v.jsxs("span",{children:[s.messageCount," messages"]}),v.jsx("span",{children:s.timestamp})]})]},s.id))})]}),v.jsxs("div",{className:"p-4",children:[v.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider mb-3",children:"Recent Conversations"}),v.jsx("div",{className:"space-y-2",children:y.map(s=>v.jsxs("div",{className:"p-3 rounded-lg bg-secondary/10 hover:bg-secondary/20 cursor-pointer transition-all duration-200 border border-transparent hover:border-border/50",children:[v.jsxs("div",{className:"flex items-start justify-between mb-2",children:[v.jsx("p",{className:"font-medium text-sm line-clamp-1",children:s.title}),s.isStarred&&v.jsx(Ht,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"})]}),v.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:s.lastMessage}),v.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[v.jsxs("span",{children:[s.messageCount," messages"]}),v.jsx("span",{children:s.timestamp})]})]},s.id))})]})]})]})]}):null}function Ml({...i}){return v.jsx(ur,{"data-slot":"dialog",...i})}function Il({...i}){return v.jsx(mr,{"data-slot":"dialog-portal",...i})}function Nl({className:i,...e}){return v.jsx(gr,{"data-slot":"dialog-overlay",className:ne("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",i),...e})}function Ol({className:i,children:e,...t}){return v.jsxs(Il,{"data-slot":"dialog-portal",children:[v.jsx(Nl,{}),v.jsxs(fr,{"data-slot":"dialog-content",className:ne("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",i),...t,children:[e,v.jsxs(_r,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[v.jsx(ot,{}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function jl({className:i,...e}){return v.jsx("div",{"data-slot":"dialog-header",className:ne("flex flex-col gap-2 text-center sm:text-left",i),...e})}function Hl({className:i,...e}){return v.jsx(pr,{"data-slot":"dialog-title",className:ne("text-lg leading-none font-semibold",i),...e})}function Fl({className:i,...e}){return v.jsx(Hi,{"data-slot":"dialog-description",className:ne("text-muted-foreground text-sm",i),...e})}const zl=ms("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Qt({className:i,variant:e,...t}){return v.jsx("div",{"data-slot":"alert",role:"alert",className:ne(zl({variant:e}),i),...t})}function es({className:i,...e}){return v.jsx("div",{"data-slot":"alert-description",className:ne("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",i),...e})}var ks="Progress",Rs=100,[Wl,_c]=hs(ks),[$l,Ul]=Wl(ks),Ri=N.forwardRef((i,e)=>{const{__scopeProgress:t,value:d=null,max:y,getValueLabel:E=ql,...k}=i;(y||y===0)&&!cr(y)&&console.error(Vl(`${y}`,"Progress"));const s=cr(y)?y:Rs;d!==null&&!hr(d,s)&&console.error(Kl(`${d}`,"Progress"));const a=hr(d,s)?d:null,u=Rt(a)?E(a,s):void 0;return v.jsx($l,{scope:t,value:a,max:s,children:v.jsx(xe.div,{"aria-valuemax":s,"aria-valuemin":0,"aria-valuenow":Rt(a)?a:void 0,"aria-valuetext":u,role:"progressbar","data-state":Di(a,s),"data-value":a??void 0,"data-max":s,...k,ref:e})})});Ri.displayName=ks;var Li="ProgressIndicator",Ai=N.forwardRef((i,e)=>{const{__scopeProgress:t,...d}=i,y=Ul(Li,t);return v.jsx(xe.div,{"data-state":Di(y.value,y.max),"data-value":y.value??void 0,"data-max":y.max,...d,ref:e})});Ai.displayName=Li;function ql(i,e){return`${Math.round(i/e*100)}%`}function Di(i,e){return i==null?"indeterminate":i===e?"complete":"loading"}function Rt(i){return typeof i=="number"}function cr(i){return Rt(i)&&!isNaN(i)&&i>0}function hr(i,e){return Rt(i)&&!isNaN(i)&&i<=e&&i>=0}function Vl(i,e){return`Invalid prop \`max\` of value \`${i}\` supplied to \`${e}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${Rs}\`.`}function Kl(i,e){return`Invalid prop \`value\` of value \`${i}\` supplied to \`${e}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${Rs} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Gl=Ri,Xl=Ai;function Jl({className:i,value:e,...t}){return v.jsx(Gl,{"data-slot":"progress",className:ne("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",i),...t,children:v.jsx(Xl,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})})}function Yl({isOpen:i,onClose:e,onImport:t}){const[d,y]=N.useState(!1),[E,k]=N.useState(0),[s,a]=N.useState("idle"),[u,p]=N.useState(""),[c,h]=N.useState(""),f=async o=>{const r=o.target.files;if(!(!r||r.length===0)){y(!0),a("importing"),p(""),h(""),k(0);try{const l=await cs.importFiles(r);if(l.length===0)throw new Error("No valid files found to import");k(100),a("success"),h(`Successfully imported ${l.length} file${l.length>1?"s":""}`),t(l),setTimeout(()=>{e(),n()},1500)}catch(l){a("error"),p(l.message||"Failed to import files")}finally{y(!1)}}},S=async()=>{y(!0),a("importing"),p(""),h(""),k(20);try{const o=await cs.importFolder();if(!o){n();return}k(100),a("success");const r=_(o);h(`Successfully imported ${r} file${r>1?"s":""} from "${o.name}"`),t([o]),setTimeout(()=>{e(),n()},1500)}catch(o){a("error"),p(o.message||"Failed to import folder")}finally{y(!1)}},_=o=>o.type==="file"?1:o.children.reduce((r,l)=>r+_(l),0),n=()=>{a("idle"),k(0),p(""),h("")};return v.jsx(Ml,{open:i,onOpenChange:e,children:v.jsxs(Ol,{className:"sm:max-w-[500px]",children:[v.jsxs(jl,{children:[v.jsx(Hl,{children:"Import Project"}),v.jsx(Fl,{children:"Import files or an entire folder from your local file system"})]}),v.jsxs("div",{className:"space-y-4 py-4",children:[u&&v.jsxs(Qt,{variant:"destructive",children:[v.jsx(Pe,{className:"h-4 w-4"}),v.jsx(es,{children:u})]}),c&&v.jsxs(Qt,{className:"border-green-500 bg-green-50 dark:bg-green-950",children:[v.jsx(rn,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),v.jsx(es,{className:"text-green-900 dark:text-green-100",children:c})]}),s==="importing"&&v.jsxs("div",{className:"space-y-2",children:[v.jsx(Jl,{value:E,className:"h-2"}),v.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Importing files..."})]}),s==="idle"&&v.jsxs(oi,{defaultValue:"files",className:"w-full",children:[v.jsxs(Xo,{className:"grid w-full grid-cols-2",children:[v.jsx(Vs,{value:"files",children:"Import Files"}),v.jsx(Vs,{value:"folder",children:"Import Folder"})]}),v.jsxs(Ks,{value:"files",className:"space-y-4 mt-4",children:[v.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center hover:border-primary/50 transition-colors",children:[v.jsx("input",{type:"file",multiple:!0,onChange:f,className:"hidden",id:"file-input",accept:".js,.jsx,.ts,.tsx,.py,.java,.cpp,.c,.h,.cs,.go,.rb,.php,.html,.css,.scss,.sass,.less,.xml,.json,.yaml,.yml,.md,.mdx,.sql,.sh,.bash,.zsh,.fish,.ps1,.r,.R,.swift,.kt,.kts,.dart,.lua,.vim,.dockerfile,.rs,.toml,.ini,.cfg,.conf,.env"}),v.jsxs("label",{htmlFor:"file-input",className:"cursor-pointer flex flex-col items-center gap-3",children:[v.jsx(ds,{className:"h-12 w-12 text-muted-foreground"}),v.jsxs("div",{children:[v.jsx("p",{className:"font-medium",children:"Click to select files"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Select multiple files to import"})]})]})]}),v.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Supported: Source code, configuration files, and text files (max 10MB each)"})]}),v.jsxs(Ks,{value:"folder",className:"space-y-4 mt-4",children:[v.jsx("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:v.jsx(ie,{onClick:S,disabled:d,className:"w-full h-auto py-8 flex flex-col gap-3",variant:"outline",children:d?v.jsx(At,{className:"h-12 w-12 animate-spin"}):v.jsxs(v.Fragment,{children:[v.jsx(xr,{className:"h-12 w-12"}),v.jsxs("div",{children:[v.jsx("p",{className:"font-medium",children:"Select a folder"}),v.jsx("p",{className:"text-sm font-normal text-muted-foreground",children:"Import an entire project directory"})]})]})})}),v.jsxs(Qt,{children:[v.jsx(Pe,{className:"h-4 w-4"}),v.jsxs(es,{children:[v.jsx("p",{className:"font-medium mb-1",children:"Browser Compatibility"}),v.jsx("p",{className:"text-xs",children:"Folder import requires a Chromium-based browser (Chrome, Edge, Brave, etc.) with File System Access API support."})]})]})]})]})]}),v.jsx("div",{className:"flex justify-end gap-2",children:v.jsx(ie,{variant:"outline",onClick:e,disabled:d,children:"Cancel"})})]})})}class Zl extends Fi.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by boundary:",e,t),this.setState({error:e,errorInfo:t})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){if(this.state.hasError){if(this.props.fallback){const e=this.props.fallback;return v.jsx(e,{error:this.state.error,reset:this.handleReset})}return v.jsx("div",{className:"h-full flex items-center justify-center bg-background",children:v.jsxs("div",{className:"text-center p-8 max-w-md",children:[v.jsx(Pe,{className:"h-12 w-12 mx-auto mb-4 text-destructive"}),v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Something went wrong"}),v.jsx("p",{className:"text-muted-foreground mb-4",children:this.state.error?.message||"An unexpected error occurred."}),!1,v.jsxs(ie,{onClick:this.handleReset,className:"mt-4",children:[v.jsx(Er,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})})}return this.props.children}}function Ql({value:i,onChange:e,className:t,maxLength:d=30}){const[y,E]=N.useState(!1),[k,s]=N.useState(i),a=N.useRef(null);N.useEffect(()=>{s(i)},[i]),N.useEffect(()=>{y&&a.current&&(a.current.focus(),a.current.select())},[y]);const u=()=>{const f=k.trim();f?e(f):s(i),E(!1)},p=()=>{s(i),E(!1)},c=f=>{f.key==="Enter"?(f.preventDefault(),u()):f.key==="Escape"&&(f.preventDefault(),p())},h=()=>{u()};return y?v.jsx(yi,{ref:a,value:k,onChange:f=>s(f.target.value),onKeyDown:c,onBlur:h,maxLength:d,className:`text-center bg-background border-primary/20 focus:border-primary ${t}`,style:{fontFamily:"Quicksand, sans-serif",fontSize:"18px",fontWeight:500,maxWidth:"300px"}}):v.jsx("button",{onClick:()=>E(!0),className:`px-4 py-2 rounded-md bg-background hover:bg-accent/5 border border-border hover:border-accent/20 transition-all cursor-pointer ${t}`,style:{fontFamily:"Quicksand, sans-serif",fontSize:"18px",fontWeight:500,minWidth:"200px",maxWidth:"300px"},title:"Click to edit project name",children:v.jsx("span",{className:"truncate block",style:{fontFamily:"Quicksand, sans-serif"},children:i})})}class ec{STORAGE_KEY="colony-chat-history";MAX_AGE_DAYS=90;getStorage(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);return t.sessions=t.sessions.map(d=>({...d,createdAt:new Date(d.createdAt),lastModified:new Date(d.lastModified),messages:d.messages.map(y=>({...y,timestamp:new Date(y.timestamp)}))})),t}}catch(e){console.error("Error loading chat history:",e)}return{sessions:[]}}setStorage(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(t){console.error("Error saving chat history:",t)}}cleanOldSessions(e){const t=new Date;return t.setDate(t.getDate()-this.MAX_AGE_DAYS),e.filter(d=>d.lastModified>t)}saveChatSession(e){const t=this.getStorage(),d=t.sessions.findIndex(y=>y.id===e.id);d>=0?t.sessions[d]=e:t.sessions.push(e),t.sessions=this.cleanOldSessions(t.sessions),t.sessions.sort((y,E)=>E.lastModified.getTime()-y.lastModified.getTime()),this.setStorage(t)}loadChatSessions(){const e=this.getStorage(),t=this.cleanOldSessions(e.sessions);return t.length!==e.sessions.length&&(e.sessions=t,this.setStorage(e)),t.sort((d,y)=>y.lastModified.getTime()-d.lastModified.getTime())}deleteChatSession(e){const t=this.getStorage();t.sessions=t.sessions.filter(d=>d.id!==e),t.currentSessionId===e&&(t.currentSessionId=void 0),this.setStorage(t)}getCurrentSession(){const e=this.getStorage();return e.currentSessionId&&e.sessions.find(d=>d.id===e.currentSessionId)||null}setCurrentSession(e){const t=this.getStorage();t.currentSessionId=e,this.setStorage(t)}clearCurrentSession(){const e=this.getStorage();e.currentSessionId=void 0,this.setStorage(e)}createNewSession(e){const t={id:`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,title:e||`Chat ${new Date().toLocaleString()}`,createdAt:new Date,lastModified:new Date,messages:[]};return this.saveChatSession(t),this.setCurrentSession(t.id),t}}const ze=new ec;function tc(){return{model:"gpt-4o",temperature:.7,maxTokens:1e3,apiKeys:{}}}const qe={MODEL:"hma_llm_selected_model",TEMPERATURE:"hma_llm_temperature",MAX_TOKENS:"hma_llm_max_tokens"};function sc(){try{const i=localStorage.getItem(qe.MODEL),e=localStorage.getItem(qe.TEMPERATURE),t=localStorage.getItem(qe.MAX_TOKENS);return{model:i||void 0,temperature:e?parseFloat(e):void 0,maxTokens:t?parseInt(t,10):void 0}}catch{return{}}}function rc(i){try{i.model&&localStorage.setItem(qe.MODEL,i.model),i.temperature!==void 0&&localStorage.setItem(qe.TEMPERATURE,i.temperature.toString()),i.maxTokens!==void 0&&localStorage.setItem(qe.MAX_TOKENS,i.maxTokens.toString())}catch(e){console.error("Failed to save LLM preferences:",e)}}const ic=N.createContext(void 0);function nc({children:i}){const[e,t]=N.useState(()=>{const b=sc();return{...tc(),...b}}),[d,y]=N.useState({}),[E,k]=N.useState(null),[s,a]=N.useState(0),[u,p]=N.useState({}),[c,h]=N.useState({}),[f,S]=N.useState({}),[_,n]=N.useState(!1),[o,r]=N.useState(!1);me("connected",()=>{n(!0),e.model&&(de.configureLLM(e),r(!0))}),me("disconnected",()=>{n(!1),r(!1)}),me("llm_config_update",b=>{t(b.config),r(!0)}),me("llm_stream",b=>{const{messageId:x,chunk:g}=b;x&&(g.isComplete?S(C=>({...C,[x]:!1})):(h(C=>({...C,[x]:(C[x]||"")+g.content})),S(C=>({...C,[x]:!0}))))}),me("agent_hierarchy",b=>{y(b.agents),k(b.rootAgentId)}),me("token_usage",b=>{const{agentId:x,tokensUsed:g}=b;p(C=>({...C,[x]:(C[x]||0)+g})),a(C=>C+g),y(C=>{const T=C[x];return T?{...C,[x]:{...T,contextSize:b.contextSize,maxContextSize:b.maxContextSize}}:C})});const l=b=>{const x={...e,...b};t(x),rc(x),_&&(de.configureLLM(x),r(!0))},m=Object.values(d).filter(b=>b.status==="active"||b.status==="delegating");N.useEffect(()=>{if(_&&o){de.requestAgentHierarchy();const b=setInterval(()=>{de.requestAgentHierarchy()},5e3);return()=>clearInterval(b)}},[_,o]);const w={config:e,updateConfig:l,agents:d,rootAgentId:E,activeAgents:m,totalTokensUsed:s,agentTokenUsage:u,streamingMessages:c,isStreaming:f,isConnected:_,isConfigured:o};return v.jsx(ic.Provider,{value:w,children:i})}function oc(){const[i,e]=N.useState(!1),[t,d]=N.useState("spec"),[y,E]=N.useState([]),[k,s]=N.useState(!1),[a,u]=N.useState(!1),[p,c]=N.useState(null),[h,f]=N.useState(!1),[S,_]=N.useState([]),[n,o]=N.useState(()=>localStorage.getItem("projectTitle")||"Untitled Project");N.useEffect(()=>{de.connect();const g=ze.getCurrentSession();if(g)E(g.messages.map(C=>({id:C.id,text:C.content,timestamp:new Date(C.timestamp).toLocaleTimeString(),sender:C.sender,agentId:C.agentId}))),c(g.id);else{const C=ze.createNewSession();c(C.id)}return()=>{de.disconnect()}},[]),me("connected",()=>{s(!0),console.log("Connected to WebSocket server")}),me("disconnected",()=>{s(!1),console.log("Disconnected from WebSocket server")});const r=(g,C)=>{if(!g.trim()&&(!C||C.length===0))return;const T=`task-${Date.now()}`,A={id:Date.now().toString(),text:g,timestamp:new Date().toLocaleTimeString(),sender:"user",threadId:T};if(E(B=>[...B,A]),u(!0),de.sendPrompt(g),p){const B=ze.getCurrentSession();B&&(B.messages.push({id:A.id,content:g,sender:"user",timestamp:new Date().toISOString()}),ze.saveChatSession(B))}},l=g=>{if(E(g),p){const C=ze.getCurrentSession();C&&(C.messages=g.map(T=>({id:T.id,content:T.text,sender:T.sender,timestamp:new Date().toISOString(),agentId:T.agentId})),C.lastModified=new Date,ze.saveChatSession(C))}},m=g=>{u(g)},w=()=>{E([{id:"1",text:"Hello! I'm Colony AI. I can help you generate code for your project. What would you like me to create?",timestamp:new Date().toLocaleTimeString(),sender:"assistant",threadId:"welcome-thread"}]),setTimeout(()=>{setTimeout(()=>{d("test"),setTimeout(()=>{setTimeout(()=>{d("impl")},2e3)},1500)},2e3)},1e3)},b=g=>{_(C=>[...C,...g])},x=g=>{o(g),localStorage.setItem("projectTitle",g)};return v.jsxs("div",{className:"h-screen bg-background flex flex-col",children:[v.jsx("header",{className:"sticky top-0 z-50 w-full bg-background border-b border-border",children:v.jsxs("div",{className:"h-16 flex items-center px-4",children:[v.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[v.jsx(ie,{variant:"ghost",size:"lg",className:"p-2 hover:bg-card focus-visible:outline focus-visible:outline-2 focus-visible:outline-primary/60",onClick:()=>e(!0),children:v.jsx(kn,{className:"h-6 w-6"})}),v.jsx("h1",{className:"text-foreground",style:{fontFamily:"Quicksand, sans-serif",fontSize:"28px",fontWeight:400,letterSpacing:"-0.5px"},children:"[Name]"})]}),v.jsx("div",{className:"flex items-center justify-center",children:v.jsx(Ql,{value:n,onChange:x})}),v.jsxs("div",{className:"flex-1 flex justify-end items-center gap-4",children:[v.jsxs(ie,{size:"sm",onClick:()=>f(!0),className:"minimalist-button",children:[v.jsx(Yn,{className:"h-4 w-4 mr-1"}),"Import"]}),v.jsxs(ie,{size:"sm",className:"minimalist-button border-primary text-primary hover:bg-primary/5",children:[v.jsx(ro,{className:"h-4 w-4 mr-1"}),"Upgrade"]})]})]})}),v.jsx("div",{className:"flex flex-col overflow-hidden",style:{height:"calc(100vh - 4rem)"},children:v.jsx(Sl,{messages:y,onSendMessage:r,onNewChat:w,currentPhase:t,isConnected:k,onMessagesUpdate:l,isLoading:a,onLoadingChange:m,importedProject:S})}),v.jsx(Bl,{isOpen:i,onClose:()=>e(!1)}),v.jsx(Yl,{isOpen:h,onClose:()=>f(!1),onImport:b})]})}function ac(){return v.jsx(Zl,{children:v.jsx(nc,{children:v.jsx(oc,{})})})}qi.createRoot(document.getElementById("root")).render(v.jsx(N.StrictMode,{children:v.jsx(ac,{})}));
